---
title: Обновление существующих компонентов кода с помощью средств платформы компонентов PowerApps | Документация Майкрософт
description: Обновление компонентов с помощью инструментов платформы компонентов PowerApps
keywords: Платформа компонентов PowerApps, компонент кода, платформа компонентов
ms.author: nabuthuk
author: Nkrb
manager: kvivek
ms.date: 10/01/2019
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d2cbf58a-9112-45c2-b823-2c07a310714c
ms.openlocfilehash: 05e32fb7e098dad3aabf36f2efdaf311c1bea327
ms.sourcegitcommit: 2a3430bb1b56dbf6c444afe2b8eecd0e499db0c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2019
ms.locfileid: "72340237"
---
# <a name="update-existing-code-components"></a>Обновление существующих компонентов кода 

Если вы являетесь участником закрытой предварительной версии для платформы компонентов PowerApps для приложений, управляемых моделью, и уже создали компоненты кода, необходимо внести некоторые небольшие изменения, чтобы обеспечить совместимость с новыми структурами проектов, ориентированными на ALM. 

Для использования новых средств интерфейса командной строки powerapps с существующими компонентами кода инфраструктуры компонентов PowerApps необходимо внести несколько изменений.

> [!NOTE]
> Этот раздел применим только к обновлению компонентов кода для приложений, управляемых моделями, так как средства интерфейса командной строки PowerApps недоступны во время закрытой предварительной версии для приложений, управляемых моделью.  

## <a name="creating-an-empty-project"></a>Создание пустого проекта

Используйте PowerApps CLI, чтобы создать новый пустой проект для компонента кода. Дополнительные сведения: [Создание компонентов с помощью инструментария](create-custom-controls-using-pcf.md)

После создания проекта перенесите источник компонента кода в новый проект:

1. Скопируйте или замените исходный файл компонента из старого исходного файла на **index. TS**.
2. Скопируйте или замените содержимое файла **контролманифест. XML** в файле **контролманифест. input. XML** .
3. Скопируйте все остальные ресурсы периферийных компонентов, такие как CSS, RESX или IMG, в соответствующую вложенную папку из старого проекта в новый проект.

## <a name="updating-manifest-file"></a>Обновление файла манифеста

Файл `ControlManifest.xml`, который определяет свойства компонента кода, заменяется `ControlManifest.Input.xml`ным файлом. В противном случае в схеме между двумя файлами должно быть очень мало изменений.

Но существует несколько важных семантических изменений:

1. Теперь запись ресурса `code` должна указывать на предкомпилированный исходный файл компонента кода. Имя файла по умолчанию — **index. TS**.

   Например, если источник компонента реализован в файле с именем `MyControl.ts`, запись `code` в `ControlManifest.Input.xml` должна указывать на этот файл. Файл `code` также должен быть допустимым файлом TypeScript. Это отличается от устаревших файлов манифеста, которые задают файл выходных данных скомпилированного JS-файла в записи `code`.
2. Атрибут `path` элемента Resource, например `code` или `css`, теперь ссылается на локальный путь к файлу на диске. Пример.

    ```XML
   <resources>
    <css path="css/YourControlName" order="1"/>
    </resources>
    ```

Приведенный выше атрибут `path` указывает, что файл `YourControlName.css` находится в папке `css`, относительно текущего каталога, в котором находится `ControlManifest.Input.xml` на диске.

Обновите файлы Контролманифест. input. XML следующим образом:

1. Измените запись `code` в `ControlManifest.Input.xml` на предкомпилированный исходный файл компонента кода (обычно index. TS).
2. Измените все пути к ресурсам, чтобы они правильно ссылались на относительные пути к файлам на диске.

## <a name="updating-the-project-files"></a>Обновление файлов проекта

Если вы создали компонент, используя более старую версию средств, и хотите воспользоваться преимуществами новейших возможностей, обязательно обновите файлы проекта, как показано ниже:

1. Обновите существующие проекты, чтобы использовать последние модули.
 
   - Обновите тег Version в `pcfproj`, расположенном в папке проекта платформы компонентов PowerApps, следующим образом:

      ```XML
      <Packagereference Include="Microsoft.PowerApps.MSBuild.Pcf" Version="1.*"/>
      ```
   - Обновите тег Version в `cdsproj`, расположенном в папке проекта решения, следующим образом:

      ```XML
      <Packagereference Include="Microsoft.PowerApps.MSBuild.Solution" Version="1.*"/>
      ```

      > [!NOTE] 
      > После внесения описанных выше изменений выполните команду `msbuild /t:restore`, чтобы обновить проект до нужной версии.


   - Обновите тег Version в файле `package.json`, расположенном в папке проекта платформы компонентов PowerApps:

      ```JSON
      "devDependencies":{
       "pcf-scripts": "^1",
       "pcf-start": "^1"
          }
      ```
     > [!NOTE]
     > После внесения описанных выше изменений выполните команду `npm update`, чтобы обновить проект до нужной версии.

2. Если профиль проверки подлинности был создан ранее, его необходимо создать заново. Это связано с тем, что в профиль было добавлено новое свойство для поддержки облака, не являющегося общедоступным. Это можно сделать, выполнив следующие действия.
 
    - Выполнение команды `pac auth clear`.
    - Выполнение команды `pac auth create --url <your org url>`.

## <a name="updating-your-project-with-the-latest-node-modules"></a>Обновление проекта с помощью последних модулей node

Для использования новейших возможностей интерфейса командной строки устаревшие проекты должны получать последние модули NPM. Чтобы обновить ранее скачанные модули узлов, перейдите в каталог проекта в командной строке разработчика и выполните команду `npm update`. 

## <a name="using-es6-module-syntax"></a>Использование синтаксиса модуля ES6

Средства сборки предполагают, что источник компонента будет экспортирован с использованием стандартного формата модуля ES6. Устаревшие компоненты обычно экспортируются как внутренние модули (также называемые пространствами имен). Исходный файл компонента необходимо изменить, как показано ниже, чтобы согласовать с новыми инструментами сборки.

1. Откройте исходный файл, реализующий компонент кода (например, index. TS).
2. Используйте стандартный синтаксис экспорта ES6, удалив объявление модуля.

     Для
     ```TypeScript
     module SampleNamespace
     {
    export class TSLinearInputControl implements ComponentFramework.StandardControl<InputsOutputs.IInputBag, InputsOutputs.IOutputBag> {
          <your class implementation>
           }
            }
     
      ```
    Запуска
    ```TypeScript
     export class YourControlName implements ComponentFramework.StandardControl<IInputs, IOutputs> { 
          <your class implementation>
          }
   ```

## <a name="using-generated-manifest-typing-file"></a>Использование созданного файла с вводом манифеста

Проекты предыдущих версий должны вручную создавать и изменять файл ввода `inputsOutputs.d.ts`, который обычно находится в подпапке `private_typing`. Теперь средство CLI для PowerApps автоматически создает этот файл при сборке. 

Код — это гарантирует, что определения `type`, используемые в исходном коде компонента, остаются синхронизированными с `types`, определенным в файле манифеста компонента.

Типизированный файл переименовывается в `ManifestTypes.d.ts` и теперь создается во вложенной папке с именем `generated`. Кроме того, типы `InputsOutputs.IInputBag` и `InputsOutputs.IOutputBag` переименованы в `IInputs` и `IOutputs` соответственно.

Чтобы использовать новый файл ввода:

1. Импортируйте новый файл `ManifestTypes.d.ts`, добавив следующую строку в начало исходного файла компонента:

    Импортируйте {Иинпутс, Иаутпутс} из `./generated/ManifestTypes`.
2. Переименуйте все ссылки на **инпутсаутпутс. иинпутбаг** в **иинпутс**.
3. Переименуйте все ссылки на **инпутсаутпутс. иаутпутбаг** в **иаутпутс**.
4. Постройте проект, чтобы создать новый файл **манифесттипес. d. TS** с помощью команды `npm run build`.

## <a name="troubleshooting-and-workarounds"></a>Устранение неполадок и способы их устранения

1. Если вы получаете уведомление 1ES с вопросом о том, как используются сценарии PCF, обратите внимание, что эти сценарии используются только для сборки компонентов кода, но не упакованы и не используются в результирующем компоненте.  
2. Если вы ранее создали компонент кода с помощью инструментария 0.1.817.1 или более ранней версии и хотите убедиться, что используются последние модули сборки и отладки, внесите обновления в Package. JSON, как показано ниже.
   
    ```JSON
     "dependencies": { "@types/node": "^10.12.18", "@types/powerapps-component-framework": "1.1.0"}, "devDependencies": { "pcf-scripts": "~0", "pcf-start": "~0" } 
    ```
3. Пользователь получает сообщение об ошибке `Failed to retrieve information about Microsoft.PowerApps.MSBuild.Pcf from remote source <Feed Url>` при сбое сборки для проблем авторизации. Ниже приведено решение этой проблемы.

   - Откройте файл NuGet. config из **%аппдата%\нужет**. В этом файле должна присутствовать веб-канал, из которого пользователь получает ошибку. 
   - Удалите веб-канал из файла NuGet. config или создайте токен PAT и добавьте его в файл NuGet. config. Пример.

     ```XML
     <?xml version="1.0" encoding="utf-8"?>  
     <configuration>  
     <packageSources>  
         <add key="CRMSharedFeed" value="https://dynamicscrm.pkgs.visualstudio.com/_packaging/CRMSharedFeed/nuget/v3/index.json" />  
      </packageSources>  
     <packageSourceCredentials>  
      <CRMSharedFeed>  
      <add key="Username" value="anything" />  
      <add key="Password" value="User PAT" />  
    </CRMSharedFeed>  
     </packageSourceCredentials>  
   </configuration>
     ```

### <a name="see-also"></a>См. также

[Ограничения платформы компонентов PowerApps](limitations.md)<br/>
[Справочник по API инфраструктуры компонентов PowerApps](reference/index.md)<br/>
[Обзор платформы компонентов PowerApps](overview.md)
