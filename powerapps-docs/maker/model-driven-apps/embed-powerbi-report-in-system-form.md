---
title: Встраивание отчета Power BI в управляемую моделью системную форму | MicrosoftDocs
ms.custom: ''
ms.date: 03/05/2019
ms.reviewer: matp
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: get-started-article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - PowerApps
ms.assetid: 99c795e0-9165-4112-85b1-6b5e1a4aa5ec
caps.latest.revision: 1
author: prsi-msft
ms.author: prsi
manager: kvivek
tags:
  - Links to topic not migrated
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---

# <a name="embed-a-power-bi-report-in-a-model-driven-system-form"></a>Встраивание отчета Power BI в управляемую моделью системную форму
Можно использовать отчеты Power BI в управляемых моделью приложениях PowerApps, чтобы обеспечить широкие возможности отчетности и аналитики в системных формах и позволить пользователям добиваться большего. Это разблокирует возможность агрегирования данных между системами и их настройки вплоть до контекста одной записи.
 
## <a name="prerequisites"></a>Необходимые компоненты
Внедрение содержимого Power BI — это необязательная функция, которая по умолчанию отключена во всех средах. Необходимо включить ее, прежде чем можно будет внедрять содержимое Power BI. Дополнительные сведения: [Включение визуализации Power BI в организации](https://docs.microsoft.com/dynamics365/customer-engagement/admin/use-power-bi?#enable--visualizations-in-the-organization).

Эта функция требует экспортировать решение, изменить его для добавления фрагмента xml, а затем импортировать обратно в среду. Обязательно импортируйте изменения в целевую среду только через управляемое решение. См. раздел [Импорт, обновление и экспорт решений](https://docs.microsoft.com/powerapps/maker/common-data-service/import-update-export-solutions) для получения инструкций по установке обновления существующего управляемого решения.

## <a name="embed-without-contextual-filtering"></a>Внедрение без контекстной фильтрации
Можно использовать отчеты и плитки Power BI просто внедряя их и получать точно такой же отчет. Это не предполагает их контекстную настройку для текущей управляемой моделью формы, поэтому вы получаете такой же отчет или плитку на всех записях сущности. Например, в следующем отчет отображается географическое расположение всех организаций сразу, что удобно для отображения сводной информации.

> [!div class="mx-imgBorder"] 
> ![](media/embed-powerbi/embed-powerbi-report-in-system-form-unfiltered.png "Внедрение-отчета-powerbi-в-системную-форму-нефильтрованный")

Можно внедрить раздел, в котором размещены отчеты и плитки Power BI в системных формах путем добавления следующего фрагмента кода внутрь блока `<sections>` XML-кода формы. Затем импортируйте решение в целевую среду. 

```xml
<section id="{d411658c-7450-e1e3-bc80-07021a04bcc2}" locklevel="0" showlabel="true" IsUserDefined="0" name="tab_4_section_1" labelwidth="115" columns="1" layout="varwidth" showbar="false">
    <labels>
        <label languagecode="1033" description="Unfiltered Power BI embedding demo"/>
    </labels>
    <rows>
        <row>
            <cell id="{7d18b61c-c588-136c-aee7-03e5e74a09a1}" showlabel="true" rowspan="20" colspan="1" auto="false">
                <labels>
                    <label languagecode="1033" description="Accounts (Parent Account)"/>
                </labels>
                <control id="unfilteredreport" classid="{8C54228C-1B25-4909-A12A-F2B968BB0D62}">
                    <parameters>
                        <PowerBIGroupId>00000000-0000-0000-0000-000000000000</PowerBIGroupId>
                        <PowerBIReportId>544c4162-6773-4944-900c-abfd075f6081</PowerBIReportId>
                        <TileUrl>https://xyz.powerbi.com/reportEmbed?reportId=544c4162-6773-4944-900c-abfd075f6081</TileUrl>
                    </parameters>
                </control>
            </cell>
        </row>
        <row/>
    </rows>
</section>
```
> [!IMPORTANT]
> Необходимо использовать элемент управления `classid="{8C54228C-1B25-4909-A12A-F2B968BB0D62}"`, как указано в примере XML.

 В этой таблице описываются свойства в предыдущем примере.

|                                                 Свойство                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                         **PowerBIGroupId**                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Идентификатор рабочей области Power BI. Рабочая область пользователя по умолчанию всегда 00000000-0000-0000-0000-000000000000. Можно проверить идентификатор любой рабочей области, посмотрев его URL-адрес. Например: https://xyz.powerbi.com/groups/0ddbe381-256d-44bc-93de-34e47f3d9ab4/.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                               **PowerBIReportId**                                |                             Идентификатор отчета Power BI. Замените его отчетом, который требуется внедрить. Можно проверить идентификатор любого отчета, посмотрев его URL-адрес. Например: https://xyz.powerbi.com/groups/me/reports/544c4162-6773-4944-900c-abfd075f6081.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                       **TileUrl**                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        URL-адрес отчета или плитки Power BI, которые требуется внедрить. Необходимо использовать правильное имя экземпляра Power BI (замените msit.powerbi.com вашим собственным) и идентификатор отчета (замените reportId=544c4162-6773-4944-900c-abfd075f6081 вашим собственным). Например: https://xyz.powerbi.com/reportEmbed?reportId=544c4162-6773-4944-900c-abfd075f6081.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

## <a name="embed-with-contextual-filtering"></a>Внедрение с контекстной фильтрацией
Можно сделать отчеты и плитки Power BI более полезными, применив контекстные фильтры к текущей управляемой моделью форме, чтобы фильтровать отчет или плитку на основе атрибутов текущей записи. Например, следующий отчет показывает географическое расположение организации путем фильтрации отчета Power BI с помощью названия организации. Это позволяет в одном отчете отображать контекстную информацию для всех записей сущности.

> [!div class="mx-imgBorder"] 
> ![](media/embed-powerbi/embed-powerbi-report-in-system-form-filtered.png "Внедрение-отчета-powerbi-в-системную-форму-фильтрованный")

Фильтрация выполняется добавлением элемента `<PowerBIFilter>` в блок `<parameter>`, как показано ниже. Можно использовать любой атрибут формы сущности для формирования выражения фильтра. Дополнительные сведения: [Конструирование фильтров](https://github.com/Microsoft/PowerBI-JavaScript/wiki/Filters#contructingfilters), чтобы понять, как создавать собственные фильтры.
    
```xml
<control id="filteredreport" classid="{8C54228C-1B25-4909-A12A-F2B968BB0D62}">
    <parameters>
        <PowerBIGroupId>00000000-0000-0000-0000-000000000000</PowerBIGroupId>
        <PowerBIReportId>544c4162-6773-4944-900c-abfd075f6081</PowerBIReportId>
        <TileUrl>https://xyz.powerbi.com/reportEmbed?reportId=544c4162-6773-4944-900c-abfd075f6081</TileUrl>
        <PowerBIFilter>{"Filter": "[{\"$schema\":\"basic\",\"target\":{\"table\":\"My Active Accounts\",\"column\":\"Account Name\"},\"operator\":\"In\",\"values\":[$a],\"filterType\":1}]", "Alias": {"$a": "name"}}</PowerBIFilter>
    </parameters>
</control>
```

Обратите внимание, что при этом используется тот же элемент управления, что и при внедрении нефильтрованного отчета, поэтому идентификатор класса элемента управления остался неизменным. 

В этой таблице описываются все дополнительные свойства, используемые в предыдущем примере.

|                                                 Свойство                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                         **PowerBIFilter**                          |        Выражение фильтра, которое задает контекст отчета Power BI, передавая атрибуты формы в виде параметров. Чтобы сделать его более читаемым, фильтр формируется, как показано ниже.    |

    {
            "Filter": "[{
                    \"$schema\":\"basic\",
                    \"target\":{
                            \"table\":\"My Active Accounts\",
                            \"column\":\"Account Name\"
                    },
                    \"operator\":\"In\",
                    \"values\":[$a, $b],
                    \"filterType\":1
            }]",
            "Alias": {
                    "$a": "firstname",
                    "$b":"lastname"
            }
    }

Целевая часть предыдущего выражения определяет таблицу и столбец для применения фильтров. Оператор определяет логику, а значения определяют данные, передаваемые из управляемого моделью приложения PowerApps. Чтобы выполнить параметризацию общим способом, значения формируются с помощью псевдонимов. В предыдущем выражении передаются значения **firstname** и **lastname** организации, и любое из них ищется в столбце **Название организации** в отчете Power BI. Обратите внимание, что **firstname** и **lastname** являются уникальными именами атрибутов сущности организации, значения которых будут переданы здесь. 

Можно создать более сложные выражения фильтра, ознакомившись с примерами из раздела [Формирование фильтров](https://github.com/Microsoft/PowerBI-JavaScript/wiki/Filters#contructingfilters) и указав соответствующие значения для параметров $schema и filterType. Обязательно добавляйте к каждому литералу в части фильтрации символ *\"*, чтобы JSON создавался правильно.

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения
1. Эта интеграция доступна только в клиенте единого интерфейса в поддерживаемых веб-браузерах и на мобильных устройствах.
2. При открытие этой формы в конструкторе форм PowerApps этот элемент управления не будет отображаться содержательным образом. Это связано с тем, что элемент управления был настроен вне конструктора форм.
3. Пользователи будут проходить проверку подлинности в Power BI автоматически со своим именем пользователя и паролем PowerApps. Если организация Power BI с соответствующими учетными данными не существует, отображается приглашение для входа, как показано ниже. 

   > [!div class="mx-imgBorder"] 
   > ![](media/embed-powerbi/embed-powerbi-report-in-system-form-auth-1.png "Внедрение-отчета-powerbi-в-системную-форму-проверка-подлинности-1")

4. Никакие данные не отображаются, если неправильная организации используется для входа в Power BI. Чтобы выполнить вход с использованием правильных учетных данных, выйдите, затем выполните вход снова.

   > [!div class="mx-imgBorder"] 
   > ![](media/embed-powerbi/embed-powerbi-report-in-system-form-auth-2.png "Внедрение-отчета-powerbi-в-системную-форму-проверка-подлинности-2")

   > [!div class="mx-imgBorder"] 
   > ![](media/embed-powerbi/embed-powerbi-report-in-system-form-auth-3.png "Внедрение-отчета-powerbi-в-системную-форму-проверка-подлинности-3")

5. Вид данных отчета, отображаемого в PowerApps, такой же, как вид в Power BI, и роли безопасности и прав PowerApps не влияют на отображаемые данные. Следовательно, данные в целом те же, что и те, которые увидел бы создатель набора данных Power BI. Для применения ограничений доступа к данным, аналогичных ролям безопасности и группам PowerApps, используйте [Безопасность на уровне строки (RLS) с помощью Power BI](https://docs.microsoft.com/power-bi/service-admin-rls).
6. Если форма не отображает отчет Power BI после импорта решения и публикации настроек, откройте его в редакторе управляемых моделью форм и сохраните его, чтобы JSON формы был сформирован заново.


### <a name="see-also"></a>См. также

[Внедрение панели мониторинга Power BI в управляемую моделью персональную панель мониторинга PowerApps](https://docs.microsoft.com/dynamics365/customer-engagement/basics/add-edit-power-bi-visualizations-dashboard)

[Использование Power BI с Dynamics 365 for Customer Engagement](https://docs.microsoft.com/dynamics365/customer-engagement/admin/use-power-bi)

[Импорт, обновление и экспорт решений](../common-data-service/import-update-export-solutions.md)
