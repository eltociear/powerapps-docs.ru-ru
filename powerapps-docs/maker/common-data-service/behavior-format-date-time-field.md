---
title: Поведение и формат поля "Дата и время" в Common Data Service | MicrosoftDocs
ms.custom: ''
ms.date: 05/25/2018
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.assetid: 73d691c7-344e-4c96-8979-c661c290bf81
caps.latest.revision: 47
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: d89f040bf7030706f9f7288021249e3b78dcd3e5
ms.sourcegitcommit: 9f2694bd14d70798310b89a4673672c1bfad989d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "3167073"
---
# <a name="behavior-and-format-of-the-date-and-time-field"></a>Поведение и формат поля "Дата и время"

В Common Data Service тип данных "Дата и время" используется во многих полях стандартных сущностей. В зависимости от типа даты, который представляет поле, можно выбрать различные поведения поля: **Часовой пояс пользователя**, **Только дата** или **Независимо от часового пояса**.  
  
<a name="Behavior"></a>   

## <a name="date-and-time-field-behavior-and-format"></a>Поведение и формат поля "Дата и время"  

В следующей таблице приведены сведения о поведении и формате поля "Дата и время".  
  
|Поведение|Формат|Описание|  
|--------------|------------|-------------------------------|  
|**Часовой пояс пользователя** |**Только дата**<br />- или -<br />**Дата и время**|Это поведение по умолчанию для настраиваемых полей даты и времени.<br /><br />Значения полей отображаются по местному времени текущего пользователя.<br />В веб-службах эти значения возвращаются в общем формате часового пояса UTC.<br /><br />Это можно изменить, если выбрать поведение по умолчанию. Дополнительные сведения: [Изменение поведения часового пояса пользователя](#change-user-local-behavior)|  
|**Только дата**|**Только дата**|Без преобразования часового пояса.<br /><br />Часть "время" в значении всегда равна 12:00.<br />Часть "дата" значения хранится и извлекается так, как указано в пользовательском интерфейсе и в веб-службах.|  
|**Независимо от часового пояса**|**Только дата**<br />- или -<br />**Дата и время**|Без преобразования часового пояса.<br /><br />Значения даты и времени хранятся и извлекаются так, как указано в пользовательском интерфейсе и в веб-службах.|  

## <a name="change-user-local-behavior"></a>Измените поведение часового пояса пользователя:

Если только издатель управляемого решения не запрещает это, вы можете изменить поведение существующих настраиваемых полей "Дата" с **Часовой пояс пользователя** на **Только дата** или **Независимо от часового пояса**. Это разовое изменение.

Изменение поведение поля влияет на значения полей, добавляемые или изменяемые после изменения поведения. Существующие значения полей остаются в базе данных в формате UTC. Чтобы изменить поведение существующих значений полей с UTC на "Только дата", может понадобиться прибегнуть к помощи разработчика для программной реализации этого изменения. Дополнительные сведения: [Преобразование поведения существующих значений даты и времени в базе данных](/dynamics365/customer-engagement/developer/behavior-format-date-time-attribute#convert-behavior-of-existing-date-and-time-values-in-the-database). 

> [!WARNING]
> Прежде чем изменять поведение существующего поля "Дата и время", необходимо проверить все зависимости поля, такие как бизнес-правила, бизнес-процессы, вычисляемые поля или поля свертки, чтобы убедиться в том, что изменение поведения не приведет к возникновению проблем. После изменения поведения поля "Дата и время" необходимо открыть каждое бизнес-правило, бизнес-процесс, вычисляемое поле и поле свертки, зависящее от измененного поля, проверить информацию и сохранить его, чтобы зависимое поле отражало новое поведение и значение поля "Дата и время". 

### <a name="change-behavior-during-a-solution-import"></a>Изменение поведения при импорте решения

При импорте решения, содержащего поле "Данные", с помощью поведения **Часовой пояс пользователя**, вы можете изменить поведение на **Только дата** или **Независимо от часового пояса**.  

### <a name="prevent-changing-behavior"></a>Предотвращение изменения поведения

При распространении настраиваемого поля даты в управляемом решении можно запретить пользователям решения изменять поведение, задав для управляемого свойства **CanChangeDateTimeBehavior** значение **False**. Дополнительные сведения: [Задание управляемых свойств для полей](set-managed-properties-for-field.md)
  
## <a name="use-cases"></a>Случаи использования 

Рассмотрите возможность следующих случаев использования поведений **Только дата** и **Независимо от часового пояса**.

### <a name="date-only-scenario-birthdays-and-anniversaries"></a>Сценарий "Только дата": дни рождения и годовщины

Поведением "Только дата" удобно пользоваться в случаях, когда информация о времени и часовом поясе не нужна, — например, для дней рождения или годовщин. При этом поведении все пользователи приложения по всему миру будут видеть в точности одно и то же значение даты.  
  
### <a name="time-zone-independent-scenario-hotel-check-in"></a>Сценарий "Независимо от часового пояса": заселение в гостиницу

Это поведение можно использовать, когда информация о часовом поясе не нужна, — например, для указания времени заселения в гостиницу. При этом поведении все пользователи приложения по всему миру будут видеть в точности одно и то же значение даты и времени.  


## <a name="best-practices-for-using-time-zone"></a>Лучшие практики для использования часового пояса

### <a name="for-my-datetime-field-i-was-expecting-utclocal-and-i-am-seeing-the-opposite-value"></a>Для моего поля Дата/время я ожидал (UTC/Местное), а я вижу противоположное значение

Это вызвано отсутствием паритета между настройкой поля сущности и настройкой формы приложения. Когда поле сущности настроено на "Независимо от часового пояса" или "Часовой пояс пользователя", оно определяет, соблюдается ли смещение часового пояса при извлечении данных из хранилища. Тем не менее, форма приложения также имеет настройку UTC или Местное. 
 
Это говорит форме, как интерпретировать данные, которые она получает от Common Data Service. Если данные, извлеченные из хранилища, не зависят от часового пояса, но форма установлена на местное время, данные UTC будут отображаться как местное время пользователя на основе часового пояса пользователя в их профиле. Обратное также верно, часовой пояс пользователя из хранилища будет отображаться как UTC, если для формы установлено UTC. К счастью, значения часового пояса в форме даты можно изменить, не нарушая существующие записи.

### <a name="i-picked-date-only-in-my-entity-field-but-my-form-is-showing-a-time-picker-along-with-the-date"></a>Я выбрал "Только дата" в поле сущности, но в моей форме отображается средство выбора времени и даты

Это произойдет, если вы выберете поведение, не зависящее от часового пояса, или часовой пояс пользователя для вашего поля "Только дата". В Common Data Service по умолчанию будет храниться время 00:00:00, но если вы добавите поле в форму, оно будет предполагать, что вам также нужно установить время. Если вы оставите средство выбора времени в форме, пользователи смогут ввести время, и оно будет сохранено как отличное от 00:00:00. Как можно это исправить?
* Отредактируйте форму и удалите средство выбора времени и соответствующие формулы. Это сохранит время как 00:00:00 и все еще позволит рассчитывать дату на основе часового пояса.
* Если ваше поле в настоящий момент установлено как часовой пояс пользователя, и вам не требуется рассчитывать дату для часового пояса, вы можете изменить ее на "Только дата". Этот перманентное изменение и не может быть отменено. Это изменение нельзя внести в поля независимого от часового пояса поведения. Всегда будьте осторожны при изменении поведения, так как другие приложения, плагины или бизнес-процессы могут полагаться на данные.

### <a name="i-have-a-date-only-field-but-it-is-showing-the-wrong-date-for-some-users"></a>У меня есть поле "Только дата", но оно показывает неправильную дату для некоторых пользователей
Если это происходит, проверьте поведение, заданное для поля "Только дата". Если для поля установлено значение "Независимо от часового пояса" или "Часовой пояс пользователя", включенная метка времени приведет к тому, что дата будет отображаться по-разному для разных пользователей. Настройки отображения формы для UTC или "Местное" определят, будет ли отображаемая дата рассчитываться с использованием настроек часового пояса пользователя или она будет отображаться как значение UTC. Изменение значений формы на UTC вместо "Часовой пояс пользователя" предотвратит вычисления смещения часового пояса и отобразит дату UTC для сохраненной записи. Кроме того, если вам нужно, чтобы это была статическая дата, которая не изменяется, и поле в данный момент установлено на "Часовой пояс пользователя", вы можете изменить поведение поля на "Только дата". Будьте осторожны, это не может быть отменено.

### <a name="my-scriptplug-in-is-supposed-to-intercept-the-date-submitted-using-the-universal-client-before-the-user-local-conversion-occurs-but-instead-it-is-being-treated-as-user-local-data"></a>Мой (скрипт/плагин) должен перехватывать дату, отправленную с помощью универсального клиента, прежде чем произойдет преобразование часовой пояс пользователя, но вместо этого он обрабатывается как данные часового пояса пользователя 

Веб-клиент и универсальный клиент имеют немного разное поведение при переводе данных между UTC и "Часовой пояс пользователя". В веб-клиенте даты вводятся в клиент, передаются в API в исходном виде, и затем преобразуются в местное время пользователя. Это позволило скриптам/плагинам извлекать данные и предпринимать действия до того, как данные будут переданы службам платформы и переведены в местное время пользователя. В универсальном клиенте преобразование даты в значения часового пояса пользователя происходит до того, как данные передаются в API, поэтому предоставленные данные будут не датой UTC, а датой в часовом поясе пользователя на основе пользователя, который извлек или отправил это. Чтобы решить эту проблему, пользователь может:

* Измените форму на независимую от часового пояса, что сохранит значение UTC. Это работает только в том случае, если пользователю не нужна форма для отображения по времени в часовом поясе пользователя.
* Измените их скрипт, чтобы определить используемое смещение часового пояса, пересчитать обратно в UTC в скрипте, а затем принять меры.

## <a name="date-and-time-query-operators-not-supported-for-date-only-behavior"></a>Операторы запроса даты и времени, не поддерживаемые для поведения "Только дата"  

Следующие операторы, связанные с запросами даты и времени, не работают для поведения **Только дата**. При использовании в запросе одного из этих операторов создается ошибка с исключением "недействительный оператор".  
  
- Старше X минут  
- Старше X часов  
- Последние X часов  
- Следующие X часов  

  
### <a name="see-also"></a>См. также

[Создание и изменение полей](create-edit-fields.md)<br />
[Определение вычисляемых полей для автоматизации ручных расчетов](define-calculated-fields.md)<br />
[Управляемые свойства полей](set-managed-properties-metadata.md#view-and-edit-field-managed-properties)<br />
[Управляемые свойства](solutions-overview.md#managed-properties)  
[Блог: Работа с часовыми поясами в Common Data Service](https://powerapps.microsoft.com/en-us/blog/working-with-time-zones-in-the-common-data-service/)


