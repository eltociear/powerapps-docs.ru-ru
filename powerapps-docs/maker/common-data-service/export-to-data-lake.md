---
title: Экспорт в Data Lake | MicrosoftDocs
description: Узнайте, как экспортировать данные сущностей в Azure Data Lake в Power Apps
ms.custom: ''
ms.date: 01/28/2020
ms.reviewer: Mattp123
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- powerapps
author: sabinn-msft
ms.assetid: ''
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 6adf35a76df347ca8a99bd12620e7beea4b403d5
ms.sourcegitcommit: 97a36c9df2a7067a29fb6bd254975dadc2bc16fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "3072879"
---
# <a name="export-entity-data-to-azure-data-lake-storage-gen2"></a>Экспорт данных сущности в Azure Data Lake Storage 2-го поколения

Служба экспорта в Data Lake — это конвейер для непрерывного экспорта данных из Common Data Service в Azure Data Lake Storage 2-го поколения. Служба экспорта в Data Lake предназначена для анализа больших данных предприятий, обеспечивая масштабируемую высокую доступность и возможности аварийного восстановления. Данные хранятся в формате Common Data Model, который обеспечивает семантическую согласованность между приложениями и развертываниями. 

![Обзор экспорта в Data Lake](media/export-data-lake-overview.png "Обзор экспорта в Data Lake")

Экспорт в Data Lake предоставляет следующие возможности: 

- Связывание или отмена связи среды Common Data Service с Data Lake Storage 2-го поколения в вашей подписке Azure. 
- Непрерывная репликация сущностей в Data Lake Storage 2-го поколения.
- Начальная запись с последующей добавочной записью для данных и метаданных. 
- Репликация как стандартных, так и пользовательских сущностей. 
- Репликация транзакций создания, обновления и удаления (CrUD). 
- Постоянные обновления снимков для больших аналитических сценариев. 
- Облегчение обнаружения метаданных и взаимодействия между производителями и потребителями данных, такими как Power BI, Azure Data Factory, Azure Databricks и Azure Machine Learning.

## <a name="how-data-and-metadata-are-exported"></a>Как данные и метаданные экспортируются

Служба экспорта в Data Lake поддерживает начальную и инкрементную запись данных и метаданных сущностей. Любые изменения данных или метаданных в Common Data Service автоматически помещаются в Data Lake без каких-либо дополнительных действий. Это скорее операция выталкивания, чем вытягивания. Изменения передаются получателю без необходимости устанавливать интервалы обновления. 

Как стандартные, так и пользовательские сущности могут быть экспортированы. Обратите внимание, что атрибут сущности отслеживания изменений в Common Data Service используется для эффективной синхронизации данных путем определения того, какие данные изменились с момента их первоначального извлечения или последней синхронизации. 

Все операции создания, обновления, удаления экспортируются из Common Data Service в Data Lake. Например, когда пользователь удаляет запись сущности организации в Common Data Service, транзакция реплицируется в Data Lake назначения.

## <a name="prerequisites"></a>Предварительные условия

Прежде чем экспортировать данные Common Data Service в Data Lake, необходимо создать и настроить учетную запись хранения Azure Storage V2 (версия 2 общего назначения). 

Следуйте инструкциям в статье  [Создание учетной записи хранилища Azure](/azure/storage/blobs/data-lake-storage-quickstart-create-account)  и обратите внимание на следующие требования: 

- Вам должна быть предоставлена роль владельца в учетной записи хранения. 
- Установите тип хранения как **Storagev2 (общего назначения v2)**. 
- Учетная запись хранения должна иметь включенную функцию **Иерархическое пространство имен**. 

 Рекомендуется установить для параметра репликации значение геоизбыточного хранилища с доступом для чтения (RA-GRS). Дополнительная информация: [Геоизбыточное хранилище с доступом для чтения](/azure/storage/common/storage-redundancy-grs#read-access-geo-redundant-storage)

>   ![Свойства учетной записи хранения](media/storage-account-properties.png "Свойства учетной записи хранения")

> [!NOTE]
> - Учетная запись хранения необходимо создавать в том же клиенте Azure Active Directory (Azure AD), что и ваш клиент Power Apps.  
> - Учетная запись хранения должна быть создана в том же регионе, что и среда Power Apps, в которой вы планируете использовать эту функцию.  
> - Чтобы связать среду Common Data Service с Azure Data Lake Storage 2-го поколения, вы должны быть администратором Common Data Service. 
> - Только сущности, для которых включено отслеживание изменений, можно экспортировать. 

## <a name="select-and-export-common-data-service-entity-data-to-azure-data-lake-storage-gen2"></a>Выбор и экспорт данных сущности Common Data Service в Azure Data Lake Storage 2-го поколения

1. Войдите в [Power Apps](https://make.powerapps.com/?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc), разверните пункт **Данные**, затем выберите **Сущности**. 
2. На панели команд выберите **Экспорт в Data Lake**, затем на странице **Экспорт в Data Lake** выберите **Новая ссылка на Data Lake**. 
3. Выберите каждый из следующих параметров, затем выберите **Далее**: 
   - **Подписка**. Выберите свою подписку Azure. 
   - **Группа ресурсов**. Выберите группу ресурсов, содержащую учетную запись хранения Storage v2 (версия 2 общего назначения).
   - **Учетная запись хранения**. Выберите учетную запись хранения Storage v2 (версия 2 общего назначения), которую требуется использовать для экспорта. 
4. Выбрать сущности, которые требуется экспортировать в Data Lake, затем выберите **Сохранить**. Только сущности, для которых включено отслеживание изменений, можно экспортировать. Дополнительные сведения: [Включение отслеживания изменений](/dynamics365/customer-engagement/admin/enable-change-tracking-control-data-synchronization)

   > [!div class="mx-imgBorder"] 
   > ![Выберите сущности для экспорта](media/export-data-lake-select-entity.png "Выберите сущности для экспорта")

Ваша среда Common Data Service связана с учетной записью Azure Data Lake Storage 2-го поколения. Файловая система в учетной записи хранения Azure создается с папкой для каждой сущности, выбранной для репликации в Data Lake. 

## <a name="manage-entity-data-to-the-data-lake"></a>Управление данными сущностей в Data Lake

После настройки экспорта данных в Azure Data Lake Storage 2-го поколения в своей подписке вы можете управлять экспортом данных сущностей в Data Lake данных одним из двух способов: 

- На портале создателя Power Apps в области **Экспорт в Data Lake** выберите **Управление сущностями** на панели команд, чтобы добавить или удалить одну или несколько связанных сущностей.
- На портале создателей Power Apps в области **Сущности** выберите **...** рядом с сущностью, затем выберите связанное Data Lake, куда вы хотите экспортировать данные сущности. 

   ![Выберите сущность для экспорта](media/select-entity-export.png "Выберите сущность для экспорта")

Чтобы отменить связь всех связанных сущностей, на портале создателей Power Apps в области **Экспорт в Data Lake** выберите **Отменить связь с Data Lake**.

## <a name="view-your-data-in-azure-data-lake-storage-gen2"></a>Просмотр ваших данных в Azure Data Lake Storage 2-го поколения

1. Войдите в [Azure](https://portal.azure.com), выберите учетную запись хранения, затем на самой левой панели навигации выберите **Обозреватель службы хранилища**. 
2. Разверните узел **Файловые системы**, затем выберите commondataservice-*environmentName*-org-*Id*. 

Файл model.json, наряду с его именем и версией, предоставляет список сущностей, которые были экспортированы в Data Lake. Файл model.json также содержит начальный статус синхронизации и время завершения синхронизации. 

Отображается папка, которая включает в себя файлы формата (CSV) моментального снимка, для каждой сущности, экспортированной в Data Lake.
   > [!div class="mx-imgBorder"] 
   > ![Данные сущности в Data Lake](media/entity-data-in-lake.png "Данные сущности в Data Lake") 

### <a name="continuous-snapshot-updates"></a>Постоянные обновления снимков

Данные Common Data Service могут непрерывно изменяться посредством транзакций создания, обновления и удаления. Снимки предоставляют доступную только для чтения копию данных, которая обновляется через регулярные интервалы, в данном случае каждый час. Это гарантирует, что в любой данный момент потребитель данных аналитики может надежно использовать данные в озере.

![Постоянные обновления снимков](media/snapshot-updates.png "Постоянные обновления снимков")

Когда сущности добавляются как часть первоначального экспорта, данные сущностей записываются в файлы entity.csv в соответствующих папках в Data Lake. Это интервал T1, где создается доступный только для чтения файл снимка с именем *сущность*-T1.csv, &mdash; например, Account-T1.csv или Contacts-T1.csv. Кроме того, файл model.json обновляется, чтобы указывать на эти файлы снимков. Открыв файл model.json, вы можете просмотреть детали снимка. 

Вот пример разделенного файла Account.csv и папки снимков в Data Lake.

![Снимок сущности организаций](media/export-data-lake-account-snapshots.png "Снимок сущности организаций") 

Изменения в Common Data Service непрерывно передаются в соответствующие файлы CSV с помощью механизма струйной подачи. Это интервал T2, где делается еще один снимок. Файлы *Сущность*-T2.csv, &mdash; например, Accounts-T2.csv или Contacts-T2.csv (в предположении, что изменения имеются в обеих сущностях) &mdash; и model.json обновляются с новыми файлами снимков. Любой новый человек, который просматривает данные снимка с T2 и далее, направляется на новые файлы снимков. Таким образом, исходный пользователь, просматривающий снимок, может продолжать работать с более старыми файлами снимков T1, в то время как новый просматривающий пользователь может читать последние обновления. Это полезно в сценариях с более длительными процессами в нисходящем направлении. 

Вот пример файла model.json, который всегда указывает на файл снимка организации с новейшей отметкой времени. 

![Пример файла снимка model.json](media/sample-snapshot-json.png "Пример файла снимка model.json") 

## <a name="transporting-an-export-to-data-lake-configuration-across-environments"></a>Перенос конфигурации экспорта в Data Lake между средами

В Power Apps решения используются для переноса приложений и компонентов из одной среды в другую или для применения набора настроек для существующих приложений. Чтобы конфигурации экспорта в Data Lake знали о решении, импортируйте в среду решение Export to Data Lake Core. Это обеспечивает базовые возможности управления жизненным циклом приложений (ALM), такие как распространение, резервное копирование и восстановление конфигурации экспорта в Data Lake. 

### <a name="import-the-export-to-data-lake-core-solution"></a>Импорт решения Export to Data Lake Core

1.  На портале создателя Power Apps выберите среду, в которой вы хотите распространять конфигурацию экспорта в Data Lake.
2.  На самой левой панели навигации выберите **Решения**, выберите **Открыть AppSource**, найдите решение с именем **Export to Data Lake Core** и импортируйте это решение.

### <a name="add-an-export-to-data-lake-configuration-to-a-solution"></a>Добавление конфигурации экспорта в Data Lake в решение

> [!IMPORTANT]
> Прежде чем вы сможете добавить конфигурацию экспорта в Data Lake, вы должны установить решение Export to Data Lake Core, описанное ранее. 

1.  На портале создателя Power Apps выберите среду, в которой вы хотите распространять конфигурацию экспорта в Data Lake, затем на самой левой навигационной панели выберите **Решения**. 
2.  Выберите **Создать решение**, укажите имя, выберите издателя и укажите номер версии.  
3.  Откройте решение, созданное на предыдущем шаге, выберите **Добавить существующее** > **Другое** > **Конфигурация экспорта в Data Lake**. 
4.  Выберите связанные конфигурации Data Lake, которые требуются, затем выберите **Добавить**. 
5.  В области **Решения**, выберите решение, затем на панели команд выберите **Экспорт**. 
6.  На панели **Прежде чем экспортировать**, выберите **Опубликовать**, чтобы опубликовать все изменения перед экспортом, затем выберите **Далее**. 

### <a name="import-the-solution-that-contains-the-export-to-data-lake-configuration"></a>Импорт решения, содержащего конфигурацию экспорта в Data Lake

В среде, в которую требуется импортировать решение, на портале создателя Power Apps в области **Решения** импортируйте решение. 

#### <a name="verify-the-export-to-data-lake-configuration"></a>Проверка конфигурации экспорта в Data Lake

На портале создателя Power Apps в среде, в которую вы импортировали конфигурацию экспорта в Data Lake, убедитесь, что вы видите свое связанное Data Lake в дополнение к сущностям, которые вы транспортировали из другой среды.

> [!div class="mx-imgBorder"] 
> ![Импортированные сущности экспорта в Data Lake](media/imported-export-entities.png "Импортированные сущности экспорта в Data Lake") 

### <a name="see-also"></a>См. также

[Блог: экспорт данных CDS в Azure Data Lake](https://powerapps.microsoft.com/blog/exporting-cds-data-to-azure-data-lake-preview/)
