---
title: Экспорт в Data Lake | MicrosoftDocs
description: Узнайте, как экспортировать данные сущностей в Azure Data Lake в Power Apps
ms.custom: ''
ms.date: 01/28/2020
ms.reviewer: Mattp123
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- powerapps
author: sabinn-msft
ms.assetid: ''
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 152fc65e69ccb728727f92ed77d6495f6dc5dcab
ms.sourcegitcommit: 303d5aed44f2bbb406cabeb6b9c8474d738d9114
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "3005293"
---
# <a name="export-entity-data-to-azure-data-lake-gen-2"></a>Экспорт данных сущностей в Azure Data Lake поколения 2

Служба экспорта в Data Lake — это конвейер для непрерывного экспорта данных из Common Data Service в Azure Data Lake 2-го поколения. Служба экспорта в Data Lake предназначена для анализа больших данных предприятий, обеспечивая масштабируемую высокую доступность и возможности аварийного восстановления. Данные хранятся в формате Common Data Model (CDM), который обеспечивает семантическую согласованность между приложениями и развертываниями. 

![Обзор экспорта в Data Lake](media/export-data-lake-overview.png)

Экспорт в Data Lake предоставляет следующие возможности: 
- Связывание или отмена связи среды Common Data Service с Data Lake 2-го поколения в вашей подписке Azure. 
- Непрерывная репликация сущностей в Azure Data Lake 2-го поколения.
- Начальная запись с последующей добавочной записью для данных и метаданных. 
- Репликация как стандартных, так и пользовательских сущностей. 
- Репликация транзакций создания, обновления и удаления. 
- Постоянные обновления снимков для больших аналитических сценариев. 
- Облегчение обнаружения метаданных и взаимодействия между производителями и потребителями данных, такими как Power BI, Azure Data Factory, Azure Databricks, and Azure Machine Learning service.

## <a name="how-data-and-metadata-are-exported"></a>Как данные и метаданные экспортируются
Служба экспорта в Data Lake поддерживает начальную и инкрементную запись данных и метаданных сущностей. Любые изменения данных или метаданных в Common Data Service автоматически помещаются в Data Lake без каких-либо дополнительных действий. Это скорее операция выталкивания, чем вытягивания. Изменения передаются получателю без необходимости устанавливать интервалы обновления. 

Как стандартные, так и пользовательские сущности могут быть экспортированы. Обратите внимание, что атрибут сущности отслеживания изменений в Common Data Service используется для эффективной синхронизации данных путем определения того, какие данные изменились с момента их первоначального извлечения или последней синхронизации. 

Все операции создания, обновления, удаления (CrUD) экспортируются из Common Data Service в Data Lake. Например, когда пользователь удаляет запись сущности организации в Common Data Service, транзакция реплицируется в Data Lake назначения.

## <a name="prerequisites"></a>Предварительные условия
Прежде чем экспортировать данные Common Data Service в Data Lake, необходимо создать и настроить учетную запись хранения Azure StorageV2 (общего назначения v2). 

Следуйте инструкциям в статье  [Создание учетной записи хранилища Azure](/azure/storage/blobs/data-lake-storage-quickstart-create-account)  и обратите внимание на следующие требования: 
- Вам должна быть предоставлена роль владельца в учетной записи хранения. 
- Установите тип хранения как **Storagev2 (общего назначения v2)**. 
- Учетная запись хранения должна иметь включенную функцию **Иерархическое пространство имен**. 
 - Рекомендуется установить для параметра репликации значение геоизбыточного хранилища с доступом для чтения (RA-GRS). Дополнительная информация: [Геоизбыточное хранилище с доступом для чтения](/azure/storage/common/storage-redundancy-grs#read-access-geo-redundant-storage) 
>   ![Свойства учетной записи хранения](media/storage-account-properties.png)

> [!NOTE]
> - Учетная запись хранения необходимо создавать в том же клиенте Azure AD, что и ваш клиент PowerApps.  
> - Учетная запись хранения должна быть создана в том же регионе, что и среда PowerApps, в которой вы планируете использовать эту функцию.  
>  - Чтобы связать среду Common Data Service с Azure Data Lake 2-го поколения вы должны быть администратором Common Data Service. 
>  - Только сущности, для которых включено отслеживание изменений, можно экспортировать. 


## <a name="select-and-export-common-data-service-entity-data-to-azure-data-lake-gen-2"></a>Выбор и экспорт данных сущностей Common Data Service в Azure Data Lake 2-го поколения
1. Войдите в [Power Apps](https://make.powerapps.com/?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc), разверните пункт **Данные**, затем выберите **Сущности**. 
2. На панели команд выберите **Экспорт в Data Lake**, затем на странице **Экспорт в Data Lake** выберите **Новая ссылка на Data Lake**. 
3. Выберите каждый из следующих параметров, затем выберите **Далее**: 
   - **Подписка**. Выберите свою подписку Azure. 
   - **Группа ресурсов**. Выберите группу ресурсов, содержащую учетную запись хранения Storagev2 (общего назначения v2).
   - **Учетная запись хранения**. Выберите учетную запись хранения Storagev2 (общего назначения v2), которую требуется использовать для экспорта. 
4. Выбрать сущности, которые требуется экспортировать в Data Lake, затем выберите **Сохранить**. Только сущности, для которых включено отслеживание изменений, можно экспортировать. Дополнительные сведения: [Включение отслеживания изменений](/dynamics365/customer-engagement/admin/enable-change-tracking-control-data-synchronization)

   > [!div class="mx-imgBorder"] 
   > ![Выберите сущности для экспорта](media/export-data-lake-select-entity.png)

Ваша среда Common Data Service связана с учетной записью хранилища Azure Data Lake 2-го поколения. Файловая система в учетной записи хранения Azure создается с папкой для каждой сущности, выбранной для репликации в Data Lake. 

## <a name="manage-entity-data-to-the-data-lake"></a>Управление данными сущностей в Data Lake
После настройки экспорта данных в Azure Data Lake 2-го поколения в своей подписке вы можете управлять экспортом данных сущностей в Data Lake данных одним из двух способов. 

- На портале создателя Power Apps в области **Экспорт в Data Lake** выберите **Управление сущностями** на панели команд, чтобы добавить или удалить одну или несколько связанных сущностей.
- На портале создателей Power Apps в области **Сущности** выберите **...** рядом с сущностью, затем выберите связанное Data Lake, куда вы хотите экспортировать данные сущности. 
   ![Выберите сущность для экспорта](media/select-entity-export.png)


Чтобы отменить связь всех связанных сущностей, на портале создателей Power Apps в области **Экспорт в Data Lake** выберите **Отменить связь Data Lake**. 

## <a name="view-your-data-in-the-azure-data-lake-gen-2"></a>Просмотр данных в Azure Data Lake, поколение 2
1. Войдите в [Azure](https://portal.azure.com), выберите учетную запись хранения, затем на левой панели навигации выберите **Storage Explorer**. 
2. Разверните узел **Файловые системы**, затем выберите commondataservice-*environmentName*-org-*Id*. 

Файл model.json, наряду с именем и версией, предоставляет список сущностей, которые были экспортированы в озеро. Файл model.json также содержит начальный статус синхронизации и время завершения. 

Отображается папка для каждой сущности, экспортированной в Data Lake, которая включает в себя файлы формата (CSV) моментального снимка. 
   > [!div class="mx-imgBorder"] 
   > ![Данные сущности в озере](media/entity-data-in-lake.png) 

### <a name="continuous-snapshot-updates"></a>Постоянные обновления снимков
Данные Common Data Service могут непрерывно изменяться посредством транзакций создания, обновления и удаления. Снимки предоставляют доступную только для чтения копию снимка данных, которая обновляется через регулярные промежутки времени, каждый час. Это гарантирует, что в любой данный момент потребитель данных аналитики может надежно использовать данные в озере.   

![Постоянные обновления снимков](media/snapshot-updates.png)

Когда сущности добавляются как часть первоначального экспорта, данные сущностей записываются в файлы entity.csv в соответствующих папках в озере. Это интервал T1, где создается доступный только для чтения файл снимка с именем *сущность*-T1.csv, такой как Account-T1.csv и Contacts-T1.csv. Кроме того, файл model.json обновляется, чтобы указывать на эти файлы снимков. Открыв файл model.json, вы можете просмотреть детали снимка. 

Вот пример разделенного файла Account.csv и папки снимков в озере.
![Снимок сущности организаций](media/export-data-lake-account-snapshots.png) 

Изменения в Common Data Service непрерывно передаются в соответствующие файлы CSV с помощью механизма струйной подачи. Это интервал T2, где делается еще один снимок. Файлы *Сущность*-T2.csv, такие как Accounts-T2.csv и Contacts-T2.csv (в предположении, что изменения имеются в обеих сущностях) и model.json обновляются с новыми файлами снимков. Любой новый человек, который просматривает данные снимка с T2 и далее, направляется на новые файлы снимков. Таким образом, исходный пользователь, просматривающий снимок, может продолжать работать с более старыми файлами снимков T1, в то время как новый просматривающий пользователь может читать последние обновления. Это полезно в сценариях с более длительными процессами в нисходящем направлении. 

Вот пример файла model.json, который всегда указывает на файл снимка организации с новейшей отметкой времени. 

![Пример файла JSON снимка](media/sample-snapshot-json.png) 

## <a name="transporting-export-to-data-lake-configuration-across-environments"></a>Перенос конфигурации экспорта в Data Lake между средами
В Power Apps решения используются для переноса приложений и компонентов из одной среды в другую или для применения набора настроек для существующих приложений. Чтобы конфигурации экспорта в Data Lake знали о решении, импортируйте в среду решение Export to Data Lake Core. Это обеспечивает базовые возможности управления жизненным циклом приложений (ALM), такие как распространение, резервное копирование и восстановление конфигурации экспорта в Data Lake. 

### <a name="import-the-export-to-data-lake-core-solution"></a>Импорт решения Export to Data Lake Core 
1.  На портале создателя Power Apps выберите среду, в которой вы хотите распространять конфигурацию экспорта в Data Lake.
2.  На левой панели навигации выберите **Решения**, выберите **Открыть AppSource**, найдите решение с именем **Export to Data Lake Core** и импортируйте это решение.

### <a name="add-an-export-to-data-lake-configuration-to-a-solution"></a>Добавление конфигурации экспорта в Data Lake в решение

> [!IMPORTANT]
> Прежде чем вы сможете добавить конфигурацию экспорта в Data Lake, вы должны установить решение Export to Data Lake Core, описанное ранее. 

1.  На портале создателя Power Apps выберите среду, в которой вы хотите распространять конфигурацию экспорта в Data Lake, затем на левой навигационной панели выберите **Решения**. 
2.  Выберите **Создать решение**, укажите имя, выберите издателя и укажите номер версии.  
3.  Откройте решение, созданное на предыдущем шаге, выберите **Добавить существующее** > **Другое** > **Конфигурация экспорта в Data Lake**. 
4.  Выберите связанные конфигурации Data Lake, которые требуются, затем выберите **Добавить**. 
5.  В области **Решения**, выберите решение, на панели команд выберите **Экспорт**. 
6.  На панели **Прежде чем экспортировать**, выберите **Опубликовать**, чтобы опубликовать все изменения перед экспортом, затем выберите **Далее**. 

### <a name="import-the-solution-that-contains-the-export-to-data-lake-configuration"></a>Импорт решения, содержащего конфигурацию экспорта в Data Lake
В среде, в которую требуется импортировать решение, на портале создателя Power Apps в области **Решения** импортируйте решение. 

#### <a name="verify-the-export-to-data-lake-configuration"></a>Проверка конфигурации экспорта в Data Lake
На портале создателя Power Apps в среде, в которую вы импортировали конфигурацию экспорта в Data Lake, убедитесь, что вы видите свое связанное Data Lake, а также сущности, которые вы транспортировали из другой среды.
> [!div class="mx-imgBorder"] 
> ![Импортированный сущности экспорта в Data Lake](media/imported-export-entities.png) 

### <a name="see-also"></a>См. также
[Блог: экспорт данных CDS в Azure Data Lake](https://powerapps.microsoft.com/blog/exporting-cds-data-to-azure-data-lake-preview/)