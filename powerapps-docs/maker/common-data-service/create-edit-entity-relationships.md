---
title: Обзор отношений сущностей для Common Data Service | MicrosoftDocs
ms.custom: ''
ms.date: 04/25/2019
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- PowerApps
ms.assetid: c765b6d9-4d87-4c2d-aae2-5b1c3b664a71
caps.latest.revision: 28
ms.author: matp
manager: kvivek
author: Mattp123
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 400fb236df41fefc8a9cfa7175ebfd8260ec96bd
ms.sourcegitcommit: 8185f87dddf05ee256491feab9873e9143535e02
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2019
ms.locfileid: "2707486"
---
# <a name="entity-relationships-overview"></a>Обзор отношений сущностей
Отношения сущностей определяют, как записи можно связывать друг с другом в базе данных. На самом простом уровне добавление поля поиска в сущность создает новое отношение 1:N (один ко многим) между двумя сущностями, а также позволяет поместить это поле поиска в форму. При наличии поля поиска пользователи могут связать несколько *дочерних* записей данной сущности с одной *родительской* записью сущности.  
  
Отношения сущностей 1: N не только определяют, как записи можно связывать с другими записями, но также предоставляет данные для решения следующих вопросов:  
  
- При удалении записи удаляются ли все записи, связанные с этой записью?  
- При назначении записи следует ли также назначить все записи, связанные с этой записью, новому владельцу?  
- Как ускорить процесс ввода данных при создании новой связанной записи в контексте существующей записи?  
- Как пользователи, просматривающие запись, могут просмотреть связанные записи?  
  
 Сущности также могут участвовать в отношении N:N (многие ко многим), в котором любое число записей для двух сущностей можно связать друг с другом.  

<a name="BKMK_Connections"></a>

## <a name="decide-whether-to-use-entity-relationships-or-connections"></a>Что использовать: отношения или соединения сущностей 
Отношения сущностей — это метаданные, которые вносят изменения в базу данных. Эти отношения позволяют запросам очень эффективно извлекать связанные данные. С помощью отношений сущностей можно определить формальные отношения, определяющие сущность или то, что может использовать большинство записей. Например, возможная сделка без потенциального клиента будет не очень полезна. Сущность "Возможная сделка" также имеет отношение N:N с сущностью "Конкурент". Это позволяет добавить несколько конкурентов в возможную сделку. Может потребоваться собрать эти данные и создать отчет по конкурентам.  
  
Существуют другие менее формальные типы отношений между записями, которые называются *соединениями*. Например, может быть полезно знать, состоят ли два контакта в браке, являются ли они друзьями вне работы или работал ли контакт на другую организацию. Большинство предприятий не создают отчеты с подобными сведениями и не требуют их указывать, поэтому может быть нецелесообразно создавать отношения сущностей. Дополнительные сведения: [Настройка ролей подключения](configure-connection-roles.md)

  
<a name="BKMK_TypesOfRelationships"></a>
 
## <a name="types-of-entity-relationships"></a>Типы отношений сущностей
Если посмотреть на обозреватель решений, можно подумать, что существует три типа отношений сущностей. На самом деле существует только два типа, как показано в следующей таблице.  
  
|Тип отношений|Описание|  
|-----------------------|-----------------|  
|**1:N (один-ко-многим)**|Отношение сущностей, при котором одну запись **Основная сущность** можно связать со многими другими записями **Связанная сущность** благодаря полю поиска в связанной сущности.<br /><br /> При просмотре записи основной сущности можно просмотреть список связанных с ней записей связанных сущностей.<br /><br /> В портале PowerApps, **Текущая сущность** представляет основную сущность.|  
|**N:N (многие-ко-многим)**|Отношение сущностей, зависящее от специальной сущности **Сущность отношения**, которая иногда называется пересекающейся сущностью, при котором множество записей одной сущности может быть связано со множеством записей другой сущности.<br /><br /> При просмотре записей любой из сущностей в отношении N:N можно просмотреть список всех записей другой сущности, связанных с ней.|  
  
Тип отношения **N:1 (многие-к-одному)** существует в пользовательском интерфейсе, поскольку в конструкторе отображается представление, сгруппированное по сущностям. Отношения 1:N фактически существуют *между* сущностями, и каждая сущность в них называется либо **Основная/текущая сущность**, либо **Связанная сущность**. Связанная сущность, иногда называемая *дочерней* сущностью, имеет поле поиска, которое позволяет хранить ссылку на запись из основной сущности, иногда называемой *родительской* сущностью. Отношение N:1 — это просто отношение 1:N с точки зрения связанной сущности.  
 
## <a name="entity-relationship-behavior"></a>Поведение отношений сущностей
Поведение отношений сущностей важно, поскольку помогает гарантировать целостность данных и может автоматизировать бизнес-процессы компании.

### <a name="preserve-data-integrity"></a>Сохранение целостности данных
Существуют некоторые сущности для поддержки других сущностей. Они не имеют смысл сами по себе. Обычно они содержат обязательное поле для связи с основной сущностью, которую они поддерживают. Что должно произойти при удалении основной записи?

Для определения этого можно использовать поведение отношения согласно правилам вашего предприятия. Два варианта:

- Предотвращение удаления основной сущности, чтобы записи связанной сущности можно было согласовать, возможно, связав их с другой основной сущностью.
- Разрешение автоматическое удаления связанных сущностей при удалении записи основной сущности.

Если связанная сущность не поддерживает основную сущность, можно разрешить удаление основной сущности, при этом значение поиска будет очищено.

### <a name="automate-business-processes"></a>Автоматизация бизнес-процессов
Допустим, у вас новый продавец и требуется назначить ему несколько существующих организаций, в данное время назначенных другому продавцу. Каждая запись организации может иметь несколько действий задач, связанных с ней. Можно легко найти активные организации, которые требуется переназначить, и назначить их новому продавцу. Но что произойдет с действиями задач, связанными с организациями? Хотелось бы вам открывать каждую задачу и указывать, должна ли она также быть назначена новому продавцу? Скорее всего, нет. Вместо этого можно разрешить отношению применить некоторые стандартные правила автоматически. Эти правила применяются только к записям задач, связанным с организациями, которые вы переназначаете. Можно выполнить следующие действия:  
  
- Переназначить все активные задачи.  
- Переназначить все задачи. 
- Не переназначать задачи.  
- Переназначить все задачи, которые в данный момент назначены бывшему владельцу организаций.  
  
Отношение может управлять тем, как действия, выполняемые с записью для записи основной сущности, распространяются на все записи связанной сущности.  

### <a name="behaviors"></a>Поведение
Существует несколько видов поведения, которые можно применить при возникновении определенных действий.

|Поведение|Описание|
|--|--|
|**Передавать активным**|Выполнение действия для всех активных записей связанной сущности.|
|**Передавать всем**|Выполнение действия для всех записей связанной сущности.|
|**Не передавать никому**|Никакие действия не выполняются.|
|**Удалить ссылку**|Удаление значения поиска всех связанных записей.|
|**Ограничить**|Блокировка возможности удаления записи основной сущности, если существуют связанные записи сущностей.|
|**Каскад для ответств.**|Выполнение действия для всех записей связанной сущности тем же пользователем, что и пользователь записи основной сущности.|

### <a name="actions"></a>Действия
Ниже представлены действия, которые могут вызывать определенное поведение.

|Поле|Описание|Параметры|
|--|--|--|
|**Назначение**|Что должно произойти, когда запись основной сущности назначается другому пользователю?|Передавать всем<br />Передавать активным<br />Каскад для ответств.<br />Не передавать никому|
|**Переподчинение**|Что должно произойти, когда меняется значение поиска связанной сущности в отношении родительского типа?<br />Дополнительные сведения: [Родительские отношения сущностей](#parental-entity-relationships)|Передавать всем<br />Передавать активным<br />Каскад для ответств.<br />Не передавать никому|
|**Общий доступ**|Что должно произойти при совместном использовании записи основной сущности?|Передавать всем<br />Передавать активным<br />Каскад для ответств.<br />Не передавать никому|
|**Удаление**|Что должно произойти при удалении записи основной сущности?|Передавать всем<br />Удалить ссылку<br />Ограничить|
|**Отмена общего доступа**|Что должно произойти при отмене совместного использования записи основной сущности?|Передавать всем<br />Передавать активным<br />Каскад для ответств.<br />Не передавать никому|
|**Слияние**|Что должно произойти при объединении записи основной сущности?|Передавать всем<br />Не передавать никому|
|**Представление свертки**|Каково требуемое поведение представления свертки, связанного с этим отношением? |Передавать всем<br />Передавать активным<br />Каскад для ответств.<br />Не передавать никому|


### <a name="parental-entity-relationships"></a>Отношения родительской сущности
Каждая пара сущностей, которые могут иметь отношение 1:N, может иметь несколько отношений 1:N между ними. Однако обычно только одно из этих отношений можно рассматривать как родительское отношение сущностей.

Родительское отношение сущностей — это любое отношение сущностей 1:N, где один из каскадных параметров в столбце **Родительское** в следующей таблице имеет значение true.

|Действие|Родительское|Не родительское|  
|------------|--------------|------------------|  
|**Назначение**|Передавать всем<br />Каскад для ответств.<br />Передавать активным|Не передавать никому|  
|**Удаление**|Передавать всем|Удалить ссылку<br />Ограничить|  
|**Переподчинение**|Передавать всем<br />Каскад для ответств.<br />Передавать активным|Не передавать никому|  
|**Общий доступ**|Передавать всем<br />Каскад для ответств.<br />Передавать активным|Не передавать никому|  
|**Отмена общего доступа**|Передавать всем<br />Каскад для ответств.<br />Передавать активным|Не передавать никому|  

Например, если вы создаете новую настраиваемую сущность и добавляете отношение сущностей 1:N с сущностью учетной записи, где настраиваемая сущность является связанной сущностью, можно настроить действия для этого отношения сущностей для использования параметров в столбце **Родительское**. Если позже добавить еще одно отношение сущностей 1:N с настраиваемой сущностью в качестве ссылочной сущности, можно настроить действия только для использования параметров в столбце **Не родительское**.

Обычно это означает, что для каждой пары сущностей существует только одно родительское отношение. В некоторых случаях при поиске в связанной сущности учитывается отношение с несколькими типами сущности.

Например, если в сущности настроен поиск по клиенту, который может ссылаться на сущность контакта или организации. Существует два отдельных родительских отношения сущностей 1:N.

Любая сущность действия имеет похожий набор родительских отношений сущностей для сущностей, которые можно связать с помощью поля поиска "в отношении".

<a name="BKMK_RelationshipBehaviorLimitations"></a>   

### <a name="limitations-on-behaviors-you-can-set"></a>Доступные ограничения поведения
Из-за родительских отношений существует ряд ограничений, которые необходимо учитывать при определении отношений сущностей.  
  
- Настраиваемая сущность не может быть основной в каскадном отношении со связанной системной сущностью. Это означает, что между основной настраиваемой сущностью и связанной системной сущностью не может быть отношений с каким-либо из действий со значением **Передавать всем**, **Передавать активным** или **Передавать владельцу**.  
- У новых отношений действие не может иметь значение **Передавать всем**, **Передавать активным** или **Передавать владельцу**, если связанная сущность в этом отношении уже является связанной сущностью в любом другом отношении, действие которого имеет значение **Передавать всем**, **Передавать активным** или **Передавать владельцу**. Это позволяет избежать создания отношений с несколькими родительскими сущностями.  

### <a name="see-also"></a>См. также
[Обзор сущностей и метаданных](create-edit-metadata.md)<br />
[Создание и изменение отношений 1:N (один-ко-многим) или N:1 (многие-к-одному)](create-edit-1n-relationships.md)<br />
[Создание отношений сущностей N:N (многие-ко-многим)](create-edit-nn-relationships.md)

