---
title: Создание и использование потоков данных в PowerApps | Документация Майкрософт
description: Инструкции по созданию и использование потоков данных в PowerApps
ms.custom: ''
ms.date: 08/05/2019
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - powerapps
author: Mattp123
ms.assetid: null
caps.latest.revision: null
ms.author: matp
manager: kvivek
tags: null
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---
# <a name="create-and-use-dataflows-in-powerapps"></a>Создание и использование потоков данных в PowerApps
[!INCLUDE [cc-beta-prerelease-disclaimer](../../includes/cc-beta-prerelease-disclaimer.md)]

Благодаря расширенной подготовке данных, доступной в PowerApps, можно создать коллекцию данных, называемую потоком данных, которую затем можно использовать для подключения к бизнес-данным из различных источников, очистки данных, их преобразования и загрузки в Common Data Service или учетную запись хранения Azure Data Lake 2-го поколения организации.

Поток данных — это коллекция сущностей (сущности аналогичны таблицам), которые создаются и управляются в средах службы PowerApps. Можно добавлять и изменения сущности в потоке данных, а также управлять расписаниями обновления данных непосредственно из среды, в которую ваш поток данных был создан.

Создав поток данных на портале PowerApps, можно получить данные с него используя соединитель Common Data Service или соединитель потока данных Power BI Desktop, в зависимости от того, какое место назначения вы выбрали при создании потока данных.

3 основных шага к использованию потока данных:

1.  Создайте поток данных на портале PowerApps. Вы выбираете место назначения для загрузки выходных данных, источник для получения данных и шаги Power Query для преобразования данных с помощью инструментов Microsoft, которые призваны упростить эту задачу.

2.  Планирование запусков потока данных. Это частота, с которой поток данных Power Platform должен обновлять данные, которые ваш поток данных будет загружать и преобразовывать.

3.  Используйте данные, которые вы загрузили в хранилище назначения. Можно создавать приложения, потоки, отчеты Power BI и панели мониторинга или напрямую подключаться к папке Common Data Model потока данных в озере данных вашей организации, используя службы данных Azure, такие как Фабрика данных Azure, Azure Databricks или любую другую службу, которая поддерживает стандарт папки Common Data Model.

В следующих разделах рассматривается каждый из этих шагов, чтобы вы могли ознакомиться с инструментами, предоставленными для выполнения каждого шага. 

## <a name="create-a-dataflow"></a>Создание потока данных
Потоки данных создаются в одной среде. Поэтому вы сможете видеть их и управлять ими только из этой среды. Кроме того, пользователи, которые хотят получать данные из вашего потока данных, должны иметь доступ к среде, в которой вы их создали.

> [!NOTE]
> Создание потоков данных, которые загружают данные в хранилище озера данных Azure Data Lake Storage 2-го поколения в среде по умолчанию, в настоящее время не поддерживается.

1.  Войдите в PowerApps и проверьте, в какой среде вы находитесь, найдите переключатель среды в правой части панели команд.

    ![Переключатель среды](media/environment-switcher.png)

2.  В левой области навигации выберите стрелку вниз рядом с **Данными**.

    ![Выбор данных](media/data-select.png)

3.  В списке **Данные** выберите **Потоки данных**, затем выберите **Новый поток данных**.

    ![Создание потока данных](media/create-a-dataflow.png)

4.  На странице **Выбрать целевую загрузку** выберите целевое хранилище, в котором вы хотите сохранить сущности. Потоки данных могут хранить сущности в Common Data Service или в учетной записи Azure Data Lake Storage вашей организации. Выбрав место назначения для загрузки данных, введите **Имя** для потока данных, а затем выберите **Создать**.

    ![Выбор целевой загрузки](media/select-load-target.png)

     > [!IMPORTANT]
     > Только один владелец любого потока данных — человек, который его создал. Только владелец может изменить поток данных. Авторизация и доступ к данным, созданным потоком данных, зависят от места назначения, в которое вы загрузили данные. Данные, загруженные в Common Data Service, будут доступны через соединитель Common Data Service и требуют, чтобы лицо, осуществляющее доступ к данным, было авторизовано в Common Data Service.
     > Данные, загруженные в учетную запись хранения Azure Data Lake 2 поколения вашей организации, доступны через соединитель потока данных Power Platform, и для доступа к ним требуется членство в среде, в которой они были созданы.

5. На странице **Выбор источника данных** выберите источник данных, в котором хранятся объекты, а затем выберите **Создать**. Выбор отображаемых источников данных позволяет создавать сущности потока данных. 

    ![Выбор источника данных](media/choose-data-source.png)

6. После выбора источника данных вам будет предложено указать параметры подключения, включая учетную запись, которая будет использоваться при подключении к источнику данных.

    ![Подключение к источнику данных](media/data-source-provide-cred.png)

7. После подключения вы выбираете данные, которые будут использоваться для вашей сущности. Когда вы выбираете данные и источник, служба потока данных Power Platform впоследствии повторно подключается к источнику данных, чтобы обновлять данные в потоке данных с той частотой, которую вы выберете позже в процессе настройки.


    ![Выберите дату](media/choose-data.png)

Теперь, когда вы выбрали данные для использования в сущности, вы можете использовать редактор потока данных, чтобы формировать или преобразовывать эти данные в формат, необходимый для использования в вашем потоке данных.

## <a name="use-the-dataflow-editor-to-shape-or-transform-data"></a>Используйте редактор потока данных для формирования или преобразования данных
Можно преобразовать свой выбор данных в форму, которая лучше всего подходит для вашей сущности, используя возможности редактирования Power Query, аналогично редактору Power Query в Power BI Desktop. Для получения дополнительных сведений о Power Query см. раздел [Обзор запроса в Power BI Desktop](/power-bi/desktop-query-overview).

Если нужно видеть код, который редактор запросов создает с каждым шагом, или если требуется создать свой собственный код формирования, вы можете использовать расширенный редактор.

![Расширенный редактор](media/advanced-editor.png)

## <a name="dataflows-and-the-common-data-model"></a>Потоки данных и Common Data Model 
Объекты потоков данных включают в себя новые инструменты, позволяющие легко сопоставить ваши бизнес-данные с Common Data Model, обогатить их данными Microsoft и сторонних производителей и получить упрощенный доступ к машинному обучению. Эти новые возможности могут быть использованы для обеспечения интеллектуального и эффективного понимания ваших бизнес-данных. После того как вы выполнили какие-либо преобразования в шаге изменения запросов, описанном ниже, вы можете сопоставить столбцы из таблиц источников данных со стандартными полями сущностей, как это определено в Common Data Model. Стандартные сущности имеют известную схему, определенную Common Data Model.

Для получения дополнительных сведений об этом подходе и Common Data Model, см. [Common Data Model](/powerapps/common-data-model/overview).

Чтобы использовать Common Data Model с потоком данных, выберите преобразование **Сопоставление со стандартом** в диалоговом окне **Изменить запросы**. На появившемся экране **Сопоставление сущностей**, выберите стандартную сущность, которую необходимо сопоставить.

![Сопоставление со стандартной сущностью](media/map-to-standard-entity.png)

При сопоставлении исходный столбец со стандартным полем, происходит следующее:

1.  Исходный столбец принимает имя стандартного поля (столбец переименовывается, если имена отличаются). 

2.  Исходный столбец получает тип данных стандартного поля. 

Чтобы сохранить стандартную сущность Common Data Model, все стандартные поля, которые не сопоставляются, получают значения *Null*.

Все исходные столбцы, которые не сопоставлены, остаются как есть, чтобы гарантировать, что результатом сопоставления является стандартный сущность с настраиваемыми полями.

После того, как вы завершили свой выбор, и ваша сущность и ее параметры данных будут готовы, вы будете готовы к следующему шагу, на котором выбирается частота обновления вашего потока данных.

## <a name="set-the-refresh-frequency"></a>Настройка частоты обновления
После того как сущности определены, вы захотите запланировать частоту обновления для каждого из подключенных источников данных.

1. Потоки данных используют процесс обновления данных, чтобы поддерживать актуальность данных. В **инструменте разработки потока данных Power Platform** можно выбрать обновить поток данных вручную или автоматически с запланированным интервалом по вашему выбору. Чтобы запланировать автоматическое обновление, выберите **Обновить автоматически**.

   ![Обновить автоматически](media/refresh-automatically.png)

2. Введите частоту обновления потока данных, дату и время начала в формате UTC.

3. Выберите **Создать.**
<!-- 
## Connect to your dataflow in Power BI Desktop
Once you’ve created your dataflow and you have scheduled the refresh frequency
for each data source that will populate the model, you’re ready for the final task, which is connecting to your dataflow from within Power BI Desktop.

To connect to the dataflow, in Power BI Desktop select **Get Data** > **Power Platform** > **Power Platform dataflows** > **Connect**.

![Connect to the dataflow](media/get-data.png)

Navigate to the environment where you saved your dataflow, select
the dataflow, and then select the entities that you created from the list.

You can also use the search bar, near the top of the window, to quickly find the
name of your dataflow or entities from among many dataflow entities.

When you select the entity and then select the **Load** button, the entities
appear in the **Fields** pane in Power BI Desktop, and appear and behave just
like tables from any other dataset. -->

## <a name="using-dataflows-stored-in-azure-data-lake-storage-gen2"></a>Использование потоков данных, хранящихся в Azure Data Lake Storage 2 поколения
Некоторые организациям может потребоваться использовать собственное хранилище для создания и управления потоками данных. Можно интегрировать потоки данных с помощью Azure Data Lake Storage 2 поколения, если следовать требованиям для правильной настройки учетной записи хранения. Дополнительная информация: [подключите Azure Data Lake Storage 2 поколения для хранения потоков данных](/power-bi/service-dataflows-connect-azure-data-lake-storage-gen2) 

## <a name="troubleshooting-data-connections"></a>Устранение ошибок при соединениях данных
Могут быть случаи, когда при подключении к источникам данных потоки данных сталкиваются с проблемами. В этом разделе приведены рекомендации по устранению неполадок при возникновении проблем.

-   **Соединитель Salesforce.** Использование пробной учетной записи для Salesforce с потоками данных приводит к сбою соединения без предоставления информации. Чтобы решить эту проблему, используйте производственную учетную запись Salesforce или учетную запись разработчика для тестирования.

-   **Соединитель SharePoint.** Убедитесь, что вы указали корневой адрес сайта SharePoint без каких-либо вложенных папок или документов. Например, используйте ссылки аналогичные *https://microsoft.sharepoint.com/teams/ObjectModel*.


-   **Соединитель файла JSON.** В настоящее время вы можете подключиться к файлу JSON, используя только обычную проверку подлинности. Например, URL-адрес, аналогичный *https://XXXXX.blob.core.windows.net/path/file.json?sv=2019-01-01&si=something&sr=c&sig=123456abcdefg* в настоящее время не поддерживается.

-   **Хранилище данных SQL Azure.** В настоящее время потоки данных не поддерживают проверку подлинности Azure Active Directory для хранилища данных SQL Azure. Используйте обычную проверку подлинности для этого сценария.

## <a name="next-steps"></a>Дальнейшие шаги
Следующие статьи полезны для получения дополнительной информацией и сценарии при использовании потоков данных:

-   [Добавление данных в сущность в Common Data Service](data-platform-cds-newentity-pq.md)

-   [Используя потоки данных с локальными источниками данных](using-dataflows-with-on-premises-data.md)

-   [Подключение Azure Data Lake Storage 2-го поколения для хранения потока данных](/power-bi/service-dataflows-connect-azure-data-lake-storage-gen2)

Для получения дополнительных сведений по Common Data Model:

-   [Common Data Model — обзор](/powerapps/common-data-model/overview)

-   [Подробнее о схеме и сущности Common Data Model на GitHub](https://github.com/Microsoft/CDM)
