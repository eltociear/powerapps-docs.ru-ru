---
title: Добавление веб-ресурса хранилища Azure в форму | MicrosoftDocs
description: Шаги для добавления веб-ресурса службы хранилища Azure в форму для включения отправки вложений в службу хранилища Azure.
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 02/11/2020
ms.author: tapanm
ms.reviewer: tapanm
ms.openlocfilehash: 0c011c61c2084662d1e759d7226140dcf3ddfad6
ms.sourcegitcommit: 629e47c769172e312ae07cb29e66fba8b4f03efc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "3109464"
---
# <a name="add-the-azure-storage-web-resource-to-a-form"></a>Добавление веб-ресурса хранилища Azure в форму

Вложениями, отправляемыми в хранилище Azure вместо отправки напрямую в Common Data Service, можно управлять с помощью примечаний в Common Data Service.

Чтобы разрешить отправку вложений из определенной формы в хранилище Azure, необходимо добавить веб-ресурс в эту форму и [настроить хранилище Azure для организации](enable-azure-storage.md).

> [!NOTE]
В этом примере форма добавляется в форму "Интерес" для сущности "Интерес". Рекомендуется соблюдать осторожность при редактировании существующих форм.

Когда файл (например, attachments.zip) отправляется в хранилище Azure с помощью портала, он представлен примечанием в сущности и заполнителем для вложения.

![Вложение в форме](media/notes-attachment-lead-form.png "Заполнитель для вложения в форме")

Обратите внимание, что файл вложения теперь называется attachment.zip.txt. По умолчанию Common Data Service не понимает файл Azure, поэтому этот заполнитель TXT-файла хранится в Common Data Service вместо этого. Контекст хранилища Azure для файла заполнителя отображает сведения о файле.
```
{
 Name: attachment.zip,
 Type: application/x-zip-compressed,
 Size: 24890882,
 "Url": "https://accountname.blob.core.windows.net/storage/81a9a9491c36e51182760026833bcf82/attachment.zip"
}
```

Чтобы просмотреть и взаимодействовать с файлом, хранящимся в Azure, необходимо добавить веб-ресурс adx.annotations.html в форму. В качестве предварительного условия убедитесь, что у пользователей есть право на чтение adx_setting. В противном случае веб-ресурс не будет отображаться должным образом.

1. В редакторе форм для соответствующей формы выберите **Веб-ресурс** на вкладке **Вставить**.

2. В поле **Веб-ресурс** выберите **adx_annotations/adx.annotations.html**.

3. Введите имя и метку для ресурса.

4. В поле **Пользовательский параметр (данные)** введите **azureEnabled=true**. <br>Можно также использовать веб-ресурс, не включая поддержку Azure таким образом. В этом случае он будет работать почти так же как элемент управления по умолчанию.</br>

5. На вкладке **Форматирование** выберите предпочитаемые правила форматирования. Рекомендуется снять флажок **Отображать границу**.

6. Выберите **OK**, чтобы сохранить ресурс.

7. При необходимости может потребоваться удалить существующий элемент управления примечаниями либо перенести его на вкладку или в раздел, помеченный как невидимый по умолчанию.

8. Сохраните форму, а затем опубликуйте изменения.

   ![Добавление веб-ресурса](media/add-web-resource.png "Добавление веб-ресурса")

Теперь новый элемент управления будет отображаться на странице, предоставляя вам возможность управлять вложениями в хранилище Azure.

![Вложение файла Azure в форме](media/azure-file-attachment-lead-form.png "Вложение файла Azure в форме")

Значок скрепки был заменен на значок облака, чтобы указать, что данный файл хранится в хранилище Azure. Вы можете продолжить хранить вложения в Common Data Service; эти файлы будут обозначены значком скрепки.

> [!Note]
> Необходимо добавить правило общего доступа к ресурсам независимо от источника (CORS) в учетной записи службы хранилища Azure, как указано ниже, в противном случае вы увидите обычный значок вложения, а не значок облака.
> - **Допустимые источники**: укажите свой домен. Например: `https://contoso.crm.dynamics.com`.
> - **Разрешенные команды**: GET, PUT, DELETE, HEAD, POST
> - **Разрешенные заголовки**: укажите заголовки запросов, которые исходный домен может указывать в запросе CORS. Например, x-ms-meta-data\*, x-ms-meta-target\*. В этом сценарии необходимо указать *, в противном случае веб-ресурс сети не будет отображаться должным образом.
> - **Предоставляемые заголовки**: укажите заголовки ответов, которые могут отправляться в ответ на запрос CORS браузером инициатору запроса. Например, x-ms-meta-\*.
> - **Максимальный возраст (секунды)**: укажите максимальное время, в течение которого браузер должен кэшировать предварительный запрос OPTIONS. Например, 200.
> 
> [!include[More information](../../includes/proc-more-information.md)] [Поддержка CORS для служб хранилища Azure](https://docs.microsoft.com/rest/api/storageservices/cross-origin-resource-sharing--cors--support-for-the-azure-storage-services).

Если вложенный файл является изображением, элемент управления отобразит изображение как эскиз независимо от того, хранится он в Common Data Service или в хранилище Azure.

> [!Note]
> Функция эскиза ограничена изображениями размером менее 1 МБ.

![Эскиз примечаний](media/notes-thumbnail.png "Эскиз примечаний")

## <a name="cors-protocol-support"></a>Поддержка протокола CORS

Протокол [общего доступа к ресурсам независимо от источника (CORS)](https://www.w3.org/TR/cors/) состоит из набора заголовков, в котором указывается, можно ли использовать ответ на другом домене.
Используются следующие параметры сайта для настройки CORS:

| Параметр сайта | Заголовок запроса | Описание |
|-|-|-|
| HTTP/Access-Control-Allow-Credentials | Access-Control-Allow-Credentials | Единственное допустимое значения этого заголовка — true (с учетом регистра). Если вам не нужны учетные данные, пропустите этот заголовок полностью (но не устанавливайте значение false). 
| HTTP/Access-Control-Allow-Headers | Access-Control-Allow-Headers | Список поддерживаемых заголовков запроса HTTP с разделителями-запятыми.
| HTTP/Access-Control-Allow-Methods | Access-Control-Allow-Methods | Список допустимых методов запроса HTTP с разделителями-запятыми, например GET, POST, OPTIONS.
| HTTP/Access-Control-Allow-Origin | Access-Control-Allow-Origin | Чтобы разрешить любому ресурсу доступ к ресурсам, можно задать \*. В противном случае укажите URI, который может получить доступ к ресурсам.                   |
|  HTTP/Access-Control-Expose-Headers | Access-Control-Expose-Headers | Список имен заголовков HTTP с разделителями-запятыми, отличных от простых заголовков ответов, которые ресурс может использовать и которые могут быть предоставлены.
| HTTP/Access-Control-Max-Age | Access-Control-Max-Age |  Максимальное число секунд кэширования результатов.
| HTTP/Content-Security-Policy | Content-Security-Policy | Управляет ресурсами, которые пользовательский агент может загрузить для данной страницы.
| HTTP/Content-Security-Policy-Report-Only | Content-Security-Policy-Report-Only | Позволяет веб-разработчикам экспериментировать с политиками, отслеживая, но не применяя их эффекты. Эти отчеты о нарушениях состоят из документов JSON, отправленных с помощью HTTP-запроса POST на указанный URI.
| HTTP/X-Frame-Options | X-Frame-Options | Указывает, следует ли разрешить браузеру отображать страницу в *\<frame\>*, *\<iframe\>*, *\<embed\>* или *\<object\>*.
| HTTP/X-Content-Type-Options | X-Content-Type-Options | Отключает прослушивание MIME и заставляет браузер использовать тип, указанный в *Content-Type*.
