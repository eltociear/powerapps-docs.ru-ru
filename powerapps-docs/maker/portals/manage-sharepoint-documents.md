---
title: Управление документами SharePoint на портале | MicrosoftDocs
description: Инструкции по управлению документами SharePoint на портале.
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 10/07/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: f94dee983d5d2d9cedf417f2843a2c10c46b82c1
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73543329"
---
# <a name="manage-sharepoint-documents"></a>Работа с документами SharePoint

Common Data Service поддерживает интеграцию с [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)], что позволяет использовать возможности управления документами [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] в пределах Common Data Service. Порталы PowerApps теперь поддерживают передачу и отображение документов в [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] непосредственно в форме сущности или веб-форме на портале. Это позволяет пользователям портала просматривать, скачивать, добавлять и удалять документы с портала. Пользователи портала также могут создавать вложенные папки для организации их документов.

> [!NOTE]
> - Управление документами работает только с [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)].
> - Управление документами поддерживается при интеграции на основе сервера.

Для работы с возможностями управления документами [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] из Common Data Service необходимо выполнить следующие действия.

1.  [Включение функций управления документами в приложениях, управляемых моделями, в Dynamics 365](#step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365)

2.  [Настройка интеграции SharePoint из центра администрирования порталов PowerApps](#step-2-set-up-sharepoint-integration-from-powerapps-portals-admin-center)

3.  [Включение управления документами для сущностей](#step-3-enable-document-management-for-entities)

4.  [Настройка соответствующей формы в документах PowerApps](#step-4-configure-the-appropriate-form-to-display-documents)

5.  [Создание соответствующего разрешения сущности и назначение его соответствующей веб-роли](#step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role)

## <a name="step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365"></a>Шаг 1. Включение функций управления документами в приложениях, управляемых моделями, в Dynamics 365

Необходимо включить функции управления документами в приложениях, управляемых моделями, в Dynamics 365 с помощью интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] на основе сервера. Серверная интеграция [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] позволяет приложениям, основанным на моделях, в Dynamics 365 и [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)] выполнять подключение типа "сервер-сервер". На портале используется [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] запись сайта по умолчанию. Сведения о том, как включить функции управления документами в приложениях на основе моделей в Dynamics 365, см. в разделе [Настройка приложений, управляемых моделями в dynamics 365 для использования SharePoint Online](https://docs.microsoft.com/power-platform/admin/set-up-dynamics-365-online-to-use-sharepoint-online).

## <a name="step-2-set-up-sharepoint-integration-from-powerapps-portals-admin-center"></a>Шаг 2. Настройка интеграции SharePoint из центра администрирования порталов PowerApps

Чтобы использовать возможности управления документами [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)], необходимо включить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] из центра администрирования порталов PowerApps.

> [!NOTE]
> Для выполнения этого действия необходимо быть глобальным администратором.

1. Откройте [центр администрирования порталов PowerApps](admin/admin-overview.md).

2.  Перейдите к разделу **Настройка интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]**  > **включить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]** .

    > [!div class=mx-imgBorder]
    > ![Включить интеграцию с SharePoint](media/enable-sharepoint-integration.png "Включить интеграцию с SharePoint")

3.  В окне подтверждения выберите **включить** . Это позволит порталу взаимодействовать с [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. При включении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] портал перезапускается и будет недоступен в течение нескольких минут. При включении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] появляется сообщение.

Когда [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] интеграция включена, становится доступной следующее действие:

- **Отключить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]** : позволяет отключить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] с порталом. При отключении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] портал перезапускается и будет недоступен в течение нескольких минут. При отключении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] появляется сообщение.

    > [!div class=mx-imgBorder]
    > ![Отключить интеграцию с SharePoint](media/disable-sharepoint-integration.png "Отключить интеграцию с SharePoint")

Включение или отключение [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]ной интеграции приведет к обновлению приложения [!INCLUDE[pn-azure-active-directory](../../includes/pn-azure-active-directory.md)] ([!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD) для портала и добавлению или удалению необходимых разрешений [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] соответственно. Вы также будете перенаправлены, чтобы предоставить согласие на внесение изменений в приложение [!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD. 

> [!div class=mx-imgBorder]
> ![Отключить интеграцию с SharePoint](media/sharepoint-integration-consent.png "Отключить интеграцию с SharePoint")

Если вы не предпредоставите согласие:

- Включение или отключение интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] не будет завершено, и отобразится сообщение об ошибке.

- Ваша встроенная учетная запись [!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD на портале не будет работать. 


## <a name="step-3-enable-document-management-for-entities"></a>Шаг 3. Включение управления документами для сущностей
Необходимо включить управление документами для сущностей, чтобы хранить документы, связанные с записями сущностей, в [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. Сведения о включении управления документами для сущностей см. в разделе [Включение управления документами SharePoint для конкретных сущностей](https://docs.microsoft.com/dynamics365/customer-engagement/admin/enable-sharepoint-document-management-specific-entities).

## <a name="step-4-configure-the-appropriate-form-to-display-documents"></a>Шаг 4. Настройка соответствующей формы для вывода документов

### <a name="powerapps-customization"></a>Настройка PowerApps

Укажите форму, в которой вы хотите использовать возможности управления документами. Необходимо изменить форму с помощью редактора форм приложений на основе моделей и добавить к ней вложенную сетку. Вложенная сетка добавляет в форму раздел, позволяющий работать с документами на портале. Для работы этой функции необходимо задать следующие свойства в подсетке:

- В разделе **источник данных**выберите **расположения документов** из списка **сущностей** .

- В разделе **источник данных**выберите **Активные расположения документов** из списка **представление по умолчанию** .

Вы можете указать имя и метку в соответствии с требованиями. Сохранение и публикация формы после добавления и настройки вложенной сетки.

> [!NOTE]
> Управление документами должно быть включено для сущности, для которой редактируется форма. Дополнительные сведения см. [в статье Включение управления документами для сущностей](#step-3-enable-document-management-for-entities) .

### <a name="powerapps-portals-configuration"></a>Конфигурация порталов PowerApps

Помимо стандартной конфигурации, необходимой для формы сущности или веб-формы, необходимо задать следующие свойства, чтобы включить управление документами:

- **Имя сущности** и **имя формы**: введите имена сущностей и форм, настроенные на предыдущем шаге соответственно.

- Установите флажок **включить разрешение на сущность** в форме, чтобы разрешить пользователю чтение документов.

- Задайте для параметра **режим** значение **изменить** , чтобы разрешить отправку документов.

> [!NOTE]
> Для отправки документов требуется существование записи родительской сущности. Если установить режим вставки, Отправка документа не будет работать, поскольку запись родительской сущности не создается, пока форма не будет отправлена.

## <a name="step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role"></a>Шаг 5. создание соответствующего разрешения сущности и назначение его соответствующей веб-роли

Чтобы установить необходимый доступ для просмотра и отправки документов, необходимы две записи разрешений сущности.

- Разрешения для сущности сущности или веб-формы: 
    - Создайте запись **разрешения сущности** , указав **имя сущности** в форме сущности или веб-формы, настроенной ранее. 
    - Выберите **область** и отношение области, соответствующие желаемому поведению формы. 
    - Включите **Чтение** и **Добавление** разрешений, чтобы разрешить доступ на чтение к документам и при необходимости включить права на **запись** , чтобы разрешить отправку документов. Пропустите раздел **разрешений дочерней сущности** , так как он будет заполнен следующим шагом.
- Разрешения на **расположение документа** с **родительской областью** , ссылающейся на предыдущую запись разрешения: 
    - Создание записи **разрешения сущности** , указывающей **имя сущности** в качестве сущности **расположения документа** с **областью** , для которой задано значение **Parent**. 
    - Выберите разрешение родительской сущности для записи разрешения сущности, созданной на предыдущем шаге. 
    - Привилегии 
        - Минимальный набор привилегий, позволяющий разрешить доступ для чтения к документам, — **Чтение**, **Создание**и **Добавление**. 
        - Включить привилегии **записи** для доступа к передаче документов. 
        - Включить **Удаление** , чтобы разрешить удаление документа.

> [!NOTE]
> Соответствующее разрешение дочерней сущности для сущности **расположения документа** необходимо создать для каждого экземпляра записи разрешения родительской сущности, которая существует в сущности сущности или веб-формы, где необходимо отобразить документы.

## <a name="configure-file-upload-size"></a>Настройка размера отправляемого файла

По умолчанию размер файла равен 10 МБ. Однако можно настроить размер файла не более 50 МБ с помощью параметра сайта `SharePoint/MaxUploadSize`.

## <a name="sample-configuration-to-enable-document-management-on-the-case-entity-form"></a>Пример конфигурации для включения управления документами в форме сущностей вариантов

В приведенном ниже примере показана конфигурация с использованием сущности Case, для которой требуется приложение обслуживания клиентов Dynamics 365 в качестве необходимого компонента. Хотя в этом образце используется сущность вариантов, это лишь иллюстрация описанных выше действий, и ее можно выполнить с помощью любой другой настраиваемой сущности или любой Common Data Service сущности, которая поддерживает управление документами в SharePoint. 

1.  Следуйте инструкциям на [шаге 1](#step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365) , чтобы убедиться, что Серверная конфигурация завершена для приложений на основе моделей в Dynamics 365 и интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)].

2.  Следуйте инструкциям на [шаге 2](#step-2-set-up-sharepoint-integration-from-powerapps-portals-admin-center) , чтобы убедиться, что портал имеет разрешения на интеграцию с [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. 

3.  Следуйте инструкциям на [шаге 3](#step-3-enable-document-management-for-entities) , чтобы обеспечить включение управления документами для сущности вариантов.

4.  Следуйте инструкциям, приведенным в [шаге 4](#step-4-configure-the-appropriate-form-to-display-documents) , со следующими конфигурациями:

    - Приложения, управляемые моделями, в настройке Dynamics 365

        а) Последовательно выберите **параметры** > **Настройка** > **Настройка системы**. 

        б) В **решении по умолчанию**перейдите к сущности **вариантов** > **Forms**. 
    
        в) Откройте **веб-узел — измените регистр** в редакторе форм.

         > [!div class=mx-imgBorder]
         > ![Веб-форма изменения регистра](media/web-edit-case-form.png "Веб-форма изменения регистра")
    
        г) Выберите поле **создано** в форме, а затем на вкладке **Вставка** выберите **Вложенная сетка**.

         > [!div class=mx-imgBorder]
         > ![Добавление вложенной сетки в форму веб-редактирования](media/add-sub-grid.png "Добавление вложенной сетки в форму веб-редактирования")
    
        и. В диалоговом окне **Задание свойств** задайте следующие свойства и нажмите кнопку **ОК**.

         - **Имя** (это может быть любое имя): каседокументс 
    
         - **Метка** (это может быть любое имя метки): документы вариантов 
      
         - **Сущность**: расположения документов 
    
         - **Представление по умолчанию**: Активные расположения документов

         > [!div class=mx-imgBorder]
         > ![Свойства вложенной сетки](media/sub-grid-properties.png "Свойства вложенной сетки")

        ж. В редакторе форм выберите **сохранить** и щелкните **опубликовать**.

    - Конфигурация порталов PowerApps

        а) Перейдите на **порталы** > **Entity Forms**.
    
        б) Поиск и открытие **службы клиентов — изменение** сущностей вариантов.
    
        в) Проверьте и убедитесь, что установлены следующие свойства:
    
         - **Имя сущности**: регистр (инцидент)
    
         - **Имя формы**: Интернет — изменение регистра
    
         - **Режим**: изменить
    
         - **Разрешение сущности**: включено
    
         > [!div class=mx-imgBorder]
         > ![Служба клиентов — форма изменения регистра](media/customer-service-edit-case-form.png "Служба клиентов — форма изменения регистра")
    
        г) Если вы внесли изменения в форму, нажмите кнопку **сохранить**.

5. Выполните [Шаг 5](#step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role
) , чтобы убедиться, что пользователям предоставлены разрешения на сущности.

   1. Перейдите к записи **веб-роли** , связанной с пользователем. В этом примере предполагается, что у пользователя есть веб-роль администратора.

   2. Убедитесь, что запись разрешения сущности существует по имени **службы клиента — обращения к клиенту**. 

      > [!NOTE]
      > Убедитесь, что у веб-роли есть добавленное разрешение на сущность. Если пользователь уже является администратором, разрешение для приведенной выше сущности не нужно явно назначать.

   3. Создайте новое разрешение сущности, введите следующие сведения и выберите **сохранить**:

    - **Имя** (это может быть любое имя): документы, связанные с обслуживанием клиентов.

    - **Имя сущности**: расположение документа
        
    - **Область**: родитель
        
    - **Разрешение родительской сущности**: служба клиента — обращения с клиентом
        
    - **Родительская связь**: incident_SharePointDocumentLocations
        
    - **Привилегии**: чтение, создание, добавление, запись, удаление

      > [!div class=mx-imgBorder]
      > ![Разрешение сущности служба клиента](media/customer-service-entity-permission.png "Разрешение сущности служба клиента")
  
   4. Войдите на портал, чтобы обеспечить включение управления документами для сущности вариантов.

      а) Перейдите на страницу **поддержки** .

      > [!div class=mx-imgBorder]
      > ![Страница поддержки портала](media/portal-support-page.png "Страница поддержки портала")

      б) Щелкните в списке существующую запись варианта. Перейдите к разделу **документы вариантов** на странице и просмотрите добавленный список документов.

      > [!div class=mx-imgBorder]
      > ![Документ с вариантом](media/case-document.png "Документ с вариантом")

