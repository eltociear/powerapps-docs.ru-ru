---
title: Управление документами SharePoint на портале | MicrosoftDocs
description: Инструкции по управлению документом SharePoint на портале.
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 10/07/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: a4ba89a1497a6ed81d2e71f7d7a43813d47b6583
ms.sourcegitcommit: 861ba8e719fa16899d14e4a628f9087b47206993
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "2873324"
---
# <a name="manage-sharepoint-documents"></a>Управление документами SharePoint

Common Data Service поддерживает интеграцию с [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)], позволяя использовать возможности управления документами [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] в Common Data Service. Порталы Power Apps теперь поддерживает отправку и отображение документов непосредственно в [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] в форме сущности или веб-форме на портале. Это позволит пользователям портала просматривать, загружать, добавлять и удалять документы на портале. Пользователи портала также могут создавать вложенные папки для организации документов.

> [!NOTE]
> - Управление документами работает только с [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)].
> - Управление документами поддерживается в интеграции на основе сервера.

Для работы с функциями управления документами [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] в Common Data Service необходимо выполнить следующие действия.

1.  [Включение функций управления документами в приложения на основе модели в Dynamics 365](#step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365)

2.  [Настройка интеграции SharePoint из центра администрирования порталов Power Apps](#step-2-set-up-sharepoint-integration-from-power-apps-portals-admin-center)

3.  [Включение управления документами для сущностей](#step-3-enable-document-management-for-entities)

4.  [Настройка соответствующей формы в документах Power Apps](#step-4-configure-the-appropriate-form-to-display-documents)

5.  [Создание соответствующего разрешения сущности и его назначение соответствующей веб-роли](#step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role)

## <a name="step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365"></a>Шаг 1. Включение функций управления документами в приложения на основе модели в Dynamics 365

Необходимо включить функцию управления документами в управляемых моделью приложениях в Dynamics 365, используя интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] на основе сервера. Интеграция с [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] на основе сервера позволяет управляемым моделью приложениям в Dynamics 365 и [!INCLUDE[pn-microsoft-sharepoint-online](../../includes/pn-microsoft-sharepoint-online.md)] выполнять подключение сервер-сервер. На портале используется запись сайта [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] по умолчанию. Сведения о том, как включить функцию управления документами в управляемых моделью приложениях в Dynamics 365, см. в разделе [Настройка управляемых моделью приложений в Dynamics 365 для использования SharePoint Online](https://docs.microsoft.com/power-platform/admin/set-up-dynamics-365-online-to-use-sharepoint-online).

## <a name="step-2-set-up-sharepoint-integration-from-power-apps-portals-admin-center"></a>Шаг 2: Настройка интеграции с SharePoint из Центра администрирования порталов Power Apps

Чтобы использовать возможности управления документами в [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)], необходимо включить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] в центре администрирования порталов Power Apps.

> [!NOTE]
> Для выполнения этого действия необходимо быть глобальным администратором.

1. Открытие [Центра администрирования портала Power Apps](admin/admin-overview.md).

2.  Перейдите в раздел **Настройка интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]** > **Включить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]**.

    > [!div class=mx-imgBorder]
    > ![Включение интеграции SharePoint](media/enable-sharepoint-integration.png "Включить интеграцию SharePoint")

3.  Выберите **Включить** в окне подтверждения. Это обеспечит взаимодействие портала с [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. При включении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] портал перезапустится и станет недоступен на несколько минут. После включения интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] отобразится сообщение.

Если интеграция [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] включена, станет доступным следующее действие:

- **Отключить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]**: позволяет отключить интеграцию [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] на портале. При отключении интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] портал перезапустится и станет недоступен на несколько минут. После отключения интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] отобразится сообщение.

    > [!div class=mx-imgBorder]
    > ![Отключение интеграции с SharePoint](media/disable-sharepoint-integration.png "Отключение интеграции с SharePoint")

Включение или отключение интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] приведет к обновлению приложения [!INCLUDE[pn-azure-active-directory](../../includes/pn-azure-active-directory.md)] ([!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD) для портала и добавлению или удалению требуемых разрешений [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] соответственно. Также вы будете перенаправлены на страницу, где необходимо предоставить согласие на внесение изменений в приложение [!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD. 

> [!div class=mx-imgBorder]
> ![Отключение интеграции с SharePoint](media/sharepoint-integration-consent.png "Отключение интеграции с SharePoint")

Если не предоставить согласие:

- Включение или отключение интеграции [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)] не будет выполнено, и отобразится сообщение об ошибке.

- Ваши готовые данные для входа [!INCLUDE[pn-azure-shortest](../../includes/pn-azure-shortest.md)] AD на портале не будут работать. 


## <a name="step-3-enable-document-management-for-entities"></a>Шаг 3. Включение управления документами для сущностей
Необходимо включить управление документами для сущностей для хранения документов, связанных с записями сущностей в [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. Сведения о том, как включить управление документами для сущностей, см. [в разделе Включение управления документами SharePoint для отдельных сущностей](https://docs.microsoft.com/dynamics365/customer-engagement/admin/enable-sharepoint-document-management-specific-entities).

## <a name="step-4-configure-the-appropriate-form-to-display-documents"></a>Шаг 4. Настройка соответствующей формы для отображения документов

### <a name="power-apps-customization"></a>Настройка Power Apps

Определите форму, в которой требуется использовать возможности управления документами. Необходимо изменить эту форму с помощью редактора форм управляемого моделью приложения и добавить в нее вложенную сетку. Вложенная сетка добавляет раздел в форму, который позволяет работать с документами с портала. Необходимо настроить следующие свойства во вложенной сетке для работы этой функции.

- В разделе **Источник данных** выберите **Расположения документов** в списке **Сущность**.

- В разделе **Источник данных** выберите **Активные расположения документов** в списке **Представление по умолчанию**.

Можно указать имя и подпись согласно требованиям. Сохраните и опубликуйте форму после добавления и настройки вложенной сетки.

> [!NOTE]
> Управление документами необходимо включить для сущности, для которой была изменена форма. Дополнительные сведения: [Включение управления документами для сущностей](#step-3-enable-document-management-for-entities)

### <a name="power-apps-portals-configuration"></a>Настройка порталов Power Apps

Помимо стандартной конфигурации, требуемой для формы сущности или веб-формы, необходимо настроить следующие свойства для включения управления документами:

- **Имя сущности** и **Имя формы**: введите имена сущности и формы, настроенные на предыдущем шаге, соответственно.

- Установите флажок **Включить разрешение сущности** в форме, чтобы разрешить пользователю читать документы.

- Для параметра **Режим** выберите значение **Изменить**, чтобы разрешить отправку документов.

> [!NOTE]
> Для отправки документа требуется, чтобы запись родительской сущности существовала. Если установить режим вставки, отправка документа не будет работать, поскольку запись родительской сущности не создается, пока форма не будет отправлена.

## <a name="step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role"></a>Шаг 5. Создание соответствующего разрешения сущности и его назначение соответствующей веб-роли

Для предоставления требуемого доступа на просмотр и отправку документов требуется два разрешения сущности.

- Разрешения для сущности формы сущности или веб-формы: 
    - Создайте запись **Разрешение сущности**, указав **Имя сущности** в качестве сущности формы сущности или веб-формы, настроенной ранее. 
    - Выберите **Область** и отношение области, соответствующее требуемому поведению формы. 
    - Включите привилегии **Чтение** и **Добавить к**, чтобы разрешить доступ на чтение документов, и при необходимости включите привилегию **Запись**, чтобы разрешить отправку документов. Игнорируйте раздел **Дочерние разрешения сущности** на данном этапе, поскольку он будет заполнен на следующем шаге.
- Разрешения в разделе **Расположение документа**, где **Родительская область** ссылается на предыдущую запись разрешения: 
    - Создайте запись **Разрешение сущности**, указав **Имя сущности** как **Расположение документа**, для параметра **Область** которого задано значение **Родительский объект**. 
    - Выберите родительское разрешение сущности для записи разрешения сущности, созданной на предыдущем шаге. 
    - Права 
        - Минимальные привилегии, разрешающие доступ на чтение к документам: **Чтение**, **Создание** и **Добавление**. 
        - Включите привилегии **Запись** для доступа к отправке документов. 
        - Включите **Удаление**, чтобы разрешить удаление документа.

> [!NOTE]
> Соответствующее дочернее разрешение сущности в сущности **Расположение документа** необходимо создать для каждого экземпляра записи родительского разрешения сущности, которая существует в сущности формы сущности или веб-формы, в которой требуется отобразить документы.

## <a name="configure-file-upload-size"></a>Настройка размера отправляемого файла

По умолчанию размер файла составляет 10 МБ. Тем не менее, вы можете настроить размер файла до 50 МБ максимум с помощью параметра сайта `SharePoint/MaxUploadSize`.

## <a name="sample-configuration-to-enable-document-management-on-the-case-entity-form"></a>Пример конфигурации для включения управления документами в форме сущности обращения

В примере ниже показана конфигурация с использованием сущности обращения, для которой необходимо приложение Dynamics 365 Customer Service как предварительное условие. Хотя в этом примере используется сущность обращения, это просто иллюстрация шагов, упомянутых выше, и ей можно следовать с любым другим настраиваемым объектом или другим объектом Common Data Service, который поддерживает управление документами в SharePoint. 

1.  Следуйте инструкциям на [шаге 1](#step-1-enable-document-management-functionality-in-model-driven-apps-in-dynamics-365), чтобы завершить настройку на основе сервера для интеграции управляемых моделью приложений в Dynamics 365 и [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)].

2.  Следуйте инструкциям на [шаге 2](#step-2-set-up-sharepoint-integration-from-power-apps-portals-admin-center), чтобы гарантировать наличие у портала разрешений на интеграцию с [!INCLUDE[pn-sharepoint-short](../../includes/pn-sharepoint-short.md)]. 

3.  Следуйте инструкциям на [шаге 3](#step-3-enable-document-management-for-entities), чтобы гарантировать включение управления документами для сущности "Обращение".

4.  Следуйте инструкциям на [шаге 4](#step-4-configure-the-appropriate-form-to-display-documents) со следующими конфигурациями:

    - Управляемые моделью приложения в настройке Dynamics 365

        a. Перейдите в раздел **Параметры** > **Настройка** > **Настроить систему**. 

        b. В разделе **Решение по умолчанию** перейдите к сущности **Обращение** > **Формы**. 
    
        c. Откройте **Интернет — Изменение обращения** в редакторе форм.

         > [!div class=mx-imgBorder]
         > ![Форма "Интернет — Изменение обращения"](media/web-edit-case-form.png "Форма "Интернет — Изменение обращения"")
    
        d. Выберите поле **Дата создания** в форме и на вкладке **Вставка** выберите **Вложенная сетка**.

         > [!div class=mx-imgBorder]
         > ![Добавить вложенную сетку в форму "Интернет — изменить обращение"](media/add-sub-grid.png "Добавить вложенную сетку в форму "Интернет — изменить обращение"")
    
        e. В диалоговом окне **Задать свойства** задайте следующие свойства и нажмите кнопку **OK**:

         - **Имя** (это может быть любое имя): CaseDocuments 
    
         - **Подпись** (это может быть любое имя подписи): "Документы обращения" 
      
         - **Сущность**: "Расположения документов" 
    
         - **Представление по умолчанию**: "Активные расположения документов"

         > [!div class=mx-imgBorder]
         > ![Свойства вложенной сетки](media/sub-grid-properties.png "Свойства вложенной сетки")

        f. В редакторе форм выберите **Сохранить** и нажмите **Опубликовать**.

    - Настройка порталов Power Apps

        a. Перейдите в раздел **Порталы** > **Формы сущностей**.
    
        b. Найдите и откройте форму сущности **Обслуживание клиентов — Изменение обращения**.
    
        c. Просмотрите и убедиться в том, чтобы заданы следующие свойства:
    
         - **Имя сущности**: "Обращение (инцидент)"
    
         - **Имя формы**: "Интернет — Изменение обращения""
    
         - **Режим**: "Изменить"
    
         - **Разрешение сущности**: "Включено"
    
         > [!div class=mx-imgBorder]
         > ![Форма "Customer Service — Изменение обращения"](media/customer-service-edit-case-form.png "Форма "Customer Service — Изменение обращения"")
    
        d. Если вы внесли какие-либо изменения в форму, выберите **Сохранить**.

5. Выполните инструкции на [шаге 5](#step-5-create-appropriate-entity-permission-and-assign-it-to-the-appropriate-web-role
), чтобы убедиться, что пользователям предоставлены разрешения сущности.

   1. Перейдите к записи **Веб-роль**, связанной с пользователем. В этом примере мы предполагаем, что у пользователя есть веб-роль администратора.

   2. Убедиться, чтобы запись разрешения сущности существует под именем **Обслуживание клиентов — Обращения, в которых контактом является клиент**. 

      > [!NOTE]
      > Убедитесь, что в веб-роль добавлено это разрешение сущности. Если пользователь уж является администратором, вышеуказанное разрешение сущности необходимо назначить явно.

   3. Создайте новое разрешение сущности, введите следующие данные и выберите **Сохранить**.

    - **Имя** (это может быть любое имя): "Обслуживание клиентов — Связанные документы"

    - **Имя сущности**: "Расположение документа"
        
    - **Область**: "Родительский объект"
        
    - **Родительское разрешение сущности**: "Обслуживание клиентов — Обращения, в которых контактом является клиент"
        
    - **Родительское отношение**: incident_SharePointDocumentLocations
        
    - **Привилегии**: "Чтение", "Создание", "Добавление", "Запись", "Удаление"

      > [!div class=mx-imgBorder]
      > ![Разрешение сущности Customer Service](media/customer-service-entity-permission.png "Разрешение сущности Customer Service")
  
   4. Войдите на портал, чтобы проверить, что управление документами включено для сущности "Обращение".

      a. Вернитесь на страницу **Поддержка**.

      > [!div class=mx-imgBorder]
      > ![Страница поддержки портала](media/portal-support-page.png "Страница поддержки портала")

      b. Щелкните существующую запись "Обращение" в списке. Перейдите в раздел **Документы обращения** на странице и просмотрите список добавленных документов.

      > [!div class=mx-imgBorder]
      > ![Документ обращения](media/case-document.png "Документ обращения")

