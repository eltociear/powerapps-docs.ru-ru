---
title: Определение форм сущности | MicrosoftDocs
description: Инструкции по созданию форм сущностей на портале.
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 04/09/2020
ms.author: tapanm
ms.reviewer: ''
ms.openlocfilehash: 4ddc8daba01d281a483d51b1ce7a42205d0c6e93
ms.sourcegitcommit: 2484ebce6563cfd1c849e1e2f66dd2d29fdb7b64
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2020
ms.locfileid: "3256694"
---
# <a name="about-entity-forms"></a>О формах сущностей

Управляемая данными конфигурация, чтобы позволить пользователям добавлять форму для сбора данных на портал без необходимости разработчику отображать форму на портале, формы сущностей создаются в Common Data Service, а затем помещаются на веб-страницы портала или используются совместно с вложенными сетками и списками сущностей для построения готовых веб-приложений. [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [О списках сущностей](entity-lists.md) 

![Форма контактов](../media/contact-us-form.png "Форма контактов")  

## <a name="add-a-form-to-your-portal"></a>Добавление формы на портал

Форма сущности содержит отношения с веб-страницами и дополнительные свойства для управления инициализацией формы на портале. Отношения с веб-страницами обеспечивают динамическое извлечение определения формы для указанного узла страницы на веб-сайте. 

Для просмотра существующих форм сущностей или для создания новых форм сущностей откройте [приложение управление порталами](configure-portal.md) и перейдите к пункту **Порталы** &gt; **Формы сущностей**.

При создании новой формы сущности на первом шаге требуется выбрать **Сущность** и **Имя формы**, которые будут представляться, а также **режим: Вставить, Изменить или Только чтение**. Выбранный режим определяет, создается ли новая запись из портала, изменяется существующая запись или только отображаются сведения о записи на портале.

> [!Note]
> - **Форма сущности** должна быть связана с веб-страницей для определенного веб-сайта, чтобы эта форма была видна на этом сайте.
> - Вложенные сетки сущности соединения не поддерживаются в формах сущностей. Если добавить вложенную сетку соединения в форму с помощью конструктора формы, сообщения об ошибке отображаются при отрисовке формы на портале и использования сущности соединения.
> - Повторяющиеся поля, набор параметров с выбором нескольких вариантов, настраиваемые элементы управления, поля списка сторон и бизнес-правила не поддерживаются в формах сущностей.
> - Бизнес-правила и клиентский API могут открыть доступ к заблокированным полям в доступной только для чтения форме.
> - При создании формы сущности в режиме вставки невозможно изменить выравнивание кнопки или вставить кнопку действия над формой сущностей.
> - Если элемент управления подстановки отображается в форме как раскрывающийся список, фильтр связанных записей не работает.

Веб-страницы, связанные с формой сущности, можно просмотреть, выбрав ссылку **Веб-страницы**, имеющуюся в ссылках навигации **В отношении** в самом левом меню.

При создании или изменении веб-страницы можно указать пункт **Форма сущности** в поле поиска, предусмотренном на форме "Веб-страница".

Различные главные страницы, используемые порталом, содержат объявления элемента управления сервера **EntityForm**. При обработке веб-страницы, содержащей шаблон страницы "Страница" (~/Pages/Page.aspx) или "Полная страница" (~/Pages/FullPage.aspx), элементы управления определяют, содержит ли поиск формы сущностей значение; в этом случае форма будет отображена.

## <a name="secure-your-forms"></a>Защита форм

Чтобы защитить свои формы, необходимо создать разрешения сущностей, которые определяют доступ и права собственности для записей в соответствии с веб-ролями. Если пользователь перешел на форму сущности и не имеет разрешений, он получит сообщение об ошибке. Чтобы включить разрешения для форм сущностей, задайте для параметра **Включить разрешения сущности** истинное значение. [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [Создание веб-ролей для порталов](create-web-roles.md).  

## <a name="entity-form-attributes-and-relationships"></a>Атрибуты и отношения формы сущностей

|Имя|Описание|
|-----|----------|
|Имя|Описательное имя записи. Это поле является обязательным.|
|Имя сущности|Имя сущности, из которой будет загружена форма. Это поле является обязательным.|
|Имя формы|    Имя формы в целевой сущности, которую требуется обработать. Это поле является обязательным.|
|Имя вкладки|    Необязательное имя вкладки на форме для указанной сущности, которую требуется обработать.|
|Режим|Одно из следующих значений:<ul><li>Вставка</li><li>Редактировать</li><li>ReadOnly</li></ul>Выбор _Вставка_ указывает, что форма должна вставить новую запись при отправке. Выбор _Редактировать_ указывает, что форма должна изменить существующую запись. Выбор _ReadOnly_ указывает, что форма должна отображать недоступную для редактирования форму существующей записи. _Редактировать_ и _ReadOnly_ требуют, чтобы исходная запись существовала и параметры, определенные в полях "Тип источника записи" и "Имя параметра строки запроса кода записи" выбирали соответствующую запись при загрузке формы в портал.|
|Тип источника записи|Одно из следующих значений:<ul><li>Строка запроса</li><li>Текущий пользователь портала</li><li>Запись, связанная с текущим пользователем портала</li></ul>Для выбора _Строка запроса_ требуется имя параметра, которое требуется задать в строке запроса URL-адреса формы. Это можно указать в поле "Имя параметра строки запроса кода записи".<br>При выборе _Текущий пользователь портала_ извлекается запись пользователя портала для текущего пользователя, прошедшего аутентификацию.<br>При выборе _Запись, связанная с текущим пользователем портала_ извлекается запись пользователя портала для текущего пользователя, прошедшего проверку подлинности, и затем извлекается запись для определенного отношения, указанного в поле "Имя отношения".|
|Имя параметра строки запроса кода записи|    Имя параметра, указанное в строке запроса URL-адреса веб-страницы, содержащей эту форму сущности.|
|Имя отношения|    Обязательно, если тип источника записи имеет значение "Запись, связанная с текущим пользователем портала". Логическое имя отношения между записью текущего пользователя портала и целевой записью. Должно возвращать тот же тип сущности, что и указанный полем "Имя сущности".|
|Разрешить создание, если значение равно Null|    Необязательное логического значения, доступное, если параметр "Тип источника записи" имеет значение "Запись, связанная с текущим пользователем портала". Указывает, что если связанная запись отсутствует, пользователю разрешено создать ее в первый раз, в противном случае будет создано исключение, если запись еще не существует, так как форме требуется запись для связывания с ней данных.|
|Включить разрешения сущности|    Форма будет учитывать разрешения сущности. В целях обратной совместимости значение по умолчанию — false. Если выбрано значение "истина", НЕОБХОДИМЫ явные разрешения для любого пользователя, который хочет получить доступ к форме.|
|||

### <a name="form-options"></a>Параметры формы

|Имя|Описание|
|----|---------|
|Добавить Captcha|    Отображает код Captcha.|
|Показать Captcha для пользователей, прошедших проверку подлинности|    Показывает код Captcha для пользователей, прошедших проверку подлинности.|
|Группа проверки|    Название группы, назначенное элементам управления ввода для оценки допустимого ввода именованных групп.|
|Автоматическое создание шагов из вкладок|    Указывает, что несколько вкладок на форме сущности будут отображаться с каждой вкладкой в виде последовательного шага, начиная с первой вкладки и далее, пока не будет выполнен переход на все вкладки; после отправки запись будет вставлена. По умолчанию не выбрано. Значение по умолчанию означает, что только одна вкладка или форма обрабатывается для текущего шага. Если имя вкладки не указано, отображается первая вкладка.|
|Отображать веб-ресурсы встроенным способом|    Исключает интернет-кадр, содержащий веб-ресурс в форме сущности.|
|Подсказки включены|    Подсказка устанавливается с помощью описания атрибута на целевой сущности.|
|Показать неподдерживаемые поля|    Все поля в настоящее время поддерживаются. Это зарезервировано для потенциальных изменений, которые могут быть сделаны в Common Data Service для типов полей.|
|Установить рекомендованные поля как обязательные|     Делает все атрибуты обязательными, у которых для уровня требований поля установлено значение "Бизнес-рекомендация".|
|Сделать все поля обязательными|     Делает все поля обязательными независимо от уровня требований поля.|
|Класс CSS сводки проверки|    Имя класса CSS, назначенное сводке проверки. По умолчанию «validation-summary alert alert-error alert-block»|
|Включить ссылки на сводки проверки|    Логическое значение (истина или ложь), которое указывает, следует ли ссылки привязки обрабатывать в сводке проверки для прокрутки к полю, содержащему ошибку. Значение по умолчанию — «истина».|
|Текст ссылки на сводку проверки|    Метка, назначенная ссылкам сводки проверки. Значение по умолчанию — «нажмите здесь».|
|Текст заголовка сводки проверки|    Метка, назначенная заголовку сводки проверки.|
|Инструкции|    Инструкции для работы с формой.|
|Сообщение "Запись не найдена"|    Сообщение, которое должно выводиться, если запись не найдена.|
|||

### <a name="on-success-settings"></a>Параметры при успешном завершении

|Имя|Описание|
|----|----------|
|При успешном завершении|    Одно из следующих значений:<ul><li>Показать сообщение об успехе (по умолчанию)</li><li>Перенаправление</li></ul>|
|Скрыть форму при успешном завершении|    Требуется, чтобы для параметра "При успешном завершении" было задано значение "Показать сообщение об успехе". Если выбрано, форма скрывается после успешной отправки формы.|
|Сообщение об успехе|    Требуется, чтобы для параметра "При успешном завершении" было задано значение "Показать сообщение об успехе". Сообщение, отображаемое пользователю после успешной отправки. Если оно не указано, отображается сообщение по умолчанию ("Отправка успешно выполнена"). Для каждого установленного и включенного языкового пакета для организации будет доступно поле для ввода сообщения на соответствующем языке.|
|Внешний URL-адрес|Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Укажите URL-адрес внешнего ресурса в Интернете.
|или веб-страница|Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Выберите веб-страницу на текущем веб-сайте.|
|Добавить существующую строку запроса|    Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Если выбрано, существующие параметры строки запроса будут добавлены к целевому URL-адресу перед перенаправлением.|
|Добавить код записи в строку запроса|     Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Если выбрано, код созданной записи добавляется к строке запроса URL-адреса, на который производится перенаправление.|
|Имя параметра строки запроса кода записи|     Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Имя параметра кода в строке запроса URL-адреса, на который производится перенаправление.|
|Добавить пользовательскую строку запроса|    Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Настраиваемая строка, которую можно добавить к существующей строке запроса URL-адреса перенаправления.|
|Добавить значение атрибута в строку запроса — имя параметра|    Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Имя, присваиваемое параметры, который коррелирует со значением атрибута в целевой сущности, которое добавляется к строке запроса URL-адреса перенаправления.|
|Добавить значение атрибута в строку запроса — логическое имя атрибута|Требуется, чтобы для параметра "При успешном завершении" было задано значение "Перенаправить". Логическое имя атрибута в целевой сущности для получения значения, которое добавляется к строке запроса URL-адреса перенаправления.|
|||

### <a name="additional-settings"></a>Дополнительные параметры

|Имя|Описание|
|----|----------|
|Связать текущего пользователя портала|    Указывает, что запись текущего выполнившего вход пользователя должна быть связана с записью целевой сущности.|
|Атрибут поиска пользователя портала целевых сущностей|    Логическое имя атрибута в целевой сущности, в котором хранится пользователь портала.|
|Является стороной действия|    Логическое значение, указывающее, является ли Атрибут поиска пользователя портала целевых сущностей типом "Сторона действия".|
|Вложить файл |  Выберите, чтобы форма включала элемент управления передачей файла в нижней части формы, позволяя прикрепить файл к записи. <br> **Примечание**: порталы с [версии 9.2.2.x и более поздней](https://support.microsoft.com/help/4541765/power-apps-portals-version-9-2-2-x-release) не требуют включения **Включить разрешения сущности** в форме сущности, чтобы прикрепить файлы. Однако, если он выбран, вы должны убедиться, что для родительской сущности и сущности заметки предоставлены соответствующие привилегии для отображения кнопки **Прикрепить файл** в форме. Сущность заметки должна иметь как минимум привилегии **Создать** и **Добавить** и родительскую сущность должна иметь соответствующий привилегия **Добавить в**. В зависимости от того, есть ли у вас форма для создания или обновления, вам также может понадобиться привилегии **Создать**, **Чтение** и **Запись** для завершения сценария формы. |
|Вложить файл — расположение хранилища|    Параметры: Вложенное примечание, Хранилище больших двоичных объектов Azure. Если организация настроена для использования хранилища Azure, можно выбрать хранение незагруженных файлов для этой формы сущности там. В противном случае файлы будут храниться как вложенное примечание.|
|Разрешить несколько файлов|Логического значение, указывающее, может ли пользователь отправлять несколько файлов.|
|Принять|    Атрибут принятия указывает типы MIME файлов, которые сервер принимает путем отправки файла. Чтобы указать несколько значений, разделяйте значения запятой (например, audio/*,video/*,image/*).|
|Подпись|    Текст, отображаемый рядом с элементом управления отправкой файла. Для каждого установленного и включенного языкового пакета для организации будет доступно поле для ввода сообщения на соответствующем языке.|
|Вложить файл — обязательно| Для продолжения необходим вложенный файл.|
|Обязательное сообщение об ошибке|Сообщение, выводимое во время проверки форм, если в поле "Обязательно" задано значение "Истина" и пользователь не вложил файл. Для каждого установленного и включенного языкового пакета для организации будет доступно поле для ввода сообщения на соответствующем языке.|
|Ограничить файлы допустимыми типами|    Принудительная проверка по полю "Принять". Если не выбрано, атрибут принятия будет использоваться только как предложение для диалога отправки файла.|
|Сообщение об ошибке типа файла|Сообщение, отображаемое в ходе проверки формы, если параметр "Ограничить файлы допустимыми типами" имеет значение "true" и пользователь попытался отправить файл недопустимого типа. Для каждого установленного и включенного языкового пакета для организации будет доступно поле для ввода сообщения на соответствующем языке.|
|Максимальный размер файла (в килобайтах)|    Задает принудительную проверку максимально допустимого размера отправленного файла.|
|Сообщение об ошибке размера файла|    Сообщение, отображаемое в ходе проверки формы, если параметр "Максимальный размер файла (в килобайтах)" имеет значение "true" и пользователь попытался отправить файл слишком большого размера. Для каждого установленного и включенного языкового пакета для организации будет доступно поле для ввода сообщения на соответствующем языке.|
|Пользовательский код JavaScript|    Пользовательский блок кода JavaScript, который будет добавлен в нижнюю часть страницы непосредственно перед закрывающим элементом тега формы. Идентификатор ввода HTML поля сущности установлен на логическое имя атрибута. Это упрощает выбор поля, задание значений и другие операции на стороне клиента с помощью jQuery.<br>`$(document).ready(function() {   $("#address1_stateorprovince").val("Saskatchewan");});`|
|||

### <a name="entity-reference"></a>Ссылка на сущность

Следующие параметры относятся к настройке ссылки сущности при сохранении формы.

Это дает возможность связывать текущую запись, создаваемую или обновляемую формой, с другой целевой записью. Это полезно, если имеется несколько шагов с несколькими типами сущности и требуется связать получившиеся записи или если странице передана строка запроса идентификатора записи, которую требуется связать. Например, имеется страница карьеры, на которой перечислены объявления о должности, каждое со ссылкой на заявление на должность, содержащее идентификатор объявления о должности для формы заявления, чтобы при создании заявления с записью связывалось объявление о должности. 

|Имя (название)|Описание|
|-----|---------|
|Задать ссылку на сущность при сохранении|"Да" или "Нет". Значение "Да" указывает, что ссылка сущности должна быть назначена при сохранении формы, в противном случае ссылка не задается.|
|Имя отношения|Имя определения отношения для определенного отношения между двумя типами сущностей.|
|Логическое имя сущности|Логическое имя ссылочной сущности.|
|Логическое имя атрибута поиска целевого объекта|Логическое имя атрибута поиска в создаваемой или обновляемой целевой сущности.|
|Заполнить поле поиска|    Если в форме имеется поиск, связанный со ссылочной сущностью, при установке этого флажка поле в форме заполняется значением, извлеченным с указанной ниже настройкой.|
|Тип источника справочной сущности|    Одно из следующих значений:<ul><li>Строка запроса</li><li>Текущий пользователь портала</li><li>Результат предыдущего шага</li></ul> Для выбора _Строка запроса_ требуется имя параметра, которое требуется задать в строке запроса URL-адреса формы. Это можно указать в поле **Имя строки запроса**. Если этот параметр является первичным ключом, выберите значение "Да" для параметра **Логическое имя атрибута поиска целевого объекта**, в противном случае выберите "Нет" и укажите логическое имя атрибута в целевой сущности для запроса по указанному в поле **Логическое имя атрибута запроса**.  При выборе Текущий пользователь портала извлекается запись контакта для текущего пользователя, прошедшего аутентификацию. При выборе Результат предыдущего шага извлекается запись, созданная в результате шага до текущего шага или из определенного шага на основании шага, связанного с шагом источника сущности.|
|Шаг ссылочной сущности|    Запись шага веб-формы предыдущего шага для извлечения сущности, созданной или отредактированной на этом шаге, чтобы связать ее с записью для этого текущего шага.|
|Имя строки запроса|    Имя параметра, указанное в строке запроса URL-адреса веб-страницы, содержащей эту веб-форму.|
|Строка запроса является основным ключом|    "Да" означает, что значение строки запроса является значением основного ключа. "Нет" означает, что значение строки запроса имеет тип атрибута, отличный от основного ключа.|
|Логическое имя атрибута запроса|    Логическое имя атрибута для запроса записи.|
|Показать сведения о ReadOnly|    Указывает, что форма должна отображаться в верхней части страницы и содержать сведения только для чтения, относящиеся к ссылочной записи. Требуется имя формы.|
|Имя формы|    Имя формы на ссылочной сущности, которая должна использоваться для отображения сведений только для чтения.|
|||


## <a name="entity-form-action-configuration"></a>Конфигурация действия формы сущности

По умолчанию форма сущностей будет разрешать чтение или обновление существующей записи, или вставку новой записи.  Тем не менее вы можете легко включить и настроить дополнительные действия для записей в форме сущности (такие как удаление, активация, деактивация и т. д.). Также можно переопределить подписи, размеры и другие атрибуты по умолчанию, которые отображаются, если имеются включенные действия.

Эти параметры находятся в разделе **Дополнительные параметры** формы сущности. По умолчанию отображаются только **Основные параметры**. Можно выбрать **Дополнительные параметры** для отображения дополнительных параметров.

Можно добавить кнопки действий для действий, применимых для отдельных записей, которые отображаются для каждой строки в сетке, если соответствующая привилегия была предоставлена в [разрешениях сущности](assign-entity-permissions.md). Возможны следующие действия:

- Удаление
- Бизнес-процесс
- Создать связанную запись
- Активация
- Деактивация

При нажатии на одном из этих параметров отображается область конфигурации для этого действия. Более того, некоторые сущности имеют особенные действия, которые доступны им для каждой отдельной сущности:

- Вычисление значения возможной сделки (возможная сделка)
- Действие отмены обращение (инцидент)
- Действие закрытия (разрешения) обращения (инцидент)
- Преобразование предложения в заказ (предложение с расценками)
- Преобразование заказа в счет (заказ на продажу)
- Создать предложение с расценками из возможной сделки (возможная сделка)
- Действие при упущенной возможной сделке (возможная сделка)
- Действие при реализованной возможной сделке (возможная сделка)
- Действие повторного открытия обращения (инцидент)
- Перевести возможную сделку в отложенное состояние (возможная сделка)

> [!NOTE]
> Рекомендует создать рабочий процесс вместо добавления кнопок **Активировать** или **Деактивировать** для готовых сущностей, определив конкретные значения **состояние** и **код состояния**, которые требуются для их бизнес-процессов. Например, Инцидент ([параметры состояния](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/incident#statuscode-options)), Возможная сделка ([параметры состояния](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/opportunity#statuscode-options)), Объем обслуживания ([параметры состояния](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/entitlement#statuscode-options)). 


## <a name="geolocation-configuration-for-entity-forms"></a>Конфигурация географического положения для форм сущностей

Управляемую форму можно настроить для отображения элемента управления картой для отображения существующего положения в виде булавки на карте или для предоставления пользователям возможности указывать положение. См. раздел [Добавление географического положения](add-geolocation.md).

Элемент управления картой формы требует дополнительной конфигурации для указания того, что идентификаторы различных полей находятся в порядке для назначения их значений или извлечения значений из них. Запись формы сущности имеет раздел конфигурации, в котором определены эти сопоставления полей, которые необходимо указать. Имена полей будут меняться в зависимости от созданной схемы.

![Данные географического положения в форме сущности](../media/geolocation-managed-form.png "Данные географического положения в форме сущности") 

> [!Note]
> - Поле адреса в доступной только для чтения форме сущности заменяется картой, если включен параметр географического положения.
> - Раздел "Географическое положение" не будет отображаться в среде государственного облака в Германии. Если пользователь включил географическое положение, используя другую форму, оно не будет отображаться при отрисовке портала.

## <a name="request-validation"></a>Проверка запроса

[Проверка запроса](https://docs.microsoft.com/aspnet/whitepapers/request-validation) — это особенность ASP.NET с версии 1.1, которая запрещает серверу принимать контент, содержащий незакодированный код HTML. Эта функция предназначена для предотвращения некоторых атак с использованием вставки сценариев, в результате чего код клиентского сценария или HTML может быть незаметно отправлен на сервер, сохранен, а затем представлен другим пользователям. Мы по-прежнему настоятельно рекомендуем проверять все входные данные и кодировать их HTML, когда это необходимо.

По умолчанию проверка запроса включена на портале, что приводит к следующей общей ошибке, если вы вводите код сценария без HTML-кодировки в полях формы сущности:

![Ошибка проверки запроса](../media/request-validation-error.png)

Чтобы отключить проверку запросов, выполните следующие действия.

1. Перейдите в [параметры портала](https://docs.microsoft.com/powerapps/maker/portals/manage-existing-portals#settings) и выберите **Параметры сайта**.

1. Выберите **Создать**.

1. Введите имя как **DisableValidationWebTemplate**.

1. Выберите соответствующую запись на веб-сайте.

1. Введите значение **true**. По умолчанию настройка **false**, что разрешает проверку запросов.

1. Введите соответствующее описание.

1. Выберите **Сохранить и закрыть**.

> [!CAUTION]
> Когда проверка запросов отключена, контент может быть отправлен на страницу. Вы должны убедиться, что контент правильно закодирован или обработан.

### <a name="see-also"></a>См. также

[Настройка портала](configure-portal.md)  
[Свойства веб-формы для порталов](web-form-properties.md)  
[Шаги веб-формы для порталов](web-form-steps.md)  
[Метаданные веб-форм для порталов](configure-web-form-metadata.md)  
[Конфигурация вложенной сетки веб-форм для порталов](configure-web-form-subgrid.md)  
[Конфигурация примечаний для форм сущностей и веб-форм на порталах](../configure-notes.md)
