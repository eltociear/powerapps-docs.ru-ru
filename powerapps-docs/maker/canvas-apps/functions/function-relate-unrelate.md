---
title: Связать и отвязать функции | Документация Майкрософт
description: Справочные сведения, включая синтаксис и пример, для ссылка и отвязать функции в PowerApps
author: gregli-msft
manager: kvivek
ms.service: powerapps
ms.topic: reference
ms.custom: canvas
ms.reviewer: anneta
ms.date: 01/22/2019
ms.author: gregli
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 4b2c6b9518e987ef17f2ff2b50987568c8a0b69f
ms.sourcegitcommit: 4042388fa5e7ef50bc59f9e35df330613fea29ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61527521"
---
# <a name="relate-and-unrelate-functions-in-powerapps"></a>Связать и отвязать функции в PowerApps

Связать и отвязать записей из двух сущностей через отношение один ко многим "или" многие ко многим.

## <a name="description"></a>Описание

**Relate** функция связывает две записи через отношение "один ко многим" или "многие ко многим" в Common Data Service. **Unrelate** функция выполняет обратное преобразование и удаляет связь.

Для отношения один ко многим многие сущность содержит поля внешнего ключа, указывающим на запись одной сущности. **Связать** устанавливает для этого поля, чтобы он указывал на определенную запись одной сущности, хотя **Unrelate** присваивают этому полю *пустой*. Если поле уже установлено при **Relate** — вызове существующую ссылку теряется пользу новой ссылки. Это поле можно также задать с помощью [ **Patch** ](function-patch.md) функции или **[форма редактирования](../controls/control-form-detail.md)** управления; вы не доступа **ссылка**  функции.

Для связей многие ко многим система, связывающий записи хранит таблица скрытые соединения. Эта таблица join недоступны непосредственно. можно прочитать только один ко многим проекцию и задать с помощью **Relate** и **Unrelate** функции. Ни одна из связанной сущности содержит foreign key.

Данные сущности, указанной в первом аргументе будут обновляться в соответствии с изменениями, но не данные сущности, указываемый в качестве второго аргумента. Данные должны быть вручную обновляются с использованием **[обновить](function-refresh.md)** функции для отображения результатов операции.

Эти функции никогда не создавать или удалять записи. Они только связанные или отвязать две записи, которые уже существуют.

Эти функции можно использовать только в [формулах поведения](../working-with-formulas-in-depth.md).

> [!NOTE]
> Эти функции являются частью функцию предварительного просмотра, и их поведение было доступно, только если **реляционных данных, наборы параметров и другие новые функции для компакт-ДИСКОВ** включена функция. Это параметр уровня приложения, включенный по умолчанию для новых приложений. Чтобы найти этот переключатель, откройте **файл** меню, выберите **параметры приложения**, а затем выберите **Дополнительные параметры**. Ваш отзыв очень важен для нас — сообщите нам свое мнение на [форумах сообщества PowerApps](https://powerusers.microsoft.com/t5/Expressions-and-Formulas/bd-p/How-To).

## <a name="syntax"></a>Синтаксис

**Связать**( *Entity1RelatedTable*, *Entity2Record* )

* *Entity1RelatedTable* — обязательный. Для записи *Entity1*, таблице *Entity2* записи, связанные через связи один ко многим "или" многие ко многим.
* *Entity2Record* — обязательный. *Entity2* записи для добавления к связи.

**Отвязать**( *Entity1RelatedTable*, *Entity2Record* )

* *Entity1RelatedTable* — обязательный. Для записи *Entity1*, таблице *Entity2* записи, связанные через связи один ко многим "или" многие ко многим.
* *Entity2Record* — обязательный. *Entity2* запись для удаления из отношения.

## <a name="examples"></a>Примеры

Рассмотрите возможность **продуктов** сущность с следующие связи, как показано на [средство просмотра сущности портал PowerApps](../../common-data-service/create-edit-entities-portal.md):

| Отображаемое имя связи | Связанная сущность | Тип связи |
| --- | --- |
| Резервирование продукта | Резервирование | один ко многим |
| Продукт &harr; контакта | Связь | Многие ко многим |

**Продукты** и **резервирования** связаны через один ко многим связи.  Чтобы связать первой записи **резервирования** сущность с первой записи **продуктов** сущности:

`Relate( First( Products ).Reservations, First( Reservations ) )`

Чтобы удалить связь между этими записями:

`Unrelate( First( Products ).Reservations, First( Reservations ) )`

Никогда не мы создавали или remove или записи, только связь между записями был изменен.

**Продукты** и **контакты** связаны через многие ко многим связи.  Чтобы связать первой записи **контакты** сущность с первой записи **продуктов** сущности:

`Relate( First( Products ).Contacts, First( Contacts ) )`

Как многие ко многим связи являются симметричными, мы также выполнения этой задачи в обратном направлении:

`Relate( First( Contacts ).Products, First( Products ) )`

Чтобы удалить связь между этими записями:

`Unrelate( First( Products ).Contacts, First( Contacts ) )`

или:

`Unrelate( First( Contacts ).Products, First( Products ) )`

Пошагового руководства, следующим выполняет именно эти операции на эти сущности, с помощью приложения с помощью **коллекции** и **поле со списком** элементов управления для выбора связанных записей.

Эти примеры зависят от образец данных, установленного в вашей среде. Либо [Создание пробной среды, включая примеры данных](../../model-driven-apps/overview-model-driven-samples.md#get-sample-apps) или [Добавление демонстрационных данных в существующую среду](../../model-driven-apps/overview-model-driven-samples.md#install-or-uninstall-sample-data).

### <a name="one-to-many"></a>один ко многим

#### <a name="relate-function"></a>**Связать** функции

Сначала вы создадите простое приложение для просмотра и переназначить резервирования, которые связаны с продуктом.

1. Создание [планшетное приложение с нуля](../data-platform-create-app-scratch.md).

1. На вкладке **Вид** выберите **источники данных**.

1. В **данных** области выберите **добавить источник данных** > **Common Data Service** > **продуктов**  >  **Подключения**.  

    Сущности продуктов является частью образца данных загрузки выше.

     ![Добавьте сущности продуктов в качестве источника данных](media/function-relate-unrelate/products-connect.png)

1. На **вставить** вкладку, добавьте пустая, вертикальная **[коллекции](../controls/control-gallery.md)** элемента управления.

1. Убедитесь, что элемент управления, который вы только что добавили называется **Gallery1**, а затем переместите и измените размер для заполнения левой части экрана.

1. На **свойства** вкладке **Gallery1** **элементы** свойства **продуктов** и его **макета** для **Изображение и заголовок**.

    ![Настройка ProductsGallery](media/function-relate-unrelate/products-gallery.png)

1. В **Gallery1**, убедитесь, что **метка** элемент управления называется **Title1**и задайте его **текст** свойства  **ThisItem.Name**.

    ![Настройте метку в Gallery1](media/function-relate-unrelate/products-title.png)

1. Выберите экран, во избежание вставки следующего элемента в **Gallery1**.  Добавьте второй пустая, вертикальная **коллекции** управления и убедитесь, что он называется **загрузка Gallery2**.

    **Загрузка Gallery2** покажет резервирования для любого продукта, пользователь выбирает в **Gallery1**.

1. Перемещение и изменение размеров **загрузка Gallery2** для заполнения верхний правый квадрант части экрана.

1. (необязательно) Добавление синюю **метка** управления выше **загрузка Gallery2**, как показано на следующем рисунке.

1. В строке формул задайте **элементы** свойство **загрузка Gallery2** для **Gallery1.Selected.Reservations**.

    ![Настройка элементов загрузка Gallery2](media/function-relate-unrelate/reservations-gallery.png)

1. В панели «Свойства» задайте **загрузка Gallery2** **макета** для **Title**.

    ![Настройка макета загрузка Gallery2](media/function-relate-unrelate/reservations-gallery-right.png)

1. В **загрузка Gallery2**, добавьте **[поле со списком](../controls/control-combo-box.md)** управления, убедитесь, что он называется **ComboBox1**, а затем переместите и измените ее, чтобы избежать блокировки другие элементы управления в **загрузка Gallery2**.

1. На **свойства** вкладке **ComboBox1** **элементы** свойства **продуктов**.

    ![Значение свойства Items](media/function-relate-unrelate/reservations-combo-right.png)

1. Прокрутите вниз содержимое **свойства** вкладку и задайте **ComboBox1** **разрешить выбор нескольких элементов** свойства **Off**.

    ![Набор разрешить выбор нескольких элементов значение Выкл.](media/function-relate-unrelate/reservations-singleselect-right.png)

1. В строке формул задайте **ComboBox1** **DefaultSelectedItems** свойства **ThisItem. «Резервирование продукта»** .

    ![Задайте для ReserveCombo DefaultSelectedItems](media/function-relate-unrelate/reservations-combo.png)

1. В **загрузка Gallery2**, задайте **NextArrow2** **OnSelect** следующую формулу:

    ```powerapps-dot
    Relate( ComboBox1.Selected.Reservations, ThisItem )
    ```

    Когда пользователь щелкнет этот значок, текущее резервирование изменяется на продукт, который пользователь выбрал в **ComboBox1**.

    ![Настройка NextArrow2](media/function-relate-unrelate/reservations-relate.png)

1. Нажмите клавишу F5, чтобы протестировать приложение в режиме предварительного просмотра.

С этим приложением пользователь может перемещать резервирование в одном продукте, в другой. Для резервирования на один продукт, пользователь может выбрать другой продукт в **ComboBox1** , а затем выберите **NextArrow2** для изменения этого резервирования.

![Демонстрации ссылка функции в приложении один ко многим](media/function-relate-unrelate/reservations-reassign.gif)

#### <a name="unrelate-function"></a>**Отвязать** функции

На этом этапе связи можно перемещать из одной записи в другую, но нельзя удалить связь полностью. Можно использовать **Unrelate** функцию, отключить запись резервирования от любого продукта.

1. На вкладке **Вид** выберите **источники данных**.

1. В **данных** области выберите **добавить источник данных** > **Common Data Service** > **резервирования**  >  **Подключения**.

1. В **загрузка Gallery2**, задайте **OnSelect** формул для **NextArrow2** следующую формулу:

    ```powerapps-dot
    If( IsBlank( ComboBox1.Selected ),
        Unrelate( Gallery1.Selected.Reservations, ThisItem ),
        Relate( ComboBox1.Selected.Reservations, ThisItem )
    );
    Refresh( Reservations )
    ```
    ![Настройка значок справа](media/function-relate-unrelate/reservations-relate-unrelate.png)

1. Копировать **загрузка Gallery2** в буфер обмена, выбрав его и нажав Ctrl-C.

1. Вставьте копию **загрузка Gallery2** на тот же экране, нажав клавиши Ctrl + V, а затем переместите ее в нижнем правом квадранте части экрана.

1. (необязательно) Если вы добавили метки выше **загрузка Gallery2**, повторите два предыдущих шага для этой метки.

1. Убедитесь, что дубликатом **загрузка Gallery2** называется **Gallery2_1**, а затем установите его **элементы** следующую формулу:

    ```powerapps-dot
    Filter( Reservations, IsBlank( 'Product Reservation' ) )
    ```

    Появится предупреждение делегирования, но это не имеет значения с небольшой объем данных в этом примере.

    ![Задайте для свойства элементов Gallery2_1](media/function-relate-unrelate/reservations-lost.png)

С этими изменениями, пользователи могут снять выделение в **ComboBox1** для контакта, если он еще не защищены продукта. Контакты, которые еще не защищены продукта отображаются в **Gallery2_1** где пользователи могут назначать каждого идентификатора контактного лица в продукт.

   ![Демонстрации ссылка и отвязать функций в приложении-один ко многим](media/function-relate-unrelate/reservations-lostandfound.gif)

### <a name="many-to-many"></a>Многие ко многим

#### <a name="create-a-many-to-many-relationship"></a>Создание связи многие ко многим

Образец данных не включает многие ко многим, но вы создадите один между сущностями продуктов и контакты. Пользователей можно связать каждый продукт несколько контактных лиц и каждого контакта для более одного продукта.

1. Из [эту страницу](https://web.powerapps.com?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc)выберите **данных** на левой навигационной панели, а затем выберите **сущностей**.

    ![Откройте список сущностей](media/function-relate-unrelate/entity-list.png)

1. Измените фильтр сущности, чтобы включать в себя все сущности.

    Пример сущности не отображаются по умолчанию.

    ![Удалить фильтр сущности](media/function-relate-unrelate/entity-all.png)

1. Прокрутите вниз, открытым **продукта** сущности, а затем выберите **связи**.

    ![Вкладка связи для сущности продукта](media/function-relate-unrelate/entity-relationships.png)

1. Выберите **добавить связь** > **многие ко многим**.

    ![Добавить связь многие ко многим](media/function-relate-unrelate/entity-manytomany.png)

1. Выберите **контакт** сущности для связи.

    ![Выберите сущность "Контакт"](media/function-relate-unrelate/entity-contact.png)

1. Выберите **сделать** > **сохранить сущность**.

    ![Список связей для сущности продуктов](media/function-relate-unrelate/entity-done.png)

#### <a name="relate-and-unrelate-contacts-with-one-or-more-products"></a>Связать и отвязать контакты с одного или нескольких продуктов

Вы создадите другое приложение, похожий на тот, который вы создали ранее в этом разделе, но новое приложение предложит связи многие ко многим. Каждого идентификатора контактного лица будут иметь возможность зарезервировать несколько продуктов, а не только один.

1. В пустое приложение для планшетов, создайте **Gallery1** как [первой процедуре](#one-to-many) описаны далее.

1. Добавить другой пустая, вертикальная **коллекции** управления, убедитесь, что он имеет имя **загрузка Gallery2**, а затем переместите ее в правом верхнем углу экрана.

    Далее в этом разделе вы добавите **поле со списком** управления в разделе **загрузка Gallery2**.

1. В строке формул задайте **загрузка Gallery2** **элементы** свойства **Gallery1.Selected.Contacts**.

    ![Настройка ContactsGallery](media/function-relate-unrelate/contacts-gallery.png)

1. На **свойства** вкладке **макета** для **изображение и заголовок**.

    ![Настройка ContactsGallery](media/function-relate-unrelate/contacts-gallery-right.png)

1. В **загрузка Gallery2**, убедитесь, что **метка** элемент управления называется **Заголовок2**и задайте его **текст** свойства  **ThisItem. «Full Name»** .

    Текст не будет отображаться в этом элементе управления до завершения данной процедуры и назначить контакт в продукт.

    ![Показать имя контакта](media/function-relate-unrelate/contacts-title.png)

1. Удалить **NextArrow2**, вставить **отменить** значок и убедитесь, что он называется **icon1**.

1. Задайте **отменить** значка **OnSelect** следующую формулу: 

    ```powerapps-dot
    Unrelate( Gallery1.Selected.Contacts, ThisItem )
    ```

    ![Значок отмены настройки](media/function-relate-unrelate/contacts-unrelate.png)

1. На вкладке **Вид** выберите **источники данных**.

1. В **данных** области выберите **добавить источник данных** > **Common Data Service** > **контакты**  >  **Подключения**.

1. В разделе **загрузка Gallery2**, добавьте **поле со списком** управления, убедитесь, что он называется **ComboBox1**и задайте его **элементы** свойства **Контакты**.

    ![Настройка свойства Items поле со списком](media/function-relate-unrelate/contacts-combo.png)

1. На **свойства** вкладке **разрешить выбор нескольких элементов** для **Off**.

    ![Настройка поля со списком свойств макета](media/function-relate-unrelate/contacts-combo-right.png)

1. Вставить **добавить** значок и задайте его **OnSelect** следующую формулу: 

    ```powerapps-dot
    Relate( Gallery1.Selected.Contacts, ComboBox1.Selected )
    ```

    ![Добавить значок настройки](media/function-relate-unrelate/contacts-relate.png)

С этим приложением пользователи теперь можно свободно связанных и отвязать набор контактов для каждого продукта.

- Чтобы добавить контакт в продукт, выберите контакт в поле со списком в нижней части экрана и выберите **добавить** значок.
- Для удаления контакта из продукта выберите **отменить** значок для этого контакта.

    В отличие от один ко многим многие ко многим позволяет пользователю связать контактах с несколькими продуктами.

![Демонстрации ссылка и отвязать функций в приложении многие ко многим](media/function-relate-unrelate/contacts-relate-unrelate.gif)

#### <a name="in-reverse-relate-and-unrelate-products-with-multiple-contacts"></a>В обратном порядке: связать и отвязать продуктов с несколькими лицами

Связи многие ко многим симметричны. Вы можете расширить пример добавить продукты контакта, а затем переключаться между двумя экранами, чтобы показать, как связь будет отображена в любых направлениях.

1. Задайте **OnVisible** свойство **Screen1** для **обновить (продукты)** .

    При обновлении отношение один ко многим "или" многие ко многим, только данные первого аргумента сущности **Relate** или **Unrelate** вызов обновляется. Второй должен быть обновлен вручную в том случае, если требуется отразить между экранами этого приложения.

    ![Задайте значение OnVisible функции Refresh](media/function-relate-unrelate/contacts-refresh.png)

1. Дублировать **Screen1**.

    Дубликат будет называться **Screen1_1** и формируют основу для рассмотрения связи со стороны контактов.

    ![Дублирование экрана.](media/function-relate-unrelate/contacts-duplicate.png)

1. Чтобы создать обратный просмотр, изменить эти формулы для элементов управления из **Screen1_1**:

    - Screen1_1.OnVisible = `Refresh( Contacts )`
    - Gallery1_1.Items = `Contacts`
    - Title1_1.Text = `ThisItem.'Full Name'`
    - Label1_1.Text = `"Selected Contact Products"`
    - Gallery2_1.Items = `Gallery1_1.Selected.Products`
    - Title2_1.Text = `ThisItem.Name`
    - Icon1_1.OnSelect = `Unrelate( Gallery1_1.Selected.Products, ThisItem )`
    - ComboBox1_1.Items = `Products`
    - Icon2_1.OnSelect = `Relate( Gallery1_1.Selected.Products, ComboBox1_1.Selected )`

    Результат очень похож на предыдущий экран, но за связь из **контакты** стороне.

    ![Показать связь многие ко многим, начиная с контактами](media/function-relate-unrelate/reverse-screen.png)

1. Вставить **кнопки со стрелками вверх и вниз** значок и задайте его **OnSelect** свойства **Navigate (Screen1, None)** .  Сделайте то же самое на **Screen1** с формулой **Navigate (Screen1_1, None)** .

    ![Добавить навигацию между экранами](media/function-relate-unrelate/reverse-navigate.png)

С этого экрана пользователи могут добавлять контакт в продукт и затем переведите представление контактов и связанных продуктов см. в разделе. Связи являются симметричного и общего между двумя экранами.

![Демонстрации на любой из сторон связи многие ко многим](media/function-relate-unrelate/contacts-reverse.gif)
