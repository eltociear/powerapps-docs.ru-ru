---
title: Общие сведения о делегировании в приложении на основе холста | Документы Майкрософт
description: Делегирование помогает эффективно обрабатывать большие наборы данных в приложении на основе холста.
author: lancedMicrosoft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: tapanm
ms.date: 07/05/2018
ms.author: lanced
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 1d98f01920dbcbf960b1e2bb21159586318e0386
ms.sourcegitcommit: 629e47c769172e312ae07cb29e66fba8b4f03efc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78403553"
ms.PowerAppsDecimalTransform: true
---
# <a name="understand-delegation-in-a-canvas-app"></a>Общие сведения о делегировании в приложении на основе холста
Power Apps включает в себя мощный набор функций для фильтрации, сортировки и формирования таблиц данных в приложении Canvas: функции **[фильтрации](functions/function-filter-lookup.md)** , **[сортировки](functions/function-sort.md)** и **[AddColumns](functions/function-table-shaping.md)** , чтобы наименировать всего несколько. Эти функции помогают обеспечить пользователям доступ именно к той информации, которая им необходима. Для тех, у кого есть опыт работы с базами данных, использование этих функций можно сравнить с составлением запросов к базе.

Залогом создания эффективных приложений является минимизация объема данных, которые необходимо загружать на устройства. Иногда необходимы лишь несколько из миллионов записей или одно обобщенное (статистическое) значение, которое характеризует тысячи элементов в базе. Кроме того, возможно, достаточно будет извлечь лишь первый набор записей, а остальные можно загружать по требованию пользователя. Учитывая эти моменты, можно существенно сократить потребность в процессорной мощности, памяти и полосе пропускания, необходимых приложению, что в свою очередь ускорит его реагирование на действия пользователей, причем даже на телефонах, подключенных к Интернету через сотовый канал связи. 

*Делегирование* заключается в том, что выразительность формул Power Apps соответствует потребности в сворачивании данных по сети. Короче говоря, Power Apps делегирует обработку данных источнику данных, а не перемещение данных в приложение для локальной обработки.

Это усложняется, и причина, по которой существует эта статья, заключается в том, что не все, что можно выразить в формуле Power Apps, может быть делегировано каждому источнику данных. Язык приложений для Power Apps имитирует язык формул Excel, разработанный для полного и мгновенного доступа к полной книге в памяти, с широким набором функций числовых и текстовых операций. В результате язык Power Apps гораздо шире, чем большинство источников данных, в том числе мощные ядра СУБД, такие как SQL Server.

**Для работы с большими наборами данных необходимо использовать источники и формулы, которые можно делегировать.** Только так можно сохранить работоспособность приложения на высоком уровне и обеспечить пользователям доступ ко всей необходимой им информации. Обращайте внимание на предупреждения о делегировании, которые указывают на места, где делегирование невозможно. Если вы работаете с небольшими наборами данных (до 500 записей), можно использовать любые источники данных и формулы, так как приложение может обрабатывать данные локально даже в случае, если формулу нельзя делегировать. 

> [!NOTE]
> Предупреждения о делегировании ранее были помечены в Power apps как предложения "Blue Dot", но предложения о делегировании были изменены с момента повторной классификации как предупреждений. Если данные в источнике данных превышают 500 записей и функция не может быть делегирована, Power Apps может не получить все данные, и ваше приложение может иметь неверные результаты. Предупреждения о делегировании помогают управлять приложением и получать правильные результаты.

## <a name="delegable-data-sources"></a>Делегируемые источники данных
Делегирование поддерживается только для определенных табличных источников данных. Если источник данных поддерживает делегирование, в его [документации по соединителям](https://docs.microsoft.com/connectors/) описывается поддержка. Например, эти табличные источники данных являются наиболее популярными и поддерживают делегирование:

- [Common Data Service](https://docs.microsoft.com/connectors/commondataservice/) 
- [SharePoint](https://docs.microsoft.com/connectors/sharepointonline/) 
- [SQL Server](https://docs.microsoft.com/connectors/sql/) 

Для импортированных книг Excel (с помощью **добавления статических данных в** источник данных приложения), коллекций и таблиц, хранящихся в переменных контекста, делегирование не требуется. Все эти данные уже находятся в памяти, и можно применить полный язык Power Apps.

## <a name="delegable-functions"></a>Делегируемые функции
Следующий этап заключается в использовании только тех формул, которые можно делегировать. Здесь указаны элементы формул, поддерживающие делегирование. Тем не менее следует помнить, что источники данных различаются, и не все они поддерживают приведенные здесь элементы. Проверьте наличие предупреждений о делегировании в формуле.

Этот список со временем будет меняться. Мы расширяем поддержку делегирования и на другие функции и операторы.

### <a name="filter-functions"></a>Функции фильтрации
Функции **[Filter](functions/function-filter-lookup.md)** , **[Search](functions/function-filter-lookup.md)** и **[LookUp](functions/function-filter-lookup.md)** можно делегировать.  

В функциях **Filter** и **LookUp** для выбора соответствующих записей в столбцах таблицы можно использовать следующие операторы и функции:

* **[And](functions/function-logicals.md)** (включая **[&&](functions/operators.md)** ), **[Or](functions/function-logicals.md)** (включая **[||](functions/operators.md)** ), **[Not](functions/function-logicals.md)** (включая **[!](functions/operators.md)** )
* **[In](functions/operators.md)**
* **[=](functions/operators.md)** , **[<>](functions/operators.md)** , **[>=](functions/operators.md)** , **[<=](functions/operators.md)** , **[>](functions/operators.md)** , **[<](functions/operators.md)**
* **[+](functions/operators.md)** , **[-](functions/operators.md)**
* **[TrimEnds](functions/function-trim.md)**
* **[IsBlank](functions/function-isblank-isempty.md)**
* **[StartsWith](functions/function-startswith.md)** ,  **[endsWith](functions/function-startswith.md)**
* Постоянные значения, одинаковые для всех записей, такие как свойства элемента управления и [глобальные и контекстуальные переменные](working-with-variables.md).

Также можно использовать части формул, которые возвращают константные значения для всех записей. Например, **Left (язык (), 2)** , **Date (2019, 3, 31)** и **Today ()** не зависят от каких-либо столбцов записи и, следовательно, возвращают одно и то же значение для всех записей. Эти значения можно отправить в источник данных как константу и не блокировать делегирование. 

Предыдущий список не содержит следующие важные элементы:

* **[If](functions/function-if.md)**
* **[*](functions/operators.md)** , **[/](functions/operators.md)** , **[Mod](functions/function-mod.md)**
* **[Concatenate](functions/function-concatenate.md)** (включая **[&](functions/operators.md)** )
* **[ExactIn](functions/operators.md)**
* Функции для работы со строками: **[Lower](functions/function-lower-upper-proper.md)** , **[Upper](functions/function-lower-upper-proper.md)** , **[Left](functions/function-left-mid-right.md)** , **[Mid](functions/function-left-mid-right.md)** , **[Len](functions/function-left-mid-right.md)** , ...
* Сигналы: **[Location](functions/signals.md)** , **[Acceleration](functions/signals.md)** , **[Compass](functions/signals.md)** , ...
* Переменные: **[Rand](functions/function-rand.md)** ,...
* [Коллекции](working-with-variables.md)

### <a name="sorting-functions"></a>Функции сортировки
Функции **[Sort](functions/function-sort.md)** и **[SortByColumns](functions/function-sort.md)** можно делегировать.

В функции **Sort** формулой может быть только имя одного столбца, и она не может содержать другие операторы или функции.

### <a name="aggregate-functions"></a>Агрегатные функции
**[Sum](functions/function-aggregates.md)** , **[Average](functions/function-aggregates.md)** , **[Min](functions/function-aggregates.md)** и **[Max](functions/function-aggregates.md)** можно делегировать. Сейчас делегирование поддерживает ограниченное число источников данных. Дополнительные сведения см. в [списке делегирования](delegation-list.md).

Функции подсчета, такие как **[CountRows](functions/function-table-counts.md)** , **[CountA](functions/function-table-counts.md)** и **[Count](functions/function-table-counts.md)** , невозможно делегировать.

Другие агрегатные функции, такие как **[StdevP](functions/function-aggregates.md)** и **[VarP](functions/function-aggregates.md)** , также невозможно делегировать.

### <a name="table-shaping-functions"></a>Функции формирования таблиц

**[AddColumns](functions/function-table-shaping.md)** , **[дропколумнс](functions/function-table-shaping.md)** , **[RenameColumns](functions/function-table-shaping.md)** и **[шовколумнс](functions/function-table-shaping.md)** частично поддерживают делегирование.  Формулы в своих аргументах могут быть делегированы.  Однако выходные данные этих функций подвергаются ограничению записи без делегирования.

Как и в этом примере, производители часто используют **AddColumns** и **Lookup** для слияния информации из одной таблицы в другую, которая часто называется соединением в базе данных терминах:

```powerapps-comma
AddColumns( Products; 
    "Supplier Name"; 
    LookUp( Suppliers; Suppliers.ID = Product.SupplierID ).Name 
)
```

Несмотря на то, что **продукты** и **поставщики** могут быть делегируемых источниками данных, а функция **Lookup** — делегируемых, выходные данные функции **AddColumns** не делегируемых. Результат всей формулы ограничен только первой частью источника данных **Products** . Поскольку функция **LookUp** и ее источник данных являются делегируемыми, совпадение со значением **Suppliers** может быть найдено в любом месте источника данных (каким бы большим он ни был). 

Если использовать **AddColumns** таким образом, **Поиск** должен выполнять отдельные вызовы к источнику данных для каждой из первых записей в **продуктах**, что приводит к большому числу сетевых chatter. Если **поставщики** достаточно малы и не меняются часто, можно вызвать функцию " **получить** " в [**OnStart**](functions/signals.md) для кэширования источника данных в приложении при запуске. В качестве альтернативы можно изменить структуру приложения, чтобы извлечь связанные записи, только когда пользователь запросит их.  
 
## <a name="non-delegable-functions"></a>Неделегируемые функции
Все остальные функции не поддерживают делегирование. Ниже перечислены некоторые из них.

* **[First](functions/function-first-last.md)** , **[FirstN](functions/function-first-last.md)** , **[Last](functions/function-first-last.md)** , **[LastN](functions/function-first-last.md)**
* **[Choices](functions/function-choices.md)**
* **[Concat](functions/function-concatenate.md)**
* **[Collect](functions/function-clear-collect-clearcollect.md)** , **[ClearCollect](functions/function-clear-collect-clearcollect.md)**
* **[CountIf](functions/function-table-counts.md)** , **[RemoveIf](functions/function-remove-removeif.md)** , **[UpdateIf](functions/function-update-updateif.md)**
* **[GroupBy](functions/function-groupby.md)** , **[Ungroup](functions/function-groupby.md)**

## <a name="non-delegable-limits"></a>Ограничения для неделегируемых функций
Формулы, которые нельзя делегировать, обрабатываются локально. Это позволяет использовать все возможности языка формул Power Apps. Однако есть и обратная сторона медали: все данные необходимо сначала загрузить на устройство, что может существенно увеличить сетевой трафик. Это занимает некоторое время, создавая впечатление, что приложение работает медленно или даже завершилось сбоем.

Чтобы избежать этого, Power Apps накладывает ограничение на объем данных, которые могут быть обработаны локально: 500 записей по умолчанию.  Мы выбрали именно это число, чтобы обеспечить полный доступ к небольшим наборам данных и в то же время дать возможность оптимизировать обработку больших наборов на основе частичных результатов.

Очевидно, этот фактор необходимо учитывать, чтобы не вводить пользователей в заблуждение. Представим ситуацию, в которой функция **Filter** используется в формуле выборки, которую нельзя делегировать, для фильтрации источника данных, содержащего более миллиона записей. Поскольку фильтрация выполняется локально, проверяются только первые 500 записей. Если нужная запись находится под номером 501 (или 500 001), она не будет обработана, а функция **Filter** ее не вернет.

Агрегатные функции также могут привести к путанице. Представим функцию **Average**, примененную к тому же самому источнику данных с миллионом записей. Поскольку делегирование функции **Average** пока не поддерживается, усреднение будет выполнено только по первым 500 записям. Этот фактор необходимо учитывать: в противном случае пользователь приложения ошибочно посчитает полным результат обработки лишь части набора.

## <a name="changing-the-limit"></a>Изменение ограничения
По умолчанию количество записей равно 500, но можно изменить это число для всего приложения:

1. На вкладке **Файл** выберите **Параметры приложения**.
2. В разделе **Дополнительные параметры**измените значение параметра **предельный размер строк данных для запросов без делегируемых** с 1 по 2000.

В некоторых случаях вам может быть известно, что оптимальным значением для вашего сценария является 2000 (или 1000, или 1500). Это число можно осторожно увеличивать в соответствии с потребностями сценария. Увеличение этого параметра может привести к снижению производительности приложения, особенно для таблиц с большим количеством столбцов. Но лучший вариант — делегировать все, что только можно делегировать.

Чтобы убедиться, что ваше приложение может масштабироваться для больших наборов данных, уменьшите значение этого параметра до 1. Теперь все, что не может быть делегировано, возвратит одну запись. Это легко обнаружить при тестировании приложения. Это поможет избежать сюрпризов при проверке приложения в рабочей среде.

## <a name="delegation-warnings"></a>Предупреждения о делегировании
Чтобы облегчить знание того, что и не является делегированным, Power Apps предоставляет предупреждение (желтый треугольник) при создании формулы, которая содержит нечто, которое не может быть делегировано.

Предупреждения о делегировании отображаются только для формул, которые работают с делегируемыми источниками данных. Если вы не видите подобного предупреждения и считаете, что формула не делегируется надлежащим образом, проверьте, есть ли ваш источник в списке [делегируемых источников данных](delegation-overview.md#delegable-data-sources) выше.

## <a name="examples"></a>Примеры
Например, вы автоматически создаете приложение с тремя экранами на основе таблицы SQL Server с именем **[dbo].[Fruit]** . Сведения о том, как создать приложение, можно применить в [разделе Common Data Service](data-platform-create-app.md) to SQL Server.

![Приложение с тремя экранами](./media/delegation-overview/products-afd.png)

Для свойства **Items** коллекции установлена формула, которая содержит функции **SortByColumns** и **Search**. Обе функции можно делегировать.

В поле поиска введите **Apple**.

В верхней части экрана сразу появятся точки, так как приложение взаимодействует с SQL Server для обработки поискового запроса. Отобразятся все записи, соответствующие критериям поиска, даже если источник данных содержит миллионы записей.

![Текстовое поле для поиска](./media/delegation-overview/products-apple.png)

Результаты поиска включают **"Apples"** , **"Crab apples"** и **"Pineapple"** , поскольку функция **Search** ищет по всему текстовому столбцу. Если вы хотите найти только те записи, которые содержат поисковой запрос в начале названия фрукта, используйте другую делегируемую функцию **Filter** для более сложных критериев поиска. (Для простоты удалите вызов **SortByColumns**.)

![Удаление вызова SortByColumns](./media/delegation-overview/products-apple-delegationwarning.png)

Новые результаты включают **"Apples"** , но не **"Crab apples"** или **"Pineapple"** .  Рядом с коллекцией (и в эскизе экрана, если в левой панели навигации отображаются эскизы) отображается желтый треугольник, и часть формулы подчеркивается синей волнистой линией. Каждый из этих элементов указывает на предупреждение. Если навести курсор на желтый треугольник рядом с коллекцией, вы увидите следующее сообщение:

![Наведение указателя мыши на предупреждение о делегировании](./media/delegation-overview/products-apple-yellowwarning.png)

SQL Server является делегируемым источником данных, а **Filter** является делегируемой функцией, однако **Mid** и **Len** невозможно делегировать источнику данных.

Но мы ведь получили нужные результаты? В некотором смысле — да. Поэтому это предупреждение, а не красная волнистая линия.

- Если таблица содержит не более 500 записей, формула дала правильный результат. Все эти записи были загружены на устройство, и функция **Filter** была применена локально.
- Если таблица содержит более 500 записей, формула не возвращает запись 501 и далее, даже если она соответствует критериям.
