---
title: Работа с Test Studio для тестирования приложения на основе холста | Документация Майкрософт
description: Описывает, как использовать Test Studio с примером тестирования приложения на основе холста.
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: tapanm
ms.date: 02/05/2020
ms.author: aheaney
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 79ae7206c729a9628ee183e0c64c395f6a235b7c
ms.sourcegitcommit: 86c81c9efb105d11f4def49eef823af6c69059a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2020
ms.locfileid: "77034403"
ms.PowerAppsDecimalTransform: true
---
# <a name="working-with-test-studio-experimental"></a>Использование Test Studio (экспериментальное)

В этом кратком руководстве вы создадите тесты для приложения на основе холста под названием Kudos (англ. Kudos — "благодарность", "поздравление", "похвала"). Вы также можете исследовать и изучать концепции тестирования и применять их при написании тестов для собственных приложений на основе холста. Пример приложения Kudos входит в набор приложений для работы с сотрудниками, доступных для скачивания в составе пакета [Начальный набор для работы с сотрудниками](https://powerapps.microsoft.com/en-us/blog/powerapps-employee-experience-starter-kit).

> [!NOTE]
> Пока это экспериментальная функция, и мы рекомендуем использовать ее для написания тестов для нерабочих приложений. Дополнительные сведения см. в статье [Экспериментальные и предварительные версии](working-with-experimental-preview.md).

## <a name="open-test-studio"></a>Запуск Test Studio

Вам не нужно включать это в приложении, как в других экспериментальных функциях. По умолчанию Test Studio доступна для всех приложений на основе холста.

1. Выполните вход в [Power Apps](https://make.powerapps.com).

2. Выберите [для изменения существующее приложение](get-started-test-drive.md) или [создайте новое](edit-app.md).

3. Сохраните приложение в Power Apps, чтобы открыть Test Studio. 
    
    > [!NOTE]
    > Необходимо сохранить приложение, чтобы можно было создавать тесты для него.

4. В области навигации слева выберите **Дополнительные инструменты**.

5. Выберите команду **Открыть тесты**, чтобы открыть для этого приложения Test Studio. Окно Test Studio откроется в новой вкладке браузера.

    ![Запуск Test Studio](./media/working-with-test-studio/open-tests.png)

> [!NOTE]
> Тесты публикуются и сохраняются в пакете приложения. При экспорте и импорте пакета приложения Canvas в другую среду будут также включены все определения тестов, такие как наборы тестов и тестовые случаи, которые вы создали. 

## <a name="create-a-test-suite"></a>Создание набора тестов

По умолчанию в Test Studio создаются набор тестов и тестовый случай. Упорядочение тестовых случаев производится с помощью наборов тестов. Приложение может содержать один набор тестов или несколько. Вы можете использовать набор тестов и случай по умолчанию, чтобы начать писать тесты немедленно, или создать новый набор тестов.

1. Выберите **Новый набор**.
2. Измените **имя и описание набора тестов**, выбрав поля в главной сетке.

    ![Новый набор тестов](./media/working-with-test-studio/new-test-suite.png)

## <a name="create-a-test-case"></a>Создание тестового случая

В зависимости от того, как нужно организовать или сгруппировать тесты, в наборе тестов можно создать несколько тестовых случаев. Каждый случай может тестировать определенную функцию или подмножество функций в приложении.

1. Выберите набор тестов.
2. Выберите **Новый случай** в верхнем меню, чтобы создать новый случай.
3. Измените **имя и описание тестового случая**, выбрав поля в главной сетке.

 ![Новый тестовый случай](./media/working-with-test-studio/new-test-case.png)

## <a name="record-a-test-case"></a>Запись тестового случая

Тестовый случай состоит из шагов теста, содержащих действия. Действия пишутся с помощью выражений Power Apps, выполняющих задачу. Можно также использовать средство записи для автоматического создания шагов теста при взаимодействии с приложением. После записи можно обновить тестовый случай, добавить новые шаги, удалить шаги и написать проверочные утверждения для результата теста.

> [!NOTE]
> Только опубликованные приложения воспроизводятся в режиме записи. Перед началом записи тестового случая опубликуйте все последние изменения в приложении. Запись без публикации последних изменений приводит к тому, что последняя опубликованная версия приложения воспроизводится в режиме записи.

1. В верхнем меню выберите пункт **Запись**. Опубликованное приложение откроется в режиме записи в новой вкладке браузера.

    > [!IMPORTANT]
    > Запись в существующем тестовом случае переопределяет уже имеющиеся шаги теста.

    ![Запись тестов](./media/working-with-test-studio/record-tests.png)

2. Взаимодействуйте с приложением. Ваши действия **записываются** на левой панели.

3. После завершения взаимодействия выберите **Готово**. При необходимости можно выбрать **Отмена**, чтобы вернуться в Test Studio без записи ваших взаимодействий. 

    ![Сохранение записи](./media/working-with-test-studio/save-recording.png)

4. Просмотрите шаги теста и выражения, которые были автоматически созданы для вас в Test Studio.
5. При необходимости измените текст описания шага в главной сетке. Можно также обновить действия шага теста, выбрав формулу в главной сетке.

    ![Изменение тестового случая](./media/working-with-test-studio/update-test-case.png)

### <a name="add-test-steps-and-test-assertions"></a>Добавление шагов теста и проверочных утверждений

Каждый тестовый случай должен иметь ожидаемый результат. В примере Kudos одним из ожидаемых результатов отправки благодарности является создание новой записи в базе данных Common Data Service. Теперь следует обновить тестовый случай и добавить дополнительные шаги теста для проверки успешности создания записи.

Чтобы проверить успешность создания записей, выполните следующие действия.

- Инициализируйте переменную для счетчика записей благодарностей в базе данных в начале тестового случая.
- Инициализируйте переменную для счетчика записей благодарностей в базе данных в конце тестового случая.
- Напишите выражение утверждения для проверки того, что значение увеличивается на единицу. Если значение не увеличивается на единицу, проверочное утверждение не выполняется и тестовый случай завершается ошибкой.

Добавление шагов теста и проверочных утверждений в приложение Kudos

1. Выберите шаг 1 или шаг, перед которым нужно вставить новый шаг. 

2. Выберите команду **Вставить шаг выше** из верхнего меню или соответствующий параметр в активной строке. При этом создается пустой шаг.

    ![Вставить шаг](./media/working-with-test-studio/insert-step-above.png)

    > [!NOTE]
    > Если выбрать команду **Вставить шаг выше**, то над текущим шагом будет добавлен новый пустой шаг. Можно также использовать действия **Assert**, **SetProperty**, **Выбрать** или **Трассировка**. В результате будет добавлен шаг с соответствующей формулой действия, которую можно изменить.

3. Обновите описание шага. Например, "Подсчет благодарностей в базе данных".

4. Введите выражение или формулу во входных данных действия, чтобы подсчитать записи в базе данных перед выполнением теста.

    Можно использовать любое поддерживаемое выражение. Можно также запрашивать любые источники данных, коллекции, переменные или потоки выполнения, содержащиеся в приложении, а также создавать новые глобальные переменные или коллекции для использования в тестах.

    ```Set(kudosBeforeTest; CountRows(Filter(Kudos; Receiver.Email = "someone@example.com")))```

5. Выберите шаг 2 или шаг, перед которым нужно вставить новый шаг.

6. Выберите команду **Вставить шаг выше** из верхнего меню или соответствующий параметр в активной строке. При этом создается пустой шаг.

7. Введите выражение или формулу в поле ввода действия, выбрав вариант [Трассировка](./functions/function-trace.md), и запишите значение *kudosBeforeTest* в запись результатов теста.

    ```Trace("kudosBeforeTest : " & kudosBeforeTest);;```

    ![Благодарностей до теста](./media/working-with-test-studio/kudos-before-test.png)

8. Перейдите к концу тестового случая и вставьте новый шаг, чтобы подсчитать записи в базе данных после теста.

    ```Set(kudosAfterTest; CountRows(Filter(Kudos; Receiver.Email = "someone@example.com")))```

9. Добавить заключительный шаг для проверки того, что число записей в базе данных увеличилось на число 1. Чтобы проверить это, введите следующее действие утверждения:

    ```Assert(kudosAfterTest = kudosBeforeTest + 1; "Kudos count incorrect. Expected : " & kudosBeforeTest + 1  & " Actual :" & kudosAfterTest)```

    ![Проверочное утверждение "Благодарностей после теста"](./media/working-with-test-studio/kudos-after-test-assert.png)

10. Сохраните тестовый случай в правом верхнем меню в Test Studio. 

## <a name="play-back-your-test"></a>Воспроизведение теста

Вы можете воспроизвести записанный тест для проверки функциональности приложения. Воспроизвести можно все тесты в одном наборе тестов или в одном тестовом случае. 

Перед воспроизведением записи с последними изменениями необходимо опубликовать приложение:

![Воспроизведение без публикации](./media/working-with-test-studio/publish-test-studio-changes.png)

> [!IMPORTANT]
> Если пропустить публикацию, воспроизведение записи не будет содержать последние изменения теста. В приложении будет воспроизводиться тестовый случай или набор, опубликованный последним.

1. Нажмите кнопку **Опубликовать**. Это позволит автоматически сохранить и опубликовать тест.

    ![Публикация изменений](./media/working-with-test-studio/publish-button.png)

2. Выберите набор тестов или один тестовый случай.

3. Нажмите кнопку **Воспроизвести**. Опубликованное приложение откроется в режиме **воспроизведения**, и вы увидите, что шаги теста воспроизводятся автоматически. Зеленый флажок показывает, что шаг теста успешно выполнен. В случае сбоя шага отображается красный индикатор сбоя вместе с сообщением об ошибке.

    ![Режим воспроизведения](./media/working-with-test-studio/play-mode.png)

4. Нажмите кнопку "Готово", чтобы вернуться в Test Studio.

### <a name="failed-assertion"></a>Неудачное утверждение

В этом разделе нам предстоит изменить проверочное утверждение, чтобы столкнуться со сбоем теста:

1. Измените шаг утверждения, выбрав поле выражения.

2. Замените ```+ 1``` на ```+ 2``` в действии теста. Таким образом, тест предполагает создание двух записей, что неверно. Если тест проходит успешно, в базе данных должна быть создана только одна запись.

    ```Assert(kudosAfterTest = kudosBeforeTest + 2; "Kudos count incorrect. Expected : " & kudosBeforeTest + 2  & " Actual :" & kudosAfterTest)```

    ![Изменение счетчика в утверждении](./media/working-with-test-studio/assert-count-update.png)

3. Щелкните **Опубликовать**.

4. Нажмите кнопку **Воспроизвести**.

5. Просмотрите воспроизведение теста. На завершающем этапе произойдет ошибка и появился сообщение об ошибке, указанное на шаге утверждения.  

    ![Ошибка воспроизведения](./media/working-with-test-studio/playback-error.png)

### <a name="playing-tests-in-a-browser"></a>Воспроизведение тестов в браузере

Вы можете скопировать ссылку для отдельного воспроизведения теста в браузере вне среды Test Studio. Это помогает интегрировать тесты в конвейер непрерывной сборки и выпуска, например **Azure DevOps**.

Ссылка для воспроизведения выбранного теста сохраняется. Для набора тестов или тестового случая она всегда будет неизменной. Вы можете обновлять тесты без необходимости изменять процессы сборки и выпуска.

Для воспроизведения тестов в браузере выполните следующие действия.

1. Выберите набор тестов или тестовый случай на правой панели.

2. Выберите команду **Копировать ссылку для воспроизведения**.

    ![Копировать ссылку для воспроизведения](./media/working-with-test-studio/copy-play-link.png)

3. При наличии неопубликованных изменений будет предложено опубликовать тесты.

    ![Публикация до копирования ссылки](./media/working-with-test-studio/publish-before-copy-link.png)

4. Вы можете пропустить процесс публикации и скопировать ссылку для воспроизведения. При пропуске не воспроизводятся новые тестовые изменения.

    ![Копировать ссылку для воспроизведения](./media/working-with-test-studio/copy-play-link-ack.png)

5. Откройте браузер и вставьте URL-адрес в адресную строку.

6. Просмотрите воспроизведение теста.

## <a name="processing-test-results"></a>Обработка результатов теста

Панель тестов, видимая при воспроизведении тестов в Test Studio, не отображается при использовании отдельного браузера. Из-за этого невозможно определить конкретный шаг теста, который сейчас выполняется, или понять, пройден ли тест.

Чтобы определить результаты тестирования за пределами среды Test Studio, в тестовом объекте доступны два свойства: **OnTestCaseComplete** и **OnTestSuiteComplete**, которые можно использовать для обработки результатов тестов. При интеграции тестов в конвейер непрерывной сборки и выпуска, например **Azure DevOps**, эти свойства можно использовать, чтобы определить, следует ли продолжить развертывание приложения.

Выражение, указанное для этих свойств, активируется при завершении каждого случая или всего набора. Эти свойства можно настроить для обработки и отправки результатов тестов в различные источники данных или службы, такие как:

- SQL Server.
- Common Data Service.
- Power Automate.
- По почте через Office 365.

Эти параметры применяются ко всем наборам тестов и тестовым случаям в приложении. После завершения каждого набора тестов или тестового случая результаты теста и все сообщения трассировки, содержащиеся в тестах, будут доступны в записях **TestCaseResult** и **TestSuiteResult**.

Запись **TestCaseResult** содержит следующие свойства:

- *TestCaseName* — имя тестового случая.
- *TestCaseId* — идентификатор тестового случая.
- *TestSuiteName* — имя набора тестов, к которому относится случай.
- *TestSuiteId* — идентификатор набора тестов, к которому относится случай.
- *StartTime* — время запуска теста.
- *EndTime* — время завершения теста.
- *Traces* — результат любых проверочных утверждений и сообщений из функции Trace.
- *Success* — указывает, успешно ли завершился тестовый случай.
- *TestFailureMessage* — сообщение об ошибке при сбое случая.

Запись **TestSuiteResult** содержит следующие свойства: 

- *TestSuiteName* — имя набора тестов.
- *TestSuiteId* — идентификатор набора тестов.
- *StartTime* — время запуска набора тестов.
- *EndTime* — время завершения набора тестов.
- *TestsPassed* — количество успешно выполненных тестовых случаев в наборе.
- *TestsFailed* — количество неудачных тестовых случаев в наборе.

В этом кратком руководстве вы создадите две пользовательские сущности в базе данных Common Data Service для хранения результатов теста, настроив свойства **OnTestCaseComplete** и **OnTestSuiteComplete**.

1. Щелкните **Тест** в левой области или **Вид** в заголовке набора.

    ![Просмотр или проверка заданного значения свойства](./media/working-with-test-studio/test-or-view-to-set-property.png)

2. Выберите действие **OnTestCaseComplete**.

3. Введите выражение для обработки результатов теста. В следующем примере все результаты тестовых случаев сохраняются в пользовательской сущности AppTestResults в Common Data Service. Результаты теста при необходимости можно сохранить в SQL, SharePoint или любом другом источнике данных. При необходимости может потребоваться задать или увеличить поле Trace в источнике данных.

    > [!NOTE]
    > Для следующих примеров требуется [подключение к Common Data Service](https://docs.microsoft.com/connectors/commondataservice/). Вы можете создать [стандартное простое приложение](data-platform-create-app.md) или [построить приложение с нуля](data-platform-create-app-scratch.md), используя Common Data Service. Дополнительные сведения об изменении записей источника данных, используемых в следующих примерах, см. в справочнике по функции [Patch](./functions/function-patch.md).

    ```
    //Save to Common Data Service
    Patch(AppTestResults
    , Defaults(AppTestResults)
    , {
             TestPass: TestCaseResult.TestCaseName & ":" & Text(Now())
             ,TestSuiteId: TestCaseResult.TestSuiteId
             ,TestSuiteName: TestCaseResult.TestSuiteName
             ,TestCaseId: TestCaseResult.TestCaseId
             ,TestCaseName: TestCaseResult.TestCaseName
             ,StartTime: TestCaseResult.StartTime
             ,EndTime: TestCaseResult.EndTime
             ,TestSuccess: TestCaseResult.Success
             ,TestTraces: JSON(TestCaseResult.Traces)
             ,TestFailureMessage: TestCaseResult.TestFailureMessage
    }
    );
    ```
    ![OnTestCaseComplete example.png](./media/working-with-test-studio/ontestcasecomplete-example.png)

4. Выберите действие **OnTestSuiteComplete**.

5. Введите выражение для обработки результатов теста. В следующем примере все результаты набора тестов сохраняются в пользовательской сущности AppTestSuiteResults в Common Data Service. 

    ```
    //Save to Common Data Service
    Patch(AppTestSuiteResults
        , Defaults(AppTestSuiteResults)
        , {
             TestSuiteId: TestSuiteResult.TestSuiteId
             ,TestSuiteName: TestSuiteResult.TestSuiteName
             ,StartTime: TestSuiteResult.StartTime
             ,EndTime: TestSuiteResult.EndTime
             ,TestPassCount: TestSuiteResult.TestsPassed
             ,TestFailCount: TestSuiteResult.TestsFailed
        }
    );
    ```

    ![OnTestSuiteComplete example.png](./media/working-with-test-studio/ontestsuitecomplete-example.png)

Другими примерами выражений, которые можно использовать в этих свойствах, являются следующие.

- Отправка результатов в поток Power Automate.

    ```MyTestResultsFlow.Run(JSON(TestCaseResult))```

- Отправка результатов по почте:

    ```Office365.SendMailV2(“someone@example.com”; “Test case results”; JSON(TestCaseResult; JSONFormat.IndentFour))```

- Получение уведомления приложения о результатах теста:

  Например, можно настроить уведомление после завершения теста при его воспроизведении в браузере за пределами Test Studio.

    ```
    Notify(TestCaseResult.TestCaseName & " : "
            & If( TestCaseResult.Success
                , " Passed"
                , TestCaseResult.TestFailureMessage)
            ,If(  TestCaseResult.Success
                , NotificationType.Success
                , NotificationType.Error)
    )
    ```

## <a name="test-functions"></a>Тестовые функции

В дополнение к [функциям](formula-reference.md), доступным в Power Apps, ниже приведены общие функции, которые обычно используются при создании тестов.

- [Выбрать](./functions/function-select.md)
- [SetProperty](./functions/function-setproperty.md)
- [Утверждающе](./functions/function-assert.md)
- [Трассировки](./functions/function-trace.md)
