---
title: Разработка приложений на основе холста, поддерживающих автономный режим работы | Документы Майкрософт
description: Разрабатывайте приложения на основе холста, поддерживающие автономный режим работы, чтобы пользователи могли продуктивно работать независимо от режима приложения.
author: gregli-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: ''
ms.date: 02/29/2020
ms.author: gregli
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 6ec1a55713b3cce0a98c02058124b5b3d159b376
ms.sourcegitcommit: 129d004e3d33249b21e8f53e0217030b5c28b53f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2020
ms.locfileid: "78265562"
ms.PowerAppsDecimalTransform: true
---
# <a name="develop-offline-capable-canvas-apps"></a>Разработка приложений на основе холста, поддерживающих автономный режим работы

Мобильным пользователям часто приходится работать даже при ограниченном или отсутствии подключения. При создании приложения Canvas можно выполнять следующие задачи:

- Откройте Power Apps Mobile и запустите приложения в автономном режиме.
- определять режим приложения (интерактивный, автономный или режим лимитного подключения) с помощью объекта сигнала [подключения](functions/signals.md#connection);
- Использование [коллекций](create-update-collection.md) и функций [ **LoadData** и **SaveData** ](functions/function-savedata-loaddata.md) для базовых хранилищ данных в автономном режиме.

Эта статья содержит пример с использованием данных Twitter.  Еще более простой пример, в котором не требуется соединение, включается в [Справочник по функциям **LoadData** и **SaveData** ](functions/function-savedata-loaddata.md).

## <a name="limitations"></a>Ограничения

**LoadData** и **SaveData** объединяют, образуя простой механизм хранения небольших объемов данных на локальном устройстве. С помощью этих функций можно добавить в приложение простые автономные возможности.

Эти функции ограничены объемом доступной памяти приложения, так как они работают с коллекцией в памяти. Доступная память может зависеть от устройства, операционной системы, памяти, используемой мобильными приложениями, и сложности приложения с точки зрения экранов и элементов управления. Если вы храните более нескольких мегабайт данных, протестируйте приложение с ожидаемыми сценариями на устройствах, на которых оно должно выполняться. Обычно 30-70 МБ доступной памяти.

Функции также не разрешают конфликты слияния, когда устройство переходит в режим «в сети». Настройка сохранения данных и способ решения повторного подключения при написании выражений осуществляются производителем.

Для обновления возможностей автономной работы вернитесь к этой статье и подпишитесь на [блог Power Apps](https://powerapps.microsoft.com/blog/).

## <a name="overview"></a>Обзор

При проектировании автономных сценариев необходимо сначала определить, как ваши приложения работают с данными. Приложения в Power Apps в основном обращаются к данным через набор [соединителей](../canvas-apps/connections-list.md) , предоставляемых платформой, например SharePoint, Office 365 и Common Data Service. Вы можете также создать настраиваемые соединители, которые позволят приложениям получить доступ к любой службе, предоставляющей конечную точку RESTful. Это может быть веб-API или такая служба, как Функции Azure. Все эти соединители используют протокол HTTPS через Интернет. Это означает, что пользователи должны быть в сети, чтобы получить доступ к данным и любым другим возможностям, предлагаемым службой.

![Приложение Power Apps с соединителями](./media/offline-apps/online-app.png)

### <a name="handling-offline-data"></a>Управление данными в автономном режиме

В Power Apps можно выполнять фильтрацию, поиск, сортировку, агрегирование и обработку данных согласованным способом независимо от источника данных. Источники находятся в диапазоне от коллекций в памяти в приложении к спискам SharePoint для баз данных SQL и Common Data Service. Из-за этой согласованности можно легко изменить целевую платформу приложения, чтобы использовать другой источник данных. Что еще важнее для сценариев работы в автономном режиме, локальные коллекции можно использовать для управления данными практически без изменений в логике приложения. Фактически локальные коллекции представляют собой основной механизм обработки данных в автономном режиме.

## <a name="build-an-offline-app"></a>Создание автономного приложения

Чтобы сосредоточиться на автономных аспектах разработки приложений, в этом разделе показан простой сценарий, сфокусированный на Twitter. Вы создадите приложение, которое позволит читать сообщения Twitter и отправлять твиты в автономном режиме. При переходе в интерактивный режим приложение будет публиковать твиты и перезагружать локальные данные.

На высоком уровне приложение выполняет следующие задачи:

- Когда пользователь открывает приложение:

  - Если устройство находится в сети, приложение извлекает данные через соединитель Twitter и заполняет коллекцию этими данными.
  - Если устройство находится в автономном режиме, приложение загружает данные из локального кэша с помощью функции [**LoadData**](../canvas-apps/functions/function-savedata-loaddata.md) .
  - Пользователь может отправлять твиты. Если приложение находится в оперативном режиме, он публикует твиты непосредственно в Twitter и обновляет локальный кэш.

- Каждые пять минут, пока приложение находится в режиме «в сети»:

  - Приложение публикует все твиты в локальном кэше.
  - Приложение обновляет локальный кэш и сохраняет его с помощью функции [**SaveData**](../canvas-apps/functions/function-savedata-loaddata.md) .

### <a name="step-1-add-twitter-to-a-blank-phone-app"></a>Шаг 1. Добавление Twitter в пустое приложение для телефона

1. В Power Apps Studio выберите **файл** > **создать**.
1. На плитке **Пустое приложение** выберите **Макет для телефона**.
1. На вкладке **Вид** выберите **источники данных**.
1. На панели **данные** выберите **Добавить источник данных**.
1. Выберите **создать подключение** > **Twitter** > **создать**.
1. Введите свои учетные данные, создайте подключение, а затем закройте панель **данных** .

### <a name="step-2-collect-existing-tweets"></a>Шаг 2. получение существующих твитов

1. На панели **древовидного представления** выберите **приложение**, а затем задайте для свойства **OnStart** значение этой формулы:

    ```powerapps-comma
    If( Connection.Connected;
        ClearCollect( LocalTweets; Twitter.SearchTweet( "PowerApps"; {maxResults: 10} ) );;
            Set( statusText; "Online data" );
        LoadData( LocalTweets; "LocalTweets"; true );;
            Set( statusText; "Local data" )
    );;
    SaveData( LocalTweets; "LocalTweets" );;
    ```

    > [!div class="mx-imgBorder"]
    > ![формулу для загрузки твитов](./media/offline-apps/load-tweets.png)

1. В области **представление в виде дерева** выберите меню с многоточием для объекта **приложение** , а затем выберите **выполнить OnStart** , чтобы выполнить эту формулу.

    > [!div class="mx-imgBorder"]
    > ![запустить формулу для загрузки твитов](./media/offline-apps/load-tweets-run.png)

    > [!NOTE]
    > Функции **LoadData** и **SaveData** могут показывать ошибку в Power Apps Studio, так как браузеры их не поддерживают. Однако они будут нормально работать после развертывания приложения на устройстве.

Эта формула проверяет, находится ли устройство в сети:

- Если устройство находится в режиме «в сети», формула загружает до 10 твитов с условием поиска «PowerApps» в коллекцию **локалтвитс** .
- Если устройство находится в автономном режиме, формула загружает локальный кэш из файла с именем "Локалтвитс", если он доступен.

### <a name="step-3-show-tweets-in-a-gallery"></a>Шаг 3. Отображение твитов в галерее

1. На вкладке **Вставка** выберите **коллекция** > **пустая гибкая высота**.

1. Задайте для свойства **Items** элемента управления [**галереи**](controls/control-gallery.md) значение `LocalTweets`.

1. В шаблоне коллекции добавьте три элемента управления [**Label**](controls/control-text-box.md) и задайте для свойства **Text** каждой метки одно из следующих значений:

    - `ThisItem.UserDetails.FullName & " (@" & ThisItem.UserDetails.UserName & ")"`
    - `Text(DateTimeValue(ThisItem.CreatedAtIso); DateTimeFormat.ShortDateTime)`
    - `ThisItem.TweetText`

1. Сделайте текст в последней метке полужирным, чтобы Галерея соответствовала этому примеру.

    > [!div class="mx-imgBorder"]
    > Коллекция ![, в которой показаны примеры твитов](./media/offline-apps/tweet-gallery.png)

### <a name="step-4-show-connection-status"></a>Шаг 4. Отображение состояния подключения

1. В коллекции вставьте метку, а затем установите для ее свойства **Color** значение **Red**.

1. Задайте для свойства **Text** новой метки следующую формулу:

    `If( Connection.Connected; "Connected"; "Offline" )`

Эта формула определяет, находится ли устройство в сети. Если это так, метка отображается как **Подключенная**; в противном случае отображается **режим "вне сети**".

### <a name="step-5-add-a-box-to-compose-tweets"></a>Шаг 5. Добавление поля для создания твитов

1. В метке состояние подключения вставьте элемент управления [**Ввод текста**](controls/control-text-input.md) и переименуйте его в **невтвиттекстинпут**.

1. Задайте для свойства поля ввода текста **по умолчанию** значение `""`.

    > [!div class="mx-imgBorder"]
    > ![коллекции для получения сведений о состоянии и поля ввода текста](./media/offline-apps/status-input.png)

### <a name="step-6-add-a-button-to-post-the-tweet"></a>Шаг 6. Добавление кнопки для публикации твита

1. В поле ввода текста добавьте элемент управления **"Кнопка"** и задайте для его свойства **Text** значение:

    `"Tweet"`

1. Задайте для этой формулы свойство **OnSelect** кнопки:

    ```powerapps-comma
    If( Connection.Connected;
        Twitter.Tweet( ""; {tweetText: NewTweetTextInput.Text} );
        Collect( LocalTweetsToPost; {tweetText: NewTweetTextInput.Text} );;
            SaveData( LocalTweetsToPost; "LocalTweetsToPost" )
    );;
    Reset( NewTweetTextInput );;
    ```  

1. В свойстве **OnStart** для **приложения**добавьте строку в конце формулы:

    ```powerapps-comma
    If( Connection.Connected;
        ClearCollect( LocalTweets; Twitter.SearchTweet( "PowerApps"; {maxResults: 100} ) );;
            Set( statusText; "Online data" );
        LoadData( LocalTweets; "LocalTweets"; true );;
            Set( statusText; "Local data" )
    );;
    SaveData( LocalTweets; "LocalTweets" );;
    LoadData( LocalTweetsToPost; "LocalTweetsToPost"; true );;  // added line
    ```

    > [!div class="mx-imgBorder"]
    > ![выполнить формулу для загрузки твитов с некомментированиной строкой](./media/offline-apps/load-tweets-save.png)

Эта формула определяет, находится ли устройство в сети:

- Если устройство находится в оперативном режиме, оно отправляет твит немедленно.
- Если устройство находится в автономном режиме, оно фиксирует твит в коллекции **локалтвитстопост** и сохраняет его на устройстве.

Затем формула сбрасывает текст в поле ввода текста.

### <a name="step-7-check-for-new-tweets"></a>Шаг 7. Проверка новых твитов

1. В правой части кнопки добавьте элемент управления **Timer** .

    > [!div class="mx-imgBorder"]
    > ![конечных приложений](./media/offline-apps/final-app.png)

1. Установите для свойства **Duration (длительность** ) таймера значение **300000**.

1. Задайте для свойств **автозапуска** и **повтора** таймера **значение true**.

1. Задайте для **онтимеренд** таймера следующую формулу:

    ```powerapps-comma
    If( Connection.Connected;
        ForAll( LocalTweetsToPost; Twitter.Tweet( ""; {tweetText: tweetText} ) );;
        Clear( LocalTweetsToPost );;
        ClearCollect( LocalTweets; Twitter.SearchTweet( "PowerApps"; {maxResults: 10} ) );;
        SaveData( LocalTweets; "LocalTweets" );;
   )
    ```

Эта формула определяет, находится ли устройство в сети. Если это так, приложение твитует все элементы в коллекции **локалтвитстопост** , а затем удаляет коллекцию.

## <a name="test-the-app"></a>Тестирование приложения

1. Откройте приложение на мобильном устройстве, подключенном к Интернету.

    Существующие твиты отображаются в коллекции, а состояние — **подключено**.

1. Отключите устройство от Интернета, включив режим "самолет" устройства и отключив Wi-Fi.

    Метка состояния показывает, что приложение находится в **автономном режиме**.

1. Пока устройство находится в автономном режиме, напишите твит, включающий **PowerApps**, а затем нажмите кнопку **твит** .

    Твит хранится локально в коллекции **локалтвитстопост** .

1. Подключите устройство к Интернету, отключив режим "самолет" устройства и включив Wi-Fi.

    В течение пяти минут приложение публикует твит, который отображается в коллекции.

Мы надеемся, что в этой статье вы узнаете о возможностях, которые предоставляют мощные приложения для создания автономных приложений. Вы всегда можете отправить отзыв на наш [форум](https://powerusers.microsoft.com/t5/PowerApps-Forum/bd-p/PowerAppsForum1) и поделиться своими примерами автономных приложений в [блоге сообщества Power Apps](https://powerusers.microsoft.com/t5/PowerApps-Community-Blog/bg-p/PowerAppsBlog).