---
title: Разработка приложений на основе холста, поддерживающих автономный режим работы | Документы Майкрософт
description: Разрабатывайте приложения на основе холста, поддерживающие автономный режим работы, чтобы пользователи могли продуктивно работать независимо от режима приложения.
author: gregli-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: ''
ms.date: 01/31/2019
ms.author: gregli
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 8004a39e83ea3615ce8a77637a9f5c0271b67781
ms.sourcegitcommit: 157ab15738e2d0d1bf9097bbb7b9e3d9c29a4015
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2019
ms.locfileid: "66265703"
---
# <a name="develop-offline-capable-canvas-apps"></a>Разработка приложений на основе холста, поддерживающих автономный режим работы

Мобильные пользователи часто требуется продуктивно работать даже если они имеют ограниченный или отсутствующим подключением. При создании приложения на основе холста, можно выполнять следующие задачи:

- Откройте PowerApps Mobile и запустите приложение в автономном режиме.
- определять режим приложения (интерактивный, автономный или режим лимитного подключения) с помощью объекта сигнала [подключения](../canvas-apps/functions/signals.md#connection);
- использовать [коллекции](../canvas-apps/create-update-collection.md) и функции, например [LoadData и SaveData](../canvas-apps/functions/function-savedata-loaddata.md), для основного хранилища данных в автономном режиме.

## <a name="limitations"></a>Ограничения

**LoadData** и **SaveData** сочетании образуют простой механизм для хранения небольших объемов данных на локальном устройстве. С помощью этих функций, можно добавить в приложение простой возможностей автономной работы.

Эти функции ограничиваются объем памяти, доступное приложение, так как они работают на коллекцию в памяти. Объем доступной памяти зависит от устройства, операционная система, память, которая использует PowerApps Mobile и сложности приложения с точки зрения экранов и элементов управления. Если вы храните несколько мегабайт данных, тестирование приложения с планируемых сценариях на устройствах, на которых предполагается, что его запуск. Как правило, вы получите 30-70 МБ доступной памяти.

Функции также не разрешает автоматически конфликты слияния, когда устройство подключается к сети. Конфигурация на какие данные сохраняются, а также способ обработки повторное подключение возлагается maker при написании выражений.

Для обновления на возможностей вне сети, вернитесь к данном разделу и подписываться на [блог PowerApps](https://powerapps.microsoft.com/blog/).

## <a name="overview"></a>Обзор

При разработке сценарии автономной работы, сначала следует рассмотреть, как ваши приложения работают с данными. Приложения в PowerApps преимущественно получают доступ к данным через набор [соединители](../canvas-apps/connections-list.md) , обеспечиваемых платформой, например SharePoint, Office 365 и Common Data Service. Вы можете также создать настраиваемые соединители, которые позволят приложениям получить доступ к любой службе, предоставляющей конечную точку RESTful. Это может быть веб-API или такая служба, как Функции Azure. Все эти соединители используют протокол HTTPS через Интернет. Это означает, что пользователи должны быть в сети, чтобы получить доступ к данным и любым другим возможностям, предлагаемым службой.

![Приложение PowerApps и соединители](./media/offline-apps/online-app.png)

### <a name="handling-offline-data"></a>Управление данными в автономном режиме

В PowerApps можно фильтровать, поиска, сортировки, статистической обработки и обработки данных в согласованное независимо от источника данных. Источники варьируются от коллекций в памяти в приложении к спискам SharePoint к базам данных SQL и Common Data Service. Из-за этого согласованности можно легко перенаправить приложение для использования источника данных. Что более важно для сценариев вне сети, можно использовать локальные коллекции для управления данными практически не изменяя логику приложения. Фактически локальные коллекции представляют собой основной механизм обработки данных в автономном режиме.

## <a name="build-an-offline-app"></a>Создание автономного приложения

Чтобы полностью сосредоточиться на автономный аспекты разработки приложений, в этом разделе показан простой сценарий, сконцентрированных вокруг Twitter. Вам предстоит создать приложение, которое позволяет читать записи Twitter, а также отправлять твиты в автономном режиме. При переходе в интерактивный режим приложение будет публиковать твиты и перезагружать локальные данные.

На высоком уровне приложение выполняет следующие задачи:

- Когда пользователь открывает приложение:

  - Если устройство подключено к сети, приложение извлекает данные через соединитель Twitter и заполняет коллекцию с этими данными.
  - Если устройство находится в автономном режиме, приложение загружает данные из файла локального кэша с помощью [ **LoadData** ](../canvas-apps/functions/function-savedata-loaddata.md) функции.
  - Пользователь может отправить твитов. Если приложение находится в сети, он твиты непосредственно к Twitter и обновляет локальный кэш.

- Каждые пять минут, пока приложение находится в сети:

  - Приложение отправит какие-либо твиты в локальном кэше.
  - Приложение обновляет локальный кэш и сохраняет его с помощью [ **SaveData** ](../canvas-apps/functions/function-savedata-loaddata.md) функции.

### <a name="step-1-add-twitter-to-a-blank-phone-app"></a>Шаг 1. Добавление Twitter в пустое приложение для телефона

1. В PowerApps Studio выберите **файл** > **New**.
1. На плитке **Пустое приложение** выберите **Макет для телефона**.
1. На вкладке **Вид** выберите **источники данных**.
1. В **данных** области выберите **добавить источник данных**.
1. Выберите **новое подключение** > **Twitter** > **создание**.
1. Введите свои учетные данные, создать подключение, а затем закройте **данных** области.

### <a name="step-2-collect-existing-tweets"></a>Шаг 2. Сбор существующих твитов

1. В **представление в виде дерева** области выберите **приложения**, а затем установите его **OnStart** следующую формулу:

    ```powerapps-dot
    If( Connection.Connected,
        ClearCollect( LocalTweets, Twitter.SearchTweet( "PowerApps", {maxResults: 10} ) );
            Set( statusText, "Online data" ),
        LoadData( LocalTweets, "LocalTweets", true );
            Set( statusText, "Local data" )
    );
    SaveData( LocalTweets, "LocalTweets" );
    ```

    > [!div class="mx-imgBorder"]
    > ![Формула для загрузки твитов](./media/offline-apps/load-tweets.png)

1. В **представление в виде дерева** панели, выберите в меню с многоточием **приложения** объекта, а затем выберите **запуска OnStart** для запуска этой формулы.

    > [!div class="mx-imgBorder"]
    > ![Запустите формула для загрузки твитов](./media/offline-apps/load-tweets-run.png)

    > [!NOTE]
    > **LoadData** и **SaveData** функций может показывать ошибку в PowerApps Studio, потому что браузеры не поддерживают их. Тем не менее будет выполняться обычным образом после развертывания этого приложения на устройстве.

Эта формула проверяет, подключено ли устройство:

- Если устройство подключено к сети, формула загружает более 10 твитов, используя поисковому запросу «PowerApps» в **LocalTweets** коллекции.
- Если устройство находится в автономном режиме, формула загружает локальный кэш из файла с именем «LocalTweets», если таковой имеется.

### <a name="step-3-show-tweets-in-a-gallery"></a>Шаг 3. Отображение твитов в коллекции

1. На **вставить** выберите **коллекции** > **пустая, горизонтальная, высота**.

1. Задайте **элементы** свойство [ **коллекции** ](controls/control-gallery.md) управления `LocalTweets`.

1. В шаблон коллекции, добавьте три [ **метка** ](controls/control-text-box.md) элементов управления, а также набор **текст** каждой метки одно из следующих значений:

    - `ThisItem.UserDetails.FullName & " (@" & ThisItem.UserDetails.UserName & ")"`
    - `Text(DateTimeValue(ThisItem.CreatedAtIso), DateTimeFormat.ShortDateTime)`
    - `ThisItem.TweetText`

1. Полужирный в последнюю метку, чтобы коллекции выглядит следующим образом.

    > [!div class="mx-imgBorder"]
    > ![Коллекция, показывающая пример твитов](./media/offline-apps/tweet-gallery.png)

### <a name="step-4-show-connection-status"></a>Шаг 4. Показать состояние подключения

1. Под коллекцией Вставить метку и задайте его **цвет** свойства **Red**.

1. Задайте новые метки **текст** следующую формулу:

    `If( Connection.Connected, "Connected", "Offline" )`

Эта формула определяет, подключено ли устройство. Если это так, метка показывает **подключено**; в противном случае он показывает **Offline**.

### <a name="step-5-add-a-box-to-compose-tweets"></a>Шаг 5. Добавьте поле для составления твитов

1. Под меткой состояние подключения, вставка [ **ввода текста** ](controls/control-text-input.md) управления и переименуйте его **NewTweetTextInput**.

1. Поле ввода текста **по умолчанию** свойства `""`.

    > [!div class="mx-imgBorder"]
    > ![Коллекции, сведения о состоянии и поле для ввода текста](./media/offline-apps/status-input.png)

### <a name="step-6-add-a-button-to-post-the-tweet"></a>Шаг 6. Добавьте кнопку для отправки твита

1. Добавьте в поле ввода текста **кнопку** и задать его **текст** следующее значение:

    `"Tweet"`

1. Задайте **OnSelect** следующую формулу:

    ```powerapps-dot
    If( Connection.Connected,
        Twitter.Tweet( "", {tweetText: NewTweetTextInput.Text} ),
        Collect( LocalTweetsToPost, {tweetText: NewTweetTextInput.Text} );
            SaveData( LocalTweetsToPost, "LocalTweetsToPost" )
    );
    Reset( NewTweetTextInput );
    ```  

1. В **OnStart** свойство для **приложения**, добавьте строку в конце формулы:

    ```powerapps-dot
    If( Connection.Connected,
        ClearCollect( LocalTweets, Twitter.SearchTweet( "PowerApps", {maxResults: 100} ) );
            Set( statusText, "Online data" ),
        LoadData( LocalTweets, "LocalTweets", true );
            Set( statusText, "Local data" )
    );
    SaveData( LocalTweets, "LocalTweets" );
    LoadData( LocalTweetsToPost, "LocalTweetsToPost", true );  // added line
    ```

    > [!div class="mx-imgBorder"]
    > ![Формула для загрузки твитов с линией Раскомментировать области кода запуска](./media/offline-apps/load-tweets-save.png)

Эта формула определяет, является ли устройство подключено к сети:

- Если устройство подключено к сети, он публикует твит немедленно.
- Если устройство находится в автономном режиме, он записывает твита в **LocalTweetsToPost** коллекции и сохраняет его на устройство.

Затем формула сбрасывает текст в поле ввода текста.

### <a name="step-7-check-for-new-tweets"></a>Шаг 7. Проверьте наличие новых твитов

1. Справа от кнопки, добавьте **таймера** элемента управления.

    > [!div class="mx-imgBorder"]
    > ![Окончательный приложений](./media/offline-apps/final-app.png)

1. Установить таймер **длительность** свойства **300000**.

1. Установить таймер **автозапуска** и **повторите** свойства **true**.

1. Установить таймер **OnTimerEnd** следующую формулу:

    ```powerapps-dot
    If( Connection.Connected,
        ForAll( LocalTweetsToPost, Twitter.Tweet( "", {tweetText: tweetText} ) );
        Clear( LocalTweetsToPost );
        ClearCollect( LocalTweets, Twitter.SearchTweet( "PowerApps", {maxResults: 10} ) );
        SaveData( LocalTweets, "LocalTweets" );
   )
    ```

Эта формула определяет, подключено ли устройство. В противном случае приложение твиты все элементы в **LocalTweetsToPost** коллекции и затем очищает коллекцию.

## <a name="test-the-app"></a>Тестирование приложения

1. Откройте приложение на мобильном устройстве, подключенном к Интернету.

    Существующие твитов отображаемые в коллекции, и отобразится состояние **подключено**.

1. Отключите устройство от Интернета, включив режим "в самолете" устройства и отключение wi-fi.

    Метка "состояние" показывает, что приложение будет **Offline**.

1. Пока устройство находится в автономном режиме, написать твита, который включает в себя **PowerApps**, а затем выберите **Твита** кнопки.

    Твита хранится локально в **LocalTweetsToPost** коллекции.

1. Подключите устройство к Интернету путем отключения режима "самолета" устройства и включения wi-fi.

    В течение пяти минут приложение отправит твит, который отображается в коллекции.

Мы надеемся, что из этой статьи вы получили представление о возможностях PowerApps для создания приложений, поддерживающих автономный режим работы. Как всегда, вы можете оставить свой отзыв на [форуме](https://powerusers.microsoft.com/t5/PowerApps-Forum/bd-p/PowerAppsForum1), а также поделиться своими примерами приложений, поддерживающих работу в автономном режиме. Для этого используйте [блог сообщества PowerApps](https://powerusers.microsoft.com/t5/PowerApps-Community-Blog/bg-p/PowerAppsBlog).