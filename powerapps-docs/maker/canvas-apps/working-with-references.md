---
title: Понять ссылок на записи и полиморфных уточняющие запросы | Документация Майкрософт
description: Работа с ссылок на записи и полиморфных уточняющих запросов в приложениях на основе холста
author: gregli-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: anneta
ms.date: 05/05/2019
ms.author: gregli
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 99024b447841668bd887571a269c2fb14f5f5289
ms.sourcegitcommit: f6c9e525130a03b8c76f0a4b4e90419604c5823c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2019
ms.locfileid: "65527096"
ms.PowerAppsDecimalTransform: true
---
# <a name="understand-record-references-and-polymorphic-lookups-in-canvas-apps"></a>Понять ссылок на записи и полиморфных уточняющих запросов в приложениях на основе холста

Научная статья написана в школе, возможно, указанный список ссылок в конце. Вы не включили копию фактического фона материала, который вы использовали но вместо веб-ссылку, название книги и автору или другие сведения, чтобы кто-то удалось отследить исходный источник. Используются различные виды источников в одном списке статей газете рядом с аудиозаписи, каждый из которых собственные определенные сведения для правильной ссылки. Например, часто содержат статей Википедии [длинному списку ссылок](https://en.wikipedia.org/wiki/Microsoft#References).

В приложениях на основе холста вам часто приходится работать с копии записей, загружаемых из источников данных. Использовании [ **подстановки** ](functions/function-filter-lookup.md) и [ **фильтра** ](functions/function-filter-lookup.md) функции и [ **коллекции** ](controls/control-gallery.md) элемента управления **выбранные** свойство для идентификации конкретных нужную запись. Все записи из **фильтра** или **выбранные** будет иметь тот же тип сущности, поэтому можно использовать поля с помощью простого. *Поле* нотации. Эти копии часто содержат справочные сведения, чтобы можно было использовать [ **Patch** ](functions/function-patch.md) функция для обновления исходного источника.

Также поддерживают приложения на основе холста *записи ссылки*. Во многом как ссылка Научная статья, ссылку на запись относится к записи без включения полную копию. Эта ссылка может ссылаться на запись в любой сущности.  Также как ссылки Научная статья, вы можете объединять записи из различных сущностей в одном столбце.

Многие операции записи ссылок на идентичны работа с записями. Вы можете сравнить ссылок на записи друг к другу и к полные записи. Можно задать значение записи ссылки со **Patch** функционировать так же, как поиск значений в полную запись.

Есть одно различие важно использование: недоступны непосредственно поля записи ссылки без предварительного установления, для какого объекта он ссылается. Это обусловлено приложений на основе холста требуется, чтобы все типы быть известно при написании формулы. Поскольку вы не знаете тип ссылки на записи, пока выполняется приложение, нельзя использовать простой. *Поле* нотации напрямую. Сначала необходимо динамически определить тип сущности с [ **IsType** ](functions/function-astype-istype.md) функции, а затем использовать. *Поле* нотации на результате [ **AsType** ](functions/function-astype-istype.md) функции.

*Тип сущности* ссылается на схему каждой записи в сущности. Каждая сущность имеет уникальный набор полей с разные имена и типы данных. Каждая запись сущности наследует эту структуру; у двух записей одного типа сущности, если они исходят из той же сущности.

## <a name="polymorphic-lookups"></a>Полиморфные уточняющие запросы

Common Data Service поддерживает связями между записями. Каждая запись в **учетные записи** сущность имеет **основного контактного лица** поле подстановки для записи в **контакты** сущности. Поиск может ссылаться только на запись в **контакты** и не может ссылаться на запись в, скажем, **команды** сущности. Что мельчайших деталей важна, так как вы всегда знаете, какие поля будут доступны для поиска.

Common Data Service также поддерживает полиморфных уточняющие запросы, которые могут ссылаться на записи из любой сущности в наборе. Например **владельца** поля могут ссылаться на запись в **пользователей** сущности или **команды** сущности. То же поле подстановки в разных записей может ссылаться на записи в другой сущности. В этом случае не всегда известно, поля, которые будут доступны.  

Ссылок на холсте для записи были разработаны для работы с полиморфных уточняющие запросы в службы данных. Можно также использовать ссылок на записи вне данного контекста, который является, как эти два понятия отличаются.

В следующем разделе, вы начнете для изучения этих концепций, работая с **владельца** подстановки.

## <a name="show-the-fields-of-a-record-owner"></a>Показать поля записи владельца

Каждая сущность в Common Data Service включает в себя **владельца** поля. Это поле нельзя удалить, невозможно добавить другой, и он всегда должен иметь значение.

Чтобы отобразить это поле в **учетной записи** сущности:

1. Откройте [этот сайт](http://web.powerapps.com?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc).
1. На панели навигации слева, выберите **данных** > **сущностей**.
1. В списке сущностей выберите **учетной записи**.
1. В правом верхнем углу, откройте список фильтров (которого задано значение **по умолчанию** по умолчанию), а затем выберите **все**.
1. Прокрутите вниз до **владельца** поле отображается.

> [!div class="mx-imgBorder"]
> ![Поле владельца в сущность учетной записи](media/working-with-references/owner-field.png)

Это поле подстановки можно ссылаться на запись из либо **команды** сущности или **пользователей** сущности. Не каждая запись в эти сущности иметь разрешения, **владельца**; проверьте поддерживаемые роли, в том случае, если вы столкнулись с проблемами.

На этом рисунке показано простое коллекция **учетные записи**, где **учетные записи** сущности был добавлен в приложение в качестве источника данных:

> [!div class="mx-imgBorder"]
> ![Учетные записи, показано в элементе управления коллекции](media/working-with-references/accounts-gallery.png)

> [!IMPORTANT]
> В этом разделе на рисунке показаны некоторые имена и другие значения, которые не являются частью данных примера, который поставляется с Common Data Service. Точно показано, как настроить элементы управления для конкретного результата, но процесс будет зависеть от данных для вашей организации.

Чтобы отобразить владельца каждой учетной записи в коллекции, может возникнуть желание использовать формулу **ThisItem.Owner.Name**. Тем не менее имя поля в **Team** сущность является **название команды**и имя поля в **пользователя** сущность является **полное имя**. Приложение не может знать, какой тип поиска вы работаете с пока вы запустите приложение, и его могут различаться между записями в **учетные записи** сущности.

Требуется формула, которое можно адаптировать для различий. Необходимо также добавить источники данных для типов сущности, которые **владельца** может быть (в этом случае **пользователей** и **команды**). Добавление этим трем источникам данных в приложение:

> [!div class="mx-imgBorder"]
> ![Сущности учетных записей, групп и пользователей в области данных](media/working-with-references/accounts-datasources.png)

С помощью этих данных источников в, используйте следующую формулу для отображения имени пользователя или группы:

```powerapps-comma
If( IsType( ThisItem.Owner; [@Teams] );
    "Team: " & AsType( ThisItem.Owner; [@Teams] ).'Team Name';
    "User: " & AsType( ThisItem.Owner; [@Users] ).'Full Name' )
```

> [!div class="mx-imgBorder"]
> ![Учетные записи показано поле владельца, отображаемое в элементе управления коллекции](media/working-with-references/accounts-displayowner.png)

В этой формуле **IsType** функции тесты **владельца** поле от **команды** сущности. Если это этого типа сущности, **AsType** функция приводит его к **Team** записи. На этом этапе доступны все поля **команды** сущности, включая **название команды**, с помощью *. Поле* нотации. Если **IsType** определяет, что **владельца** не записи в **команды** сущности, это поле должно быть записи в **пользователей** сущности так как **владельца** поле является обязательным (не может быть *пустой*).

Вы используете [оператор устранения неоднозначности глобального](functions/operators.md#disambiguation-operator) для **[@Teams]** и **[@Users]** чтобы убедиться, что вы используете тип глобального объекта. Это не требуется в этом случае, но это хорошая привычка формы. Отношения один ко многим часто конфликтуют в коллекции область записи, а такой подход позволяет избежать этой путаницы.

Чтобы использовать все поля, ссылки на записи, необходимо сначала использовать **AsType** функция привести его к определенного типа сущности. Не удается получить доступ к полям, непосредственно из **владельца** поле, так как система не знает, какой тип сущности, вы хотите использовать.

**AsType** функция возвращает ошибку, если **владельца** поля не совпадает с типом сущности, запрашиваемый, чтобы можно было использовать **IfError** функции для упрощения следующую формулу. Во-первых, включите экспериментальная функция **формула высшего звена ошибка**:

> [!div class="mx-imgBorder"]
> ![Экспериментальные переключиться в режим включить ошибки уровня формула управление](media/working-with-references/accounts-iferror.png)

Затем замените такой указанной выше формуле:

```powerapps-comma
IfError(
    "Team: " & AsType( ThisItem.Owner; [@Teams] ).'Team Name';
    "User: " & AsType( ThisItem.Owner; [@Users] ).'Full Name' )
```

## <a name="filter-based-on-an-owner"></a>Фильтрация в зависимости от владельца

Поздравляем: Вы завершили самый сложный аспект работы со ссылкой на запись. Другие варианты использования представляют более простые решения, так как они не обращаются к поля записи. В качестве внедрения рассмотрим фильтрации, который рассматривается в этом разделе.

Добавить **поле со списком** над коллекцией и задать эти свойства нового элемента управления:

- **элементы**: `Users`
- **SelectMultiple**: `false`

> [!div class="mx-imgBorder"]
> ![Добавить поле со списком выше коллекции с свойства элементов для пользователей](media/working-with-references/filter-insert-combobox.png)

Для фильтрации коллекции определенным пользователем нажимаете списком, коллекции значение **элементы** следующую формулу.

```powerapps-comma
Filter( Accounts; Owner = ComboBox1.Selected )
```

> [!div class="mx-imgBorder"]
> ![Отфильтрованные коллекции, в зависимости от значения, заданного в элементе управления поля со списком](media/working-with-references/filter-accounts.png)

> [!IMPORTANT]
> Инструкции в этом разделе будут точными, если точно выполнить действия. Тем не менее Любая формула, которая ссылается на элемент управления по его имени завершается неудачей, если элемент управления имеет другое имя. Если вы удалите и добавьте элемент управления того же типа, изменяет номер в конце имени элемента управления. Любая формула, которая отображает ошибку убедитесь, что он содержит правильные имена всех элементов управления.

Не нужно использовать **IsType** или **AsType** так, как Вы сравниваете ссылок на записи других ссылок на записи или полные записи. Приложения указан тип сущности **ComboBox1.Selected** , так как он является производным от **пользователей** сущности. Учетные записи, владельцем которых является группа не будет соответствовать критерию фильтрации.

Можно получить даже еще немного лучше, поддерживая фильтрация пользователем или группой.

1. Освободи пространство в верхней части экрана путем изменения размеров коллекции и перемещение поле со списком, вставить [ **Radio** управления](controls/control-radio.md) над коллекцией и затем настройте эти свойства для нового элемента управления:

    - **элементы**: `[ "All"; "Users"; "Teams" ]`
    - **Макет**: `Layout.Horizontal`

1. Для **поле со списком** управления, присвойте этому свойству (если поле со списком исчезнет, выберите **пользователей** в элемент управления переключатель):

    - **отображается**: `Radio1.Selected.Value = "Users"`

1. Скопируйте и вставьте **поле со списком** управления, поместите копию прямо над исходной и затем настройте эти свойства для копирования:

    - **элементы**: `Teams`
    - **отображается**: `Radio1.Selected.Value = "Teams"`

    Приложение будет отображать только одно поле со списком одновременно, dependending о состоянии радиосвязь. Так как они непосредственно над друг с другом, они отображаются быть тот же элемент управления, который изменяет его содержимое.

1. Наконец, установите **элементы** свойство **коллекции** управления следующую формулу:

    ```powerapps-comma
    Filter( Accounts;
        Radio1.Selected.Value = "All"
        Or (Radio1.Selected.Value = "Users" And Owner = ComboBox1.Selected)
        Or (Radio1.Selected.Value = "Teams" And Owner = ComboBox1_1.Selected)
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![отфильтрованные коллекции отображаются все записи или определенного пользователя или группы](media/working-with-references/filter-combobox.png)

Благодаря этим изменениям можно отобразить все записи или фильтровать их в зависимости от пользователя или группы:

> [!div class="mx-imgBorder"]
> ![анимация, показывающая различных отфильтрованных результатов на основе переключатель и поле со списком полей](media/working-with-references/filter-allthree.gif)

Формула не полностью поддерживает делегирование. Часть, которая сравнивает значения «переключатель» является константой всех записей и вычисляется перед отправкой rest фильтра Common Data Service.

Если вы хотите тип владельца, можно использовать **IsType** функции, но он не еще делегируемых:

> [!div class="mx-imgBorder"]
> ![Фильтровать по типу владельца с помощью IsType](media/working-with-references/filter-bytype.png)

## <a name="update-the-owner-by-using-patch"></a>Обновить владельца с помощью Patch

Вы можете обновить **владельца** в так же, как любые другие подстановки. Для задания выбранную учетную запись владельца в первой командой:

```powerapps-comma
Patch( Accounts; Gallery1.Selected; { Owner: First( Teams ) } )
```

Этот подход не отличаются от обычных уточняющего запроса, потому что приложение известен тип **первый (команды)**. Если вы хотите вместо этого первого пользователя, замените эту часть с **первый (пользователи)**. **Patch** функция знает, что **владельца** поле может быть присвоено одно из этих двух типов сущности.

Чтобы добавить эту возможность в приложение:

1. В **представление в виде дерева** области выберите **Radio** управления и два **поле со списком** элементов управления, в то же время.

1. Выберите в меню с многоточием, **копировать эти элементы**:

    > [!div class="mx-imgBorder"]
    > ![Копирование нескольких элементов управления, с помощью представления дерева](media/working-with-references/patch-copy.png)

1. В том же меню, выберите **вставить**:

    > [!div class="mx-imgBorder"]
    > ![Вставка нескольких элементов управления, с помощью представления дерева](media/working-with-references/patch-paste.png)

1. Переместите скопированные элементы управления справа от коллекции:

    > [!div class="mx-imgBorder"]
    > ![Переместить скопированные элементы управления справа от элемента коллекции.](media/working-with-references/patch-position.png)

1. Выберите скопированный **Radio** управления, а затем измените следующие свойства:

    - Элементы: `[ "Users"; "Teams" ]`
    - Значение по умолчанию: `If( IsType( Gallery1.Selected.Owner; Users ); "Users"; "Teams" )`

    > [!div class="mx-imgBorder"]
    > ![Удалить все Выбор из радиосвязь](media/working-with-references/patch-noall.png) 

1. В **Radio** элемент управления, установите **пользователей** таким образом, чтобы **поле со списком** отображается элемент управления, который содержит список пользователей.

1. Выберите видимых **поле со списком** и затем задать **DefaultSelectedItems** следующую формулу:

    ```powerapps-comma
    If( IsType( Gallery1.Selected.Owner; Users );
        AsType( Gallery1.Selected.Owner; Users );
        Blank()
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![Свойство по умолчанию, задайте для поля со списком пользователей](media/working-with-references/patch-default-users.png)

1. В **Radio** элемент управления, установите **команды** таким образом, чтобы **поле со списком** , в котором перечислены команды является видимым.

1. Выберите **Radio** управления выбора от недоступные сейчас вступили в силу **поле со списком** управления для пользователей.

1. Выберите видимых **поле со списком** для команд и затем задать его **DefaultSelectedItems** следующую формулу:

    ```powerapps-comma
    If( IsType( Gallery1.Selected.Owner; Teams );
        AsType( Gallery1.Selected.Owner; Teams );
        Blank()
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![Свойство по умолчанию, задайте для поля со списком команд](media/working-with-references/patch-default-teams.png)

1. Вставить **кнопку** управления, переместите его под **поле со списком** и затем задать кнопки **текст** свойства `"Patch Owner"`.

1. Задайте **OnSelect** свойства кнопки следующую формулу:

    ```powerapps-comma
    Patch( Accounts; Gallery1.Selected;
        { Owner: If( Radio1_1.Selected.Value = "Users";
                ComboBox1_2.Selected;
                ComboBox1_3.Selected ) } )
    ```

    > [!div class="mx-imgBorder"]
    > ![Задайте для элемента управления кнопки формулу](media/working-with-references/patch-button.png)

Скопированный **Radio** и **поле со списком** элементы управления для отображения владельца для текущей выбранной учетной записи в коллекции. С теми же элементами управления владельца учетной записи можно задать любой группе или пользователю, нажав кнопку:

> [!div class="mx-imgBorder"]
> ![Исправление отображение анимации владельца с пользователем или группой](media/working-with-references/patch-allthree.gif)

## <a name="show-the-owner-by-using-a-form"></a>Показать владельца с помощью формы

Вы можете отобразить **владельца** в форму можно добавить пользовательскую карту. На момент написания этой статьи невозможно изменить значение поля с элементом управления формы.

1. Вставить **форма редактирования** и затем изменить размер и переместите его в правый нижний угол.

1. На **свойства** вкладке панели справа откройте **источника данных** , а затем выберите **учетные записи**:

    > [!div class="mx-imgBorder"]
    > ![Элемент управления формы, отображение дополнительных полей с пустыми значениями](media/working-with-references/form-insert.png)  

1. Формы задайте **элемент** свойства `Gallery1.Selected`:

    > [!div class="mx-imgBorder"]
    > ![Элемент управления формы, отображаются дополнительные поля, заполненные из выбранного элемента в коллекции.](media/working-with-references/form-item.png)

1. На **свойства** вкладку на правой панели, выберите **изменить поля**.

1. В **поля** панели, щелкните значок многоточия, а затем выберите **добавить пользовательскую карту**:

    > [!div class="mx-imgBorder"]
    > ![Команда для добавления пользовательской карточки](media/working-with-references/form-customcard.png)

    Новый адаптер отображается в нижней части элемента управления формы.

1. Изменить размер карты, при необходимости отображать весь текст:

    > [!div class="mx-imgBorder"]
    > ![Вставленный пользовательскую карточку, пустое](media/working-with-references/form-inserted-customcard.png)

1. Вставить **метка** в пользовательскую карточку и затем задать метки **текст** формулу, которая использовалась в коллекции:

    ```powerapps-comma
    If( IsType( ThisItem.Owner; Teams );
        "Team: " & AsType( ThisItem.Owner; Teams ).'Team Name';
        "User: " & AsType( ThisItem.Owner; Users ).'Full Name' )
    ```

    > [!div class="mx-imgBorder"]
    > ![Пользовательские карты отображается поле владельца в элемент управления label](media/working-with-references/form-displayowner.png)

Для каждого выбранного в коллекции больше полей учетной записи, включая владельца записи отображаются в форме. При изменении владельца с помощью **Patch** кнопку, элемент управления формы также показано это изменение.

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая элемента управления формы, реагирование на изменения в коллекции.](media/working-with-references/form-allthree.gif)

## <a name="show-the-fields-of-a-customer"></a>Показать поля клиента

В Common Data Service **клиента** поле подстановки — это другой полиморфных подстановки, которая очень похожа на **владельца**.

**Владелец** ограничена только одну сущность, но сущностей может включать ноль, один или более **клиента** полей подстановки. **Контакты** содержит системную сущность **название компании** поля, что **клиента** поле подстановки:

> [!div class="mx-imgBorder"]
> ![Отображение название_компании поля как тип данных клиента, который не требуется сущность "Контакт"](media/working-with-references/customer-companyname.png)

Можно добавить несколько **клиента** поля подстановки к сущности, выбрав **клиента** тип данных для нового поля:

![При создании поля из списка типов данных тип данных клиента](media/working-with-references/customer-datatype.png)

Объект **клиента** поле подстановки можно ссылаться на запись из либо **учетные записи** сущности или **контакты** сущности. Вы будете использовать **IsType** и **AsType** функции с этими сущностями, так что теперь самое время это чтобы добавить их в качестве источников данных (можно оставить **команды** и **пользователей**  на месте):

> [!div class="mx-imgBorder"]
> ![Учетные записи, групп, пользователей и контактов сущности в области данных](media/working-with-references/customer-datasources.png)

Обработка **клиента** и **владельца** поля очень похожи, что можно скопировать приложение буквально (**файл** > **Сохранить как**, а затем укажите другое имя) и выполните эти простые замены:

| Location | **Владелец** образца | **Клиент** образца |
|----------|-----------|------------------|
| На протяжении всего | **Владелец** | **«Customer Name»** |
| На протяжении всего | **Пользователи** | **Учетные записи** |
| На протяжении всего | **Команды** | **Контакты** |
| Коллекции **элементы** свойство | **Учетные записи** | **Контакты** |
| Формы **элементы** свойство | **Учетные записи** | **Контакты** |
| Первый аргумент **Patch**<br>на кнопке панели **OnSelect** свойство | **Учетные записи** | **Контакты** |
| Фильтровать радио **элементы** свойство | **[&nbsp;«All»;&nbsp;«Пользователи»;&nbsp;«Группы»&nbsp;]** | **[&nbsp;«All»;&nbsp;«Учетные записи»;&nbsp;«Contacts»&nbsp;]** |
| Исправление радио **элементы** свойство | **[«Пользователи»; «Группы»]** | **[«Учетные записи»; «Contacts»]** |
| Поле со списком **Visible** свойство | **«Пользователи»** и **«Группы»** | **«Учетные записи»** и **«Contacts»** |

Например, новая коллекция должна иметь это **элементы** свойство:

```powerapps-comma
Filter( Contacts;
    Radio1.Selected.Value = "All"
    Or (Radio1.Selected.Value = "Accounts" And 'Company Name' = ComboBox1.Selected)
    Or (Radio1.Selected.Value = "Contacts" And 'Company Name' = ComboBox1_1.Selected)
)
```

> [!div class="mx-imgBorder"]
> ![Приложение клиента, производным от владельца приложения с помощью простого изменения применены](media/working-with-references/customer-simple-update.png)

Два важных отличия между **клиента** и **владельца** требуют обновлением формулы внутри коллекции и формы:

1. Один ко многим связи между **учетные записи** и **контакты** более высокий приоритет при ссылке на эти типы сущностей по имени. Вместо **учетные записи**, использовать  **\[ \@учетных записей]**; а не **контакты**, использовать  **\[ \@ Контакты]**. С помощью [оператор устранения неоднозначности глобального](functions/operators.md#disambiguation-operator) убедитесь, что ссылка на тип сущности в **IsType** и **AsType**. Эта проблема возникает только в контексте записи элементов коллекции и формы.

1. **Владельца** поле должно иметь значение, но **клиента** поля могут быть *пустой*. Чтобы показать правильный результат без имени типа, тестирования для этого случая с [ **IsBlank** функция](functions/function-isblank-isempty.md)и отображаться пустой текстовой строки, вместо нее.

Оба эти изменения являются в та же формула, которая отображается в пользовательские карты в форме, а также **текст** свойство элемента управления галереи метки:

```powerapps-comma
If( IsBlank( ThisItem.'Company Name' ); "";
    IsType( ThisItem.'Company Name'; [@Accounts] );
        "Account: " & AsType( ThisItem.'Company Name'; [@Accounts] ).'Account Name';
    "Contact: " & AsType( ThisItem.'Company Name'; [@Contacts] ).'Full Name'
)
```

> [!div class="mx-imgBorder"]
> ![Обновления для свойства Text элемента управления label подзаголовка в коллекции.](media/working-with-references/customer-update.png)

Благодаря этим изменениям можно просматривать и изменять **название компании** в **контакты** сущности:

> [!div class="mx-imgBorder"]
> ![Изменение выбора в контакты отображение анимации на основе вносящих изменения в другие элементы управления и формы элемент управления галереи](media/working-with-references/customer-allthree.gif)

> [!NOTE]
> На момент написания этой статьи **клиента** уточняющие запросы имеют следующие ограничения:
>
> - Нельзя отфильтровать список, основанный на конкретной записи в **контакты** или **учетные записи** сущностей. Элемент управления "переключатель" Фильтр в предыдущем примере будет работать.
> - — Это поле только клиент, который работает, определяемую системой **«Company Name»** на **контакты** сущности, который использовался в предыдущем примере. Добавление поля пользовательского клиента еще не поддерживается.
> - Не удается очистить поле клиента с помощью **Patch** ему значение *пустой*.

## <a name="understand-regarding-lookup-fields"></a>Понять, в отношении полей подстановки

**В отношении** поле подстановки немного отличается от тех, которые вы уже работали в этом разделе. Начните, применив закономерности, в этом разделе описано выше, и затем вы узнаете о других приемов.

Вы можете начать просто с **факсы** сущности. Эта сущность имеет полиморфный **в отношении** поле подстановки, который можно ссылаться на **учетные записи**, **контакты**и других сущностей. Приложения, которые можно выполнить для **клиентов** и измените его для **факсы**:

| Location | **Клиент** образца | **Факсы** образца |
|----------|-----------|------------------|
| На протяжении всего | **«Customer Name»** | **В отношении** |
| Коллекции **элементы** свойство | **Контакты** | **Факсы** |
| Формы **элементы** свойство | **Контакты** | **Факсы** |
| Первый аргумент **Patch**<br> на кнопке панели **OnSelect** свойство | **Контакты** | **Факсы** |

Опять же, вам потребуется добавить источник данных: этот раз для **факсы**. На **представление** выберите **источников данных**:

> [!div class="mx-imgBorder"]
> ![Области данных учетных записей, групп, пользователей, контактов и факсы сущностей](media/working-with-references/faxes-datasources.png)

Одним важным отличием для **в отношении** — это то, что она не ограничивается **учетные записи** и **контакты**. На самом деле список сущностей является расширяемой с помощью настраиваемых сущностей. Большая часть приложения могут обеспечивать этой точки без изменений, но необходимо обновить формулу для метки в коллекции и формы:

```powerapps-comma
If( IsBlank( ThisItem.Regarding ); "";
    IsType( ThisItem.Regarding; [@Accounts] );
        "Account: " & AsType( ThisItem.Regarding; [@Accounts] ).'Account Name';
    IsType( ThisItem.Regarding; [@Contacts] );
        "Contacts: " & AsType( ThisItem.Regarding; [@Contacts] ).'Full Name';
    ""
)
```

> [!div class="mx-imgBorder"]
> ![Обновленные свойства Text для элемента управления подзаголовок для относительно операций поиска](media/working-with-references/regarding-label.png)

После внесения этих изменений, работе с **в отношении** подстановки точно так же, как это делалось **владельца** и **клиента** уточняющие запросы:

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая изменения в документы на основе обновлений, влияющие на другие элементы управления и формы элемент управления галереи](media/working-with-references/regarding-allthree.gif)

> [!NOTE]
> На момент написания этой статьи **в отношении** уточняющие запросы имеют следующие ограничения:
>
> - Нельзя отфильтровать список, основанный на определенной записи. Элемент управления "переключатель" Фильтр в предыдущем примере будет работать.
> - Невозможно очистить поле, связанных с помощью **Patch** ему значение *пустой*.

## <a name="understand-regarding-relationships"></a>Понять, в отношении связей

**В отношении** отличается от **владельца** и **клиента** так, как первый вариант предполагает отношение многие к одному. По определению обратную связь один ко многим позволяет разработчикам писать **первый (учетные записи). Факсы**.

Давайте резервное копирование и посмотреть на определения сущности. В службе Common Data Service, сущности, такие как **факсы**, **задачи**, **сообщений электронной почты**, **заметки**, **телефонные звонки**, **Буквы**, и **бесед** обозначены как [ *действия*](../../developer/common-data-service/activity-entities.md). Можно также создать свои собственные [настраиваемые сущности действий](../../developer/common-data-service/custom-activities.md). При просмотре или создании сущности действия, его параметры отображаются в **Дополнительные параметры**:

![Настройка сущности действия при создании сущности](media/working-with-references/activity-entitytype.png)

Другие сущности могут быть связаны с сущность действия, если они включены как *задача* в параметрах сущности. **Учетные записи**, **контакты**, и многих других стандартных сущностей выполнимая (опять же, в разделе **Дополнительные параметры**):

![Настройка задачи действия при создании сущности](media/working-with-references/activity-entityuse.png)

Все сущности действий и задач действия сущности имеют неявную связь. Если вы измените фильтр на **все** в верхней части экрана, выберите **факсы** сущности, а затем выберите **связи** вкладке все сущности, которые могут быть целью  **В отношении** отображаются подстановки:

> [!div class="mx-imgBorder"]
> ![Связи сущности факсы, показывающий о связях многие к одному](media/working-with-references/activity-manytoone.png)

Если Показать связи для **учетные записи** сущности, все сущности, которые могут быть источником **в отношении** отображаться поля подстановки:

> [!div class="mx-imgBorder"]
> ![Связи сущности учетной записи, показывающий относительно отношения один ко многим](media/working-with-references/activity-onetomany.png)

Что это означает?

- При создании формулы, необходимо учитывать список сущностей действие не является фиксированным, что вы можете создать свой собственный. Формула необходимо соответствующим образом обрабатывать сущности действия, вы не ожидали увидеть.
- Действие задачи и действия имеют отношение один ко многим. Вы легко можете запросить все факсы, относящиеся к учетной записи.

Чтобы изучить эту концепцию в приложении:

1. Добавьте еще один экран:

    > [!div class="mx-imgBorder"]
    > ![Вставка пустой экран](media/working-with-references/activitypointer-newscreen.png)

1. Вставка элемента управления коллекции, измените его размер и переместите его в левой части экрана.

1. На **свойства** вкладку правой панели, укажите для ее **элементы** для **учетные записи**:

    > [!div class="mx-imgBorder"]
    > ![Установка элементов для учетных записей в панели свойств](media/working-with-references/activitypointer-accounts.png)

1. Задать макет коллекции так, **Title**и установите поле заголовка **имя учетной записи**:

    > [!div class="mx-imgBorder"]
    > ![Определение макета для заголовка для элемента управления коллекции на панели свойств](media/working-with-references/activitypointer-account-name.png)

1. Добавление второй коллекции, измените его размер и затем переместите ее в правой части экрана.

1. Задайте новую коллекцию **элементы** свойства `Gallery2.Selected.Faxes`.

    Это действие Возвращает отфильтрованный список факсов для данной учетной записи:

    > [!div class="mx-imgBorder"]
    > ![Набор элементов для факсов на основе свойства элемента управления коллекции](media/working-with-references/activitypointer-faxes.png)

1. Задать макет коллекции так, **заголовок и подзаголовок**и затем установите в поле заголовка для отображения **субъекта** поле (который может быть строчными **субъекта**):

    > [!div class="mx-imgBorder"]
    > ![Заголовок SET в поле субъекта](media/working-with-references/activitypointer-subject.png)

При выборе элемента в списке учетных записей, факсы отобразятся факсов для этой учетной записи.

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая выбора в коллекции учетных записей, управляющий списком сообщений](media/working-with-references/activitypointer-allthree.gif)

## <a name="activity-entity"></a>Сущности действий

Как описано в предыдущем разделе, вы можете отобразить все факсов для учетной записи. Тем не менее вы также можете отобразить все действия для учетной записи, включая факсы, сообщения электронной почты, телефонные звонки и других взаимодействий.

Для второй сценарий, используйте **действия** сущности. Можно отобразить эту сущность, включив **все** в правом верхнем углу, чтобы удалить фильтр из списка сущностей:

> [!div class="mx-imgBorder"]
> ![Список сущностей, показывающая сущности действия](media/working-with-references/activitypointer-entity.png)

**Действия** сущности является специальным. При добавлении записи для **факсы** сущности, система также создает запись в **действия** сущности с полями, которые являются общими для всех сущностей действий. Из этих полей **субъекта** является одним из наиболее интересных.

Можно показать все действия, изменив только одна строка в предыдущем примере. Замените `Gallery2.Selected.Faxes` с `Gallery2.Selected.Activities`:

> [!div class="mx-imgBorder"]
> ![Изменение свойства items для второй коллекции, изменение с факсы на действия](media/working-with-references/activitypointer-gallery.png)

Записи поступают от **действия** сущности, но тем не менее можно использовать **IsType** функции, чтобы определить, какой вид деятельности они используются. Опять же, прежде чем использовать **IsType** с типом сущности, необходимо добавить источник данных:

> [!div class="mx-imgBorder"]
> ![Область данных, показывающее все объекты, необходимые для функции IsType](media/working-with-references/activity-datasources.png)

С помощью следующей формулы, можно показать тип записи в элементе управления label в коллекции:

```powerapps-comma
If( IsType( ThisItem; [@Faxes] ); "Fax";
    IsType( ThisItem; [@'Phone Calls'] ); "Phone Call";
    IsType( ThisItem; [@'Email Messages'] ); "Email Message";
    IsType( ThisItem; [@Chats] ); "Chat";
    "Unknown"
)
```

> [!div class="mx-imgBorder"]
> ![Значение свойства text формулу, чтобы увидеть сведения о факсы, телефонные звонки и другие действия](media/working-with-references/activitypointer-type.png)

Можно также использовать **AsType** для доступа к полям конкретного типа. Например, эта формула определяет тип каждого из действий и, для телефонных звонков, показывает, что телефонный номер и вызов направление из **номера телефонов** сущности:

```powerapps-comma
If( IsType( ThisItem; [@Faxes] ); "Fax";
    IsType( ThisItem; [@'Phone Calls'] );
       "Phone Call: " &
       AsType( ThisItem; [@'Phone Calls'] ).'Phone Number' &
       " (" & AsType( ThisItem; [@'Phone Calls'] ).Direction & ")";
    IsType( ThisItem; [@'Email Messages'] ); "Email Message";
    IsType( ThisItem; [@Chats] ); "Chat";
    "Unknown"
)
```

> [!div class="mx-imgBorder"]
> ![Свойства развернутого текста, с дополнительными сведениями для телефонных звонков](media/working-with-references/activitypointer-phonecall.png)

Таким образом в приложении отображается полный список действий. **Субъекта** поле отображается для всех типов действий, является ли формула учитывает их или нет. Типы действий, о которых известно можно отображать их имена типов и конкретного типа сведения о каждом действии:

> [!div class="mx-imgBorder"]
> ![Снимок экрана: сведения о разных типах действий завершена](media/working-with-references/activitypointer-complete.png)

## <a name="notes-entity"></a>Заметки о сущности

На данный момент все **в отношении** примеры были зависимости от действий, но **заметки** сущность представляет еще один случай.

При создании сущности, вы можете включить вложения:

![Включение вложения и примечания при создании сущности](media/working-with-references/notes-entity.png)

Если вы установите этот флажок, вы создадите **в отношении** взаимосвязь **заметки о** сущности, как на этом рисунке показано для **учетные записи** сущности:

> [!div class="mx-imgBorder"]
> ![Сущность учетной записи, показывающая связь заметки через отношение один ко многим](media/working-with-references/notes-relationships.png)

Кроме этого различия использовать **в отношении** подстановки таким же образом, в котором используются действия. Сущности, которые включены для вложения имеют отношение "один ко многим" для **заметки**, как показано в этом примере:

`First( Accounts ).Notes`

> [!NOTE]
> На момент написания этой статьи **в отношении** поиска недоступна для **заметки** сущности. Не удается считать или фильтровать на основе **в отношении** поле и нельзя задать поле, используя **Patch**.
>
> Однако обратное **заметки** отношения один ко многим доступен, поэтому можно отфильтровать список заметок для записи, которая включена для вложений. Можно также использовать [ **Relate** ](functions/function-relate-unrelate.md) функцию, чтобы добавить заметки к записи **заметки** таблицы, однако учтите, сначала необходимо создать, как в следующем примере:
>
>`Relate( ThisItem.Notes; Patch( Notes; Defaults( Notes ); { Title: "A new note" } ) )`

## <a name="activity-parties"></a>Стороны действия

На момент написания этой статьи, приложения на основе холста не поддерживают стороны действия.
