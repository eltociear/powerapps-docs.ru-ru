---
title: Знакомство со ссылками на записи и с престановкой в полиморфизм | Документация Майкрософт
description: Работа со ссылками на записи и престановкой с помощью полиморфизма в приложениях Canvas
author: gregli-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: anneta
ms.date: 09/14/2019
ms.author: gregli
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: ebb7b9d5eb203a32ef0ec931a8f653125e8f5f26
ms.sourcegitcommit: 5899d37e38ed7111d5a9d9f3561449782702a5e9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2019
ms.locfileid: "71037938"
ms.PowerAppsDecimalTransform: true
---
# <a name="understand-record-references-and-polymorphic-lookups-in-canvas-apps"></a>Общие сведения о ссылках на записи и полиморфизме в приложениях Canvas

При написании исследовательского документа в учебном заведении вы, вероятно, предоставили список ссылок в конце. Вы не включили копию фактического материала, который вы использовали, а не веб-ссылку, название книги и автора или другие сведения, чтобы кто-то мог отнестися к исходному источнику. Вы Разработайте различные типы источников в одном списке, газетные статьи рядом с звуковыми записями, каждая из которых содержит свои собственные сведения для соответствующей ссылки. Например, статьи Википедии часто содержат [длинный список ссылок](https://en.wikipedia.org/wiki/Microsoft#References).

В приложениях Canvas вы часто работаете с копиями записей, загруженных из источников данных. Для задания конкретной записи используются функции [**Lookup**](functions/function-filter-lookup.md) и [**Filter**](functions/function-filter-lookup.md) , а также **выбранное** свойство элемента управления [**коллекция**](controls/control-gallery.md) . Все записи из **фильтра** или **выбранного** типа будут иметь один и тот же тип сущности, поэтому можно использовать поля с простым. Нотация *поля* . Эти копии часто содержат справочные сведения, поэтому для обновления исходного источника можно использовать функцию [**Patch**](functions/function-patch.md) .

Приложения Canvas также поддерживают *ссылки на записи*. Как и в справочных материалах, ссылка на запись относится к записи, не включая ее полную копию. Такая ссылка может ссылаться на запись в любой сущности. Также как и в справочных материалах, можно смешивать записи из разных сущностей в одном столбце.

Многие операции с ссылками на записи идентичны работе с записями. Можно сравнить ссылки на записи друг с другом и с полными записями. Значение ссылки на запись можно задать с помощью функции **Patch** точно так же, как при уточняющем запросе с полной записью.

Существует одно важное различие в использовании: вы не можете напрямую обращаться к полям ссылки на запись, не предварительно устанавливая сущность, на которую он ссылается. Это обусловлено тем, что приложения Canvas должны быть известны для всех типов при написании формул. Так как вы не узнаете тип ссылки на запись до запуска приложения, нельзя использовать простую. Нотация *поля* напрямую. Сначала необходимо динамически определить тип сущности с помощью функции [**Type**](functions/function-astype-istype.md) , а затем использовать. Нотация *поля* для результата функции [**астипе**](functions/function-astype-istype.md) .

*Тип сущности* относится к схеме каждой записи в сущности. Каждая сущность имеет уникальный набор полей с разными именами и типами данных. Каждая запись сущности наследует эту структуру. две записи имеют одинаковый тип сущности, если они поступают из одной и той же сущности.

## <a name="polymorphic-lookups"></a>Уточняющие запросы с полиморфизмом

Common Data Service поддерживает связи между записями. Каждая запись в сущности **Accounts** имеет основное поле поиска **контакта** для записи в сущности **Контакты** . Уточняющий запрос может ссылаться только на запись в разделе " **Контакты** " и не может ссылаться на запись в, скажем, на сущность " **команды** ". Эти сведения важны, так как всегда известно, какие поля будут доступны для уточняющего запроса.

Common Data Service также поддерживает операции поиска с помощью полиморфизма, которые могут ссылаться на запись из любой сущности в наборе. Например, поле « **владелец** » может ссылаться на запись в сущности « **Пользователи** » или « **команды** ». Одно и то же поле поиска в разных записях может ссылаться на записи в разных сущностях. В этом случае вы не всегда узнаете, какие поля будут доступны.

Ссылки на холсты предназначены для работы с престановкой в Common Data Service. Можно также использовать ссылки на записи за пределами этого контекста, то есть отличия двух концепций.

В следующем разделе вы начнете изучение этих концепций, работая с поиском **владельца** .

## <a name="show-the-fields-of-a-record-owner"></a>Отображение полей владельца записи

Каждая сущность в Common Data Service включает поле " **владелец** ". Это поле нельзя удалить, вы не сможете добавить другое, и ему всегда требуется значение.

Чтобы отобразить это поле в сущности **учетной записи** :

1. Откройте [сайт PowerApps](http://web.powerapps.com?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc).
1. На панели навигации слева выберите**сущности** **данных** > .
1. В списке сущностей выберите **учетная запись**.
1. В правом верхнем углу откройте список фильтров (по умолчанию задано значение **по** умолчанию), а затем выберите **все**.
1. Прокрутите вниз, пока не появится поле **Owner (владелец** ).

 > [!div class="mx-imgBorder"]
 > ![Поле владельца в сущности учетной записи](media/working-with-references/owner-field.png)

Это поле подстановки может ссылаться на запись либо из сущности « **команды** », либо из сущности « **Пользователи** ». Не каждая запись в этих сущностях имеет разрешение на **владельца**; Если возникла проблема, Проверьте поддерживаемые роли.

На этом рисунке показана простая коллекция **учетных записей**, в которую сущность **Accounts** добавлена в приложение в качестве источника данных:

> [!div class="mx-imgBorder"]
> ![Учетные записи, отображаемые в элементе управления галереи](media/working-with-references/accounts-gallery.png)

> [!IMPORTANT]
> В этом разделе на графике показаны некоторые имена и другие значения, которые не входят в образец данных, поставляемый с Common Data Service. В шагах показано, как настроить элементы управления для определенного результата, но они зависят от данных в Организации.

Чтобы отобразить владельца каждой учетной записи в коллекции, вы можете использовать формулу **ThisItem.Owner.Name**. Однако поле имени в сущности **команды** — это **имя команды**, а поле имени в сущности **пользователя** — **полное имя**. Приложение не может понять, с каким типом поиска вы работаете, пока приложение не будет запущено, и оно может меняться между записями в сущности **Accounts** .

Требуется формула, которая может адаптироваться к этой дисперсии. Также необходимо добавить источники данных для типов сущностей, которые могут быть **владельцами** (в данном случае это **Пользователи** и **команды**). Добавьте следующие три источника данных в приложение:

> [!div class="mx-imgBorder"]
> ![Сущности Accounts, Teams и Users на панели «данные»](media/working-with-references/accounts-datasources.png)

Используя эти источники данных, используйте эту формулу для вывода имени пользователя или команды:

```powerapps-comma
If( IsType( ThisItem.Owner; [@Teams] );
    "Team: " & AsType( ThisItem.Owner; [@Teams] ).'Team Name';
    "User: " & AsType( ThisItem.Owner; [@Users] ).'Full Name' )
```

> [!div class="mx-imgBorder"]
> ![Учетные записи, отображаемые в элементе управления галереи с отображаемым полем Owner](media/working-with-references/accounts-displayowner.png)

В этой формуле функция **Type** проверяет поле " **владелец** " на предметную сущность " **команды** ". Если это тип сущности, функция **астипе** приводит ее к записи **команды** . На этом этапе можно получить доступ ко всем полям сущности **команды** , включая **имя команды**, с помощью *.* Нотация поля. Если параметру **Type** определено, что **владелец** не является записью в сущности " **команды** ", это поле должно быть записью в сущности " **Пользователи** ", поскольку поле " **владелец** " является обязательным (не может быть *пустым*).

Вы используете глобальный тип сущности с помощью [глобального оператора однозначности](functions/operators.md#disambiguation-operator) для **[@Teams]** и **@Users[]** . В данном случае это не требуется, но это хороший привычка для формирования. Связи «один ко многим» часто конфликтуют в области записей галереи, и это не является путаницой.

Чтобы использовать любые поля ссылки на запись, необходимо сначала использовать функцию **астипе** , чтобы привести ее к конкретному типу сущности. Невозможно получить доступ к полям непосредственно из поля **владелец** , так как система не знает, какой тип сущности вы хотите использовать.

Функция **астипе** возвращает ошибку, если поле **owner** не соответствует запрашиваемому типу сущности, поэтому для упрощения этой формулы можно использовать функцию **IfError** . Сначала включите экспериментальную функцию " **Управление ошибками на уровне формул**":

> [!div class="mx-imgBorder"]
> ![Экспериментальный параметр для включения управления ошибками на уровне формул](media/working-with-references/accounts-iferror.png)

Затем замените предыдущую формулу на следующую:

```powerapps-comma
IfError(
    "Team: " & AsType( ThisItem.Owner; [@Teams] ).'Team Name';
    "User: " & AsType( ThisItem.Owner; [@Users] ).'Full Name' )
```

## <a name="filter-based-on-an-owner"></a>Фильтр, основанный на владельце

Поздравляем! вы завершили самый жесткий аспект работы со ссылкой на запись. Другие варианты использования более просты, так как они не обращаются к полям записи. В качестве примера рассмотрим фильтрацию, которая будет рассмотрена в этом разделе.

Добавьте элемент управления **"поле со списком"** над галереей и задайте следующие свойства нового элемента управления:

- **Элементы**:`Users`
- **Селектмултипле**:`false`

> [!div class="mx-imgBorder"]
> ![Добавлен элемент управления "поле со списком" над коллекцией с свойством Items, имеющим значение "Пользователи"](media/working-with-references/filter-insert-combobox.png)

Чтобы отфильтровать коллекцию по конкретному пользователю, выбранному из этого поля со списком, задайте для свойства **Items** коллекции следующую формулу:

```powerapps-comma
Filter( Accounts; Owner = ComboBox1.Selected )
```

> [!div class="mx-imgBorder"]
> ![Отфильтрованная коллекция на основе значения, заданного в элементе управления "поле со списком"](media/working-with-references/filter-accounts.png)

> [!IMPORTANT]
> Инструкции в этом разделе являются точными, если выполнить действия точно. Однако любая формула, которая ссылается на элемент управления по его имени, завершается ошибкой, если у элемента управления другое имя. Если удалить и добавить элемент управления того же типа, число в конце имени элемента управления изменится. Для любой формулы, которая отображает ошибку, убедитесь, что она содержит правильные имена всех элементов управления.

Не нужно использовать **тип** или **астипе** , так как выполняется сравнение ссылок на записи с другими ссылками на записи или с полными записями. Приложение знает тип сущности **ComboBox1. Selected** , так как он является производным от сущности " **Пользователи** ". Учетные записи, владельцем которых является группа, не соответствуют критерию фильтра.

Вы можете получить небольшое красивее, поддерживающую фильтрацию либо пользователем, либо командой.

1. Освободите место в верхней части экрана, изменив размер коллекции и переместив поле со списком, вставьте [элемент управления " **переключатель** ](controls/control-radio.md) " над галереей, а затем задайте следующие свойства для нового элемента управления:

    - **Элементы**:`[ "All"; "Users"; "Teams" ]`
    - **Макет**:`Layout.Horizontal`

1. Для элемента управления **"поле со списком"** установите это свойство (если поле со списком исчезнет, выберите **Пользователи** в элементе управления "переключатель"):

    - **Видимые**:`Radio1.Selected.Value = "Users"`

1. Скопируйте и вставьте элемент управления **"поле со списком"** , переместите копию непосредственно над исходным текстом, а затем задайте следующие свойства для копии:

    - **Элементы**:`Teams`
    - **Видимые**:`Radio1.Selected.Value = "Teams"`

    Приложение будет отображать только одно поле со списком в зависимости от состояния элемента управления "переключатель". Так как они находятся прямо над другим, они выглядят как один и тот же элемент управления, изменяющий его содержимое.

1. Наконец, задайте для свойства **Items** элемента управления **галереи** следующую формулу:

    ```powerapps-comma
    Filter( Accounts;
        Radio1.Selected.Value = "All"
        Or (Radio1.Selected.Value = "Users" And Owner = ComboBox1.Selected)
        Or (Radio1.Selected.Value = "Teams" And Owner = ComboBox1_1.Selected)
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![Отфильтрованная коллекция с отображением всех записей или определенного пользователя или команды](media/working-with-references/filter-combobox.png)

С помощью этих изменений можно отобразить все записи или отфильтровать их в зависимости от пользователя или команды.

> [!div class="mx-imgBorder"]
> ![Анимация, отображающая различные отфильтрованные результаты на основе элемента управления "переключатель" и полей со списком](media/working-with-references/filter-allthree.gif)

Формула полностью делегируемых. Часть, сравнивающая значения переключателя, является константой во всех записях и вычисляется перед отправкой остальной части фильтра в Common Data Service.

Если вы хотите отфильтровать по типу владельца, можно использовать функцию **Type** , но еще не делегируемых.

> [!div class="mx-imgBorder"]
> ![Фильтрация по типу владельца с помощью метода Type](media/working-with-references/filter-bytype.png)

## <a name="update-the-owner-by-using-patch"></a>Обновление владельца с помощью исправления

Поле " **владелец** " можно обновить так же, как и любые другие операции поиска. Чтобы задать владельца выбранной учетной записи для первой команды, сделайте следующее:

```powerapps-comma
Patch( Accounts; Gallery1.Selected; { Owner: First( Teams ) } )
```

Этот подход не отличается от обычного поиска, поскольку приложение знает тип **первого (команды)** . Если вы хотите вместо этого использовать первого пользователя, замените его **первым (Users)** . Функция **Patch** знает, что полю **owner** может быть присвоено значение любого из этих двух типов сущностей.

Чтобы добавить эту возможность в приложение, сделайте следующее:

1. На панели **древовидного представления** выберите элемент управления " **переключатель** " и два элемента управления **"поле со списком** " одновременно.

1. В меню с многоточием выберите **Копировать эти элементы**.

    > [!div class="mx-imgBorder"]
    > ![Копирование нескольких элементов управления с помощью представления в виде дерева](media/working-with-references/patch-copy.png)

1. В том же меню выберите **Вставить**.

    > [!div class="mx-imgBorder"]
    > ![Вставка нескольких элементов управления с помощью представления в виде дерева](media/working-with-references/patch-paste.png)

1. Переместите скопированные элементы управления справа от коллекции.

    > [!div class="mx-imgBorder"]
    > ![Скопированные элементы управления перемещены справа от коллекции.](media/working-with-references/patch-position.png)

1. Выберите скопированный элемент управления **радио** , а затем измените следующие свойства:

    - Файлов`[ "Users"; "Teams" ]`
    - Параметры`If( IsType( Gallery1.Selected.Owner; Users ); "Users"; "Teams" )`

    > [!div class="mx-imgBorder"]
    > ![Все элементы, выбранные в элементе управления "переключатель", удалены](media/working-with-references/patch-noall.png) 

1. В элементе управления " **переключатель** " выберите **Пользователи** , чтобы элемент управления **"поле со списком"** отображал список пользователей.

1. Выберите видимый элемент управления **"поле со списком"** , а затем задайте для свойства **дефаултселектедитемс** следующую формулу:

    ```powerapps-comma
    If( IsType( Gallery1.Selected.Owner; Users );
        AsType( Gallery1.Selected.Owner; Users );
        Blank()
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![Свойство по умолчанию, заданное для поля со списком пользователей](media/working-with-references/patch-default-users.png)

1. В элементе управления **радио** выберите **команды** , чтобы элемент управления **"поле со списком"** отображал список команд.

1. Выберите элемент управления " **переключатель** ", чтобы убрать выделение с невидимого элемента управления **"поле со списком"** для пользователей.

1. Выберите видимый элемент управления **"поле со списком"** для команд, а затем задайте для свойства **дефаултселектедитемс** следующую формулу:

    ```powerapps-comma
    If( IsType( Gallery1.Selected.Owner; Teams );
        AsType( Gallery1.Selected.Owner; Teams );
        Blank()
    )
    ```

    > [!div class="mx-imgBorder"]
    > ![Набор свойств по умолчанию для поля со списком команд](media/working-with-references/patch-default-teams.png)

1. Вставьте элемент управления **"Кнопка"** , переместите его под элементом управления **"поле со списком"** и задайте для `"Patch Owner"`свойства Text кнопки значение.

1. Задайте в качестве значения свойства **OnSelect** кнопки следующую формулу:

    ```powerapps-comma
    Patch( Accounts; Gallery1.Selected;
        { Owner: If( Radio1_1.Selected.Value = "Users";
                ComboBox1_2.Selected;
                ComboBox1_3.Selected ) } )
    ```

    > [!div class="mx-imgBorder"]
    > ![Набор формул для элемента управления Button](media/working-with-references/patch-button.png)

Скопированные элементы управления **"переключатель" и "поле со списком"** показывают владельца текущей выбранной учетной записи в коллекции. С помощью тех же элементов управления можно задать владельца учетной записи для любой команды или пользователя, нажав кнопку:

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая исправление владельца у пользователя или команды](media/working-with-references/patch-allthree.gif)

## <a name="show-the-owner-by-using-a-form"></a>Отображение владельца с помощью формы

Вы можете отобразить поле **владельца** в форме, добавив настраиваемую карточку. На момент написания этой статьи нельзя изменить значение поля на элемент управления формы.

1. Вставьте элемент управления **формы редактирования** , а затем измените его размер и переместите его в правый нижний угол.

1. На вкладке **Свойства** в правой части экрана откройте список **источник данных** и выберите пункт **учетные записи**.

    > [!div class="mx-imgBorder"]
    > ![Элемент управления формы, отображающий дополнительные поля с пустыми значениями](media/working-with-references/form-insert.png)  

1. Задайте для `Gallery1.Selected`свойства **элемента** формы значение.

    > [!div class="mx-imgBorder"]
    > ![Элемент управления формы, отображающий дополнительные поля, заполненные выбранным элементом в коллекции](media/working-with-references/form-item.png)

1. На вкладке **Свойства** , расположенной в правой части экрана, выберите **изменить поля**.

1. В области **поля** нажмите кнопку с многоточием, а затем выберите **добавить настраиваемую карту**.

    > [!div class="mx-imgBorder"]
    > ![Команда для добавления настраиваемой карточки](media/working-with-references/form-customcard.png)

    Новая карточка появится в нижней части элемента управления формы.

1. При необходимости измените размер карточки, чтобы отобразить весь текст.

    > [!div class="mx-imgBorder"]
    > ![Вставлена настраиваемая карта, пустая](media/working-with-references/form-inserted-customcard.png)

1. Вставьте элемент управления **Label** в настраиваемую карточку, а затем задайте для свойства **Text** метки формулу, которая использовалась в коллекции.

    ```powerapps-comma
    If( IsType( ThisItem.Owner; Teams );
        "Team: " & AsType( ThisItem.Owner; Teams ).'Team Name';
        "User: " & AsType( ThisItem.Owner; Users ).'Full Name' )
    ```

    > [!div class="mx-imgBorder"]
    > ![Настраиваемая карточка, показывающая поле "владелец" в элементе управления "метка"](media/working-with-references/form-displayowner.png)

Для каждого выбора в коллекции в форме отображаются дополнительные поля учетной записи, включая владельца записи. При изменении владельца с помощью кнопки **исправления** элемент управления формы также показывает это изменение.

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая, что элемент управления формы отвечает на изменения в коллекции](media/working-with-references/form-allthree.gif)

## <a name="show-the-fields-of-a-customer"></a>Отображение полей клиента

В Common Data Service поле «Уточняющий запрос **клиента** » — еще один элемент, который очень похож на « **владелец**».

**Владелец** ограничен по одному на сущность, но сущности могут включать ноль, одно или несколько полей поиска **клиента** . Сущность «система **контактов** » включает в себя поле « **название компании** », которое является полем подстановки **клиента** .

> [!div class="mx-imgBorder"]
> ![Объект контакта, отображающий поле "название организации" в качестве типа данных клиента, который не является обязательным](media/working-with-references/customer-companyname.png)

В сущность можно добавить дополнительные поля поиска **клиентов** , выбрав тип данных **Customer** для нового поля.

![Тип данных Customer из списка типов данных при создании поля](media/working-with-references/customer-datatype.png)

Поле поиска **клиента** может ссылаться на запись либо из сущности **Accounts** , либо из сущности **Контакты** . С этими сущностями вы будете использовать функции **Type** и **астипе** , так что теперь пора добавить их в качестве источников данных (можно оставить **команды** и **пользователей** ).

> [!div class="mx-imgBorder"]
> ![Сущности Accounts, Teams, Users и Contacts на панели «данные»](media/working-with-references/customer-datasources.png)

Обработка полей **Customer** и **owner** похожа на то, что можно буквально скопировать > приложение (**Сохранить как**, а затем указать другое имя) и сделать эти простые замены:

| Местоположение | Пример **владельца** | Пример **клиента** |
|----------|-----------|------------------|
| Местах | **Владелец** | **"Имя клиента"** |
| Местах | **Пользователей** | **Организаций** |
| Местах | **Использованию** | **Контакты** |
| Свойство **Items** коллекции | **Организаций** | **Контакты** |
| Свойство **Items** формы | **Организаций** | **Контакты** |
| Первый аргумент **исправления**<br>в свойстве **OnSelect** кнопки | **Организаций** | **Контакты** |
| Свойство **элементов** переключателя фильтра | **[&nbsp;"ALL";&nbsp;"Users"&nbsp;; "Teams"&nbsp;]** | **[&nbsp;"ALL";&nbsp;"Accounts"&nbsp;; "Contacts"&nbsp;]** |
| Свойство **элементов** радио исправления | **["Пользователи"; "команды"]** | **["Accounts"; "Contacts"]** |
| Свойство **Visible** поля со списком | **"Пользователи"** и **"команды** " | **"Учетные записи"** и **"Контакты"** |

Например, Новая коллекция должна иметь свойство **Items** :

```powerapps-comma
Filter( Contacts;
    Radio1.Selected.Value = "All"
    Or (Radio1.Selected.Value = "Accounts" And 'Company Name' = ComboBox1.Selected)
    Or (Radio1.Selected.Value = "Contacts" And 'Company Name' = ComboBox1_1.Selected)
)
```

> [!div class="mx-imgBorder"]
> ![Приложение клиента, полученное от приложения владельца с применением простых изменений](media/working-with-references/customer-simple-update.png)

Два важных различия между **клиентом** и **владельцем** потребовали обновления формул в галерее и в форме:

1. Отношения "один ко многим" между **учетными записями** и **контактами** имеют приоритет при ссылке на эти типы сущностей по имени. Вместо **учетных записей**используйте  **\[ \@учетные записи]** ; вместо **контактов**используйте  **\[ \@контакты]** . С помощью [глобального оператора однозначности](functions/operators.md#disambiguation-operator)вы гарантируете, что вы ссылаетесь на тип сущности в **типе** и **астипе**. Эта проблема возникает только в контексте записи коллекции и элементов управления формы.

1. Поле " **владелец** " должно иметь значение, но поля **клиента** могут быть *пустыми*. Чтобы отобразить правильный результат без имени типа, проверьте этот случай с помощью [ функции](functions/function-isblank-isempty.md)IsEmpty и вместо этого отобразится пустая текстовая строка.

Оба эти изменения находятся в одной и той же формуле, которая отображается в пользовательской карточке в форме, а также в свойстве **Text** элемента управления Label в галерее:

```powerapps-comma
If( IsBlank( ThisItem.'Company Name' ); "";
    IsType( ThisItem.'Company Name'; [@Accounts] );
        "Account: " & AsType( ThisItem.'Company Name'; [@Accounts] ).'Account Name';
    "Contact: " & AsType( ThisItem.'Company Name'; [@Contacts] ).'Full Name'
)
```

> [!div class="mx-imgBorder"]
> ![Свойство "обновить до текста" элемента управления "метка подзаголовка" в коллекции](media/working-with-references/customer-update.png)

С помощью этих изменений можно просмотреть и изменить поле **название компании** в сущности **Контакты** .

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая, как выбор контакта изменяет другие элементы управления и форму](media/working-with-references/customer-allthree.gif)

## <a name="understand-regarding-lookup-fields"></a>Общие сведения о полях подстановки

Поле в **отношении** «Уточняющий запрос» незначительно отличается от того, с чем вы уже работали в этом разделе. Начните с применения шаблонов, описанных ранее в этом разделе, а затем изучите другие приемы.

Вы можете начать с сущности « **факсы** ». Эта сущность имеет преформацию в **отношении** поля подстановки, которое может ссылаться на **учетные записи**, **Контакты**и другие сущности. Вы можете принять участие в приложении для **клиентов** и изменить его для получения **факсов**.

| Местоположение | Пример **клиента** | Пример использования **факсов** |
|----------|-----------|------------------|
| Местах | **"Имя клиента"** | **Об** |
| Свойство **Items** коллекции | **Контакты** | **Факсов** |
| Свойство **Items** формы | **Контакты** | **Факсов** |
| Первый аргумент **исправления**<br> в свойстве **OnSelect** кнопки | **Контакты** | **Факсов** |

Опять же, вам потребуется добавить источник данных: это время для **факсов**. На вкладке **вид** выберите **Источники данных**.

> [!div class="mx-imgBorder"]
> ![Панель «данные» с сущностями учетные записи, группы, пользователи, контакты и факсы](media/working-with-references/faxes-datasources.png)

Важное отличие **в том, что оно не** ограничено **учетными записями** и **контактами**. Фактически, список сущностей может быть расширен с помощью пользовательских сущностей. Большая часть приложения может разместить эту точку без изменения, но необходимо обновить формулу для метки в коллекции и в форме:

```powerapps-comma
If( IsBlank( ThisItem.Regarding ); "";
    IsType( ThisItem.Regarding; [@Accounts] );
        "Account: " & AsType( ThisItem.Regarding; [@Accounts] ).'Account Name';
    IsType( ThisItem.Regarding; [@Contacts] );
        "Contacts: " & AsType( ThisItem.Regarding; [@Contacts] ).'Full Name';
    ""
)
```

> [!div class="mx-imgBorder"]
> ![Обновленное свойство Text для элемента управления "подзаголовок" в отношении уточняющих запросов](media/working-with-references/regarding-label.png)

После внесения этих изменений вы работаете с подстановкой «в **отношении** » так же, как у **владельца** и поиска **клиентов** .

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая, как при выборе элемента в коллекции изменяются другие элементы управления и форма](media/working-with-references/regarding-allthree.gif)

## <a name="understand-regarding-relationships"></a>Общие сведения о связях

В **отношении** отличается от **owner** и **Customer** , так как первый включает связь «многие к одному». По определению, связь «один ко многим» позволяет писать **первыми (учетные записи). Факсы**.

Давайте выполним резервное копирование и посмотрим на определения сущностей. В Common Data Service сущности, такие как **факсы**, **задачи**, **сообщения электронной почты**, **заметки**, **телефонные звонки**, **письма**и **сеансы** , обозначаются как [*действия*](../../developer/common-data-service/activity-entities.md). Вы также можете создавать собственные [сущности настраиваемых действий](../../developer/common-data-service/custom-activities.md). При просмотре или создании сущности действия ее параметры отображаются в разделе **Дополнительные параметры**.

![Параметр сущности действия при создании сущности](media/working-with-references/activity-entitytype.png)

Другие сущности могут быть связаны с сущностью действия, если они включены в качестве *задачи действия* в параметрах сущности. **Учетные записи**, **Контакты**и многие другие стандартные сущности обозначены (опять же, в разделе **Дополнительные параметры**).

![Параметр задачи "действие" при создании сущности](media/working-with-references/activity-entityuse.png)

Все сущности действий и сущности "действие — задача" имеют неявную связь. Если изменить фильтр на **все** в верхней части экрана, выберите сущность **факсы** , а затем перейдите на вкладку **связи** , в которой будут отображены все сущности, которые могут быть целью в **отношении** уточняющего запроса.

> [!div class="mx-imgBorder"]
> ![Связи между сущностью «факсы», отображаемые в отношении связей «многие к одному»](media/working-with-references/activity-manytoone.png)

При отображении связей для сущности **Accounts** появятся все сущности, которые могут быть источником в **отношении** поля подстановки.

> [!div class="mx-imgBorder"]
> ![Отношения сущности учетной записи, отображаемые в отношении связей "один ко многим"](media/working-with-references/activity-onetomany.png)

Что это означает?

- При написании формул необходимо учитывать, что список сущностей действий не фиксирован, и вы можете создать собственный. Формула должна соответствующим образом обрабатывала сущность действия, которая не ожидалась.
- Задачи и действия действия имеют связь «один ко многим». Можно легко запросить все факсы, связанные с учетной записью.

Чтобы изучить эту концепцию в приложении, сделайте следующее:

1. Добавьте еще один экран.

    > [!div class="mx-imgBorder"]
    > ![Вставить пустой экран](media/working-with-references/activitypointer-newscreen.png)

1. Вставьте элемент управления "Коллекция", измените его размер, а затем переместите его в левую часть экрана.

1. На вкладке **Свойства** , расположенной в правой части экрана, задайте для **элементов** коллекции значение **учетные записи**.

    > [!div class="mx-imgBorder"]
    > ![Задание элементов для учетных записей на панели свойств](media/working-with-references/activitypointer-accounts.png)

1. Задайте для макета коллекции **заголовок**, а затем задайте для поля Название значение **имя учетной записи**.

    > [!div class="mx-imgBorder"]
    > ![Установка в качестве макета заголовка для элемента управления "Галерея" на панели "Свойства"](media/working-with-references/activitypointer-account-name.png)

1. Добавьте вторую коллекцию, измените ее размер, а затем переместите ее в правую часть экрана.

1. Задайте для `Gallery2.Selected.Faxes`свойства " **элементы** " новой коллекции значение.

    Этот шаг возвращает отфильтрованный список факсов для указанной учетной записи.

    > [!div class="mx-imgBorder"]
    > ![Задание свойства Items коллекции, отображающей факсы](media/working-with-references/activitypointer-faxes.png)

1. Задайте макет коллекции как **заголовок и подзаголовок**, а затем задайте в поле Заголовок значение поля **Тема** (это может быть строчная **Тема**).

    > [!div class="mx-imgBorder"]
    > ![Задать заголовок для поля темы](media/working-with-references/activitypointer-subject.png)

При выборе элемента в списке учетных записей список факсов показывает факсы только для этой учетной записи.

> [!div class="mx-imgBorder"]
> ![Анимация, показывающая выбор в коллекции учетных записей, которая управляет списком факсов](media/working-with-references/activitypointer-allthree.gif)

## <a name="activity-entity"></a>Сущность действия

Как описано в предыдущем разделе, можно отобразить все факсы для учетной записи. Однако можно также отобразить все действия для учетной записи, включая факсы, сообщения электронной почты, телефонные звонки и другие взаимодействия.

В последнем случае используется сущность **Activity** . Эту сущность можно отобразить, включив **все** в правом верхнем углу, чтобы удалить фильтр из списка сущностей.

> [!div class="mx-imgBorder"]
> ![Список сущностей, отображающих сущность действия](media/working-with-references/activitypointer-entity.png)

Сущность **действия** является особой. При добавлении записи в сущность « **факсы** » система также создает запись в сущности « **действие** » с полями, которые являются общими для всех сущностей действия. Из этих полей **Тема** является одним из наиболее интересных.

Вы можете отобразить все действия, изменив только одну строку в предыдущем примере. Замените `Gallery2.Selected.Faxes` на `Gallery2.Selected.Activities`.

> [!div class="mx-imgBorder"]
> ![Изменение свойства Items для второй коллекции с переходом от факсов к действиям](media/working-with-references/activitypointer-gallery.png)

Записи поступают из сущности **Activity** , но вы, тем не менее, можете использовать функцию **Type** для указания того, какой тип деятельности они представляют. Опять же, перед использованием **типа** данных Type с типом сущности необходимо добавить источник данных.

> [!div class="mx-imgBorder"]
> ![Область данных, отображающая все сущности, необходимые для функции "функция"](media/working-with-references/activity-datasources.png)

С помощью этой формулы можно отобразить тип записи в элементе управления Label в коллекции:

```powerapps-comma
If( IsType( ThisItem; [@Faxes] ); "Fax";
    IsType( ThisItem; [@'Phone Calls'] ); "Phone Call";
    IsType( ThisItem; [@'Email Messages'] ); "Email Message";
    IsType( ThisItem; [@Chats] ); "Chat";
    "Unknown"
)
```

> [!div class="mx-imgBorder"]
> ![Задайте для свойства Text значение формула, чтобы отобразить сведения об факсах, телефонных звонках и других действиях.](media/working-with-references/activitypointer-type.png)

**Астипе** также можно использовать для доступа к полям конкретного типа. Например, эта формула определяет тип каждого действия, а для телефонных звонков показывает номер телефона и направление вызова из сущности **номера телефона** :

```powerapps-comma
If( IsType( ThisItem; [@Faxes] ); "Fax";
    IsType( ThisItem; [@'Phone Calls'] );
       "Phone Call: " &
       AsType( ThisItem; [@'Phone Calls'] ).'Phone Number' &
       " (" & AsType( ThisItem; [@'Phone Calls'] ).Direction & ")";
    IsType( ThisItem; [@'Email Messages'] ); "Email Message";
    IsType( ThisItem; [@Chats] ); "Chat";
    "Unknown"
)
```

> [!div class="mx-imgBorder"]
> ![Расширенное свойство текста с дополнительными сведениями для телефонного звонка](media/working-with-references/activitypointer-phonecall.png)

В результате приложение отображает полный список действий. Поле **subject** отображается для всех типов действий, независимо от того, учитывается ли формула в формуле или нет. Для типов действий, о которых вы знакомы, можно отобразить их имена типов и сведения о конкретном типе для каждого действия.

> [!div class="mx-imgBorder"]
> ![Экран "завершено" с информацией для различных видов действий](media/working-with-references/activitypointer-complete.png)

## <a name="notes-entity"></a>Сущность Notes

До сих пор все примеры в **отношении** основаны на действиях, но сущность **Notes** представляет еще один вариант.

При создании сущности можно включить вложения.

> [!div class="mx-imgBorder"]
> ![Включение вложений и примечаний при создании сущности](media/working-with-references/notes-entity.png)

Если установить флажок для включения вложений, вы **создадите связь с** сущностью **Notes** , как показано на рисунке для сущности **Accounts** :

> [!div class="mx-imgBorder"]
> ![Сущность учетной записи, показывающая связь с примечаниями через связь "один ко многим"](media/working-with-references/notes-relationships.png)

За исключением этого, используйте Уточняющий запрос "в **отношении** " таким же образом, как и для использования действий. Сущности, для которых включены вложения, имеют связь «один ко многим» с **примечаниями**, как показано в следующем примере:

`First( Accounts ).Notes`

> [!NOTE]
> На момент написания этой статьи элемент "в **отношении** " не доступен для сущности **Notes** . Невозможно выполнить чтение или фильтрацию на основе поля "в **отношении** ", и вы не можете задать поле с помощью **исправления**.
>
> Однако доступна связь Обратная **заметка** один ко многим, поэтому можно отфильтровать список заметок для записи, для которой разрешены вложения. Можно также использовать функцию « [**связать**](functions/function-relate-unrelate.md) » для добавления примечания к таблице **примечаний** записи, но сначала необходимо создать Примечание, как в следующем примере:
>
>`Relate( ThisItem.Notes; Patch( Notes; Defaults( Notes ); { Title: "A new note" } ) )`

## <a name="activity-parties"></a>Стороны действий

На момент написания этой статьи приложения Canvas не поддерживают стороны действий.